<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CAT12 Tutorial #5: Analysis on the Supercomputer &mdash; Andy&#39;s Brain Book 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Introduction to Supercomputing" href="../Supercomputer/Supercomputer_Overview.html" />
    <link rel="prev" title="CAT12 Tutorial #4: Group-Level Analysis" href="CAT12_04_Analysis.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Andy's Brain Book
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/fsl_mac_install.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unix for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../unix/Unix_Intro.html">什么是Unix系统?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unix/Unix_01_Navigation.html">Unix Tutorial #1: 目录操作</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unix/Unix_02_CopyRemove.html">Unix Tutorial #2: Copying and Removing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unix/Unix_03_ReadingTextFiles.html">Unix Tutorial #3: Reading Text Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unix/Unix_04_ShellsVariables.html">Unix Tutorial #4: Shells and Path Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unix/Unix_05_ForLoops.html">Unix Tutorial #5: For-Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unix/Unix_06_IfElse.html">Unix Tutorial #6: Conditional Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unix/Unix_07_Scripting.html">Unix Tutorial #7: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unix/Unix_08_Sed.html">Unix Tutorial #8: The Sed Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unix/Unix_09_AutomatingTheAnalysis.html">Unix Tutorial #9: Automating The Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Short Course with FSL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_Short_Course/fMRI_Intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_Short_Course/fMRI_01_DataDownload.html">fMRI Tutorial #1: Downloading the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_Short_Course/fMRI_02_ExperimentalDesign.html">fMRI Tutorial #2: Overview of The Flanker Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_Short_Course/fMRI_03_LookingAtTheData.html">fMRI Tutorial #3: Looking at the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_Short_Course/fMRI_04_Preprocessing.html">fMRI Tutorial #4: Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_Short_Course/fMRI_05_1stLevelAnalysis.html">fMRI Tutorial #5: Statistics and Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_Short_Course/fMRI_06_Scripting.html">fMRI Tutorial #6: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_Short_Course/fMRI_07_2ndLevelAnalysis.html">fMRI Tutorial #7: 2nd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_Short_Course/fMRI_08_3rdLevelAnalysis.html">fMRI Tutorial #8: 3rd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_Short_Course/fMRI_09_ROIAnalysis.html">fMRI Tutorial #9: ROI Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_Short_Course/fMRI_10_Summary.html">fMRI Tutorial #10: Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_Short_Course/fMRI_Appendices.html">fMRI Short Course: Appendices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FreeSurfer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../FreeSurfer/FreeSurfer_Introduction.html">FreeSurfer Short Course</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">E-Prime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../E-Prime/E-Prime_Overview.html">Overview of E-Prime</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AFNI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../AFNI/AFNI_Overview.html">AFNI Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SPM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../SPM/SPM_Overview.html">SPM Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functional Connectivity with the CONN Toolbox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../FunctionalConnectivity/CONN_Overview.html">Functional Connectivity and the CONN Toolbox</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parametric Modulation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../PM/PM_Overview.html">Parametric Modulation in SPM, FSL, and AFNI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Image Visualization with MRIcroGL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../MRIcroGL/MRIcroGL_Overview.html">Image Visualization with MRIcroGL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction to the Human Connectome Project (HCP)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../HCP/HCP_Overview.html">Introduction to the Human Connectome Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Finite Impulse Response (FIR) Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../FIR/FIR_Overview.html">Finite Impulse Response (FIR)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Practicals/DesignOptimization.html">Design Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Diffusion Analysis with MRtrix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../MRtrix/MRtrix_Introduction.html">Introduction to MRtrix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ASL Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ASL/ASL_Techniques.html">fASL Tutorial #1: Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ASL/fASL_02_Download.html">fASL Tutorial #2: Downloading and Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ASL/fASL_03_Task.html">fASL Tutorial #3: The N-Back Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ASL/04_fASL_GUI.html">fASL Tutorial #4: The GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ASL/05_fASL_Results.html">fASL Tutorial #5: Examining the Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ASL/06_fASL_Quantification.html">fASL Tutorial #6: Quantification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Frequently Asked Questions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../FrequentlyAskedQuestions/FrequentlyAskedQuestions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Statistics/GIMME.html">GIMME (Group Iterative Multiple Model Estimation)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Open Science</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../OpenScience/OS_Overview.html">Open Science</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Normalization Tools (ANTs)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ANTs/ANTs_Overview.html">Advanced Normalization Tools (ANTs)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tract-Based Spatial Statistics (TBSS)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../TBSS/TBSS_Overview.html">Introduction to Tract-Based Spatial Statistics (TBSS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Stats/Stats_Overview.html">Statistics for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machine Learning for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ML/ML_Overview.html">Machine Learning for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Slicer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Slicer/Slicer_Overview.html">Slicer Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CAT12</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="CAT12_Overview.html">Voxel-Based Morphometry with CAT12</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="CAT12_Overview.html#overview-of-the-computational-anatomy-toolbox">Overview of the Computational Anatomy Toolbox</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="CAT12_Overview.html#what-is-voxel-based-morphometry">What is Voxel-Based Morphometry?</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="CAT12_01_DownloadInstall.html">CAT12 Tutorial #1: Download and Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="CAT12_02_DownloadingADNIData.html">CAT12 Tutorial #2: Downloading ADNI Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="CAT12_03_Preprocessing.html">CAT12 Tutorial #3: Preprocessing the Data and QA Checks</a></li>
<li class="toctree-l3"><a class="reference internal" href="CAT12_04_Analysis.html">CAT12 Tutorial #4: Group-Level Analysis</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">CAT12 Tutorial #5: Analysis on the Supercomputer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#motivation-for-using-the-supercomputing-cluster">Motivation for Using the Supercomputing Cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="#overview-of-great-lakes">Overview of Great Lakes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-open-on-demand">Using Open On-Demand</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-template-script">Creating a Template Script</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using the Supercomputer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Supercomputer/Supercomputer_Overview.html">Introduction to Supercomputing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Matlab for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Matlab/Matlab_Overview.html">Matlab for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ITK-Snap</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ITK-Snap/ITK-Snap_Overview.html">ITK-Snap_Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../PythonForNeuroimagers/PythonForNeuroimagers_Overview.html">Python for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta-Analysis for fMRI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../MetaAnalysis/MetaAnalysis_Overview.html">Meta-Analysis for Neuroimagers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Andy's Brain Book</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="CAT12_Overview.html">Voxel-Based Morphometry with CAT12</a></li>
      <li class="breadcrumb-item active">CAT12 Tutorial #5: Analysis on the Supercomputer</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/CAT12/CAT12_05_Supercomputer.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cat12-tutorial-5-analysis-on-the-supercomputer">
<span id="cat12-05-supercomputer"></span><h1>CAT12 Tutorial #5: Analysis on the Supercomputer<a class="headerlink" href="#cat12-tutorial-5-analysis-on-the-supercomputer" title="Link to this heading"></a></h1>
<hr class="docutils" />
<section id="motivation-for-using-the-supercomputing-cluster">
<h2>Motivation for Using the Supercomputing Cluster<a class="headerlink" href="#motivation-for-using-the-supercomputing-cluster" title="Link to this heading"></a></h2>
<p>As you saw in the previous tutorial, CAT12 has an option for processing many subjects in separate <strong>processing jobs</strong>. We used four processors, which divided the group of twelve subjects we had into four jobs with three subjects each. Although this meant that those processors were unavailable for other programs on my computer, it did increase the speed of the CAT12 analysis by several times. This is a much more efficient method than serial processing, which would analyze one subject at a time, not beginning the next one until the current subject is completed.</p>
<p>We can extend this <strong>parallel processing</strong> method to take advantage of the hundreds of processors available on a typical supercomputing cluster. I will be using <a class="reference external" href="https://arc.umich.edu/greatlakes/">Great Lakes</a>, the supercomputing cluster for the University of Michigan.</p>
</section>
<section id="overview-of-great-lakes">
<h2>Overview of Great Lakes<a class="headerlink" href="#overview-of-great-lakes" title="Link to this heading"></a></h2>
<p>For most University of Michigan graduate students and researchers affiliated with the department of Literature, Science, and the Arts (LSA), you are able to apply for a free supercomputing account through Michigan’s Advanced Research Computing (ARC) center. Usually, a new supercomputing account requires a principal investigator to provide a shortcode that charges their grant or other funds; however, for those who will use only a modest amount of computing resources, you can apply for a University of <a class="reference external" href="https://arc.umich.edu/UMRCP/">Michigan Research Computing Package (UMRCP)</a>. This package provides you with 80,000 CPU hours and 10TB of storage per year, along with 100TB of archive storage which can also be requested. These resources should work for most purposes, and we will be using it for the rest of the tutorial.</p>
<p>You can apply for an account on the <a class="reference external" href="https://arc.umich.edu/UMRCP/">UMRCP webpage</a> and clicking on <code class="docutils literal notranslate"><span class="pre">Sign</span> <span class="pre">up</span> <span class="pre">for</span> <span class="pre">the</span> <span class="pre">UMRCP</span></code>. You will need to provide your title, affiliation, University ID, and a brief description of the research you will be doing on the cluster. You will also need to specify whether the data is sensitive or not; see a list <a class="reference external" href="https://safecomputing.umich.edu/dataguide/?q=node/246">here</a> of data that is allowed to be analyzed on the cluster.</p>
</section>
<section id="using-open-on-demand">
<h2>Using Open On-Demand<a class="headerlink" href="#using-open-on-demand" title="Link to this heading"></a></h2>
<p>Once your account has been approved, use <a class="reference external" href="https://greatlakes.arc-ts.umich.edu/pun/sys/dashboard/">this link</a> to access the Great Lakes dashboard. You will need to log in with your username and password, and use Duo authentication as well. Once you are logged in, you should see something like this:</p>
<figure class="align-default">
<img alt="CAT12/05_GreatLakes_Dashboard.png" src="CAT12/05_GreatLakes_Dashboard.png" />
</figure>
<p>Click on <code class="docutils literal notranslate"><span class="pre">Files</span> <span class="pre">-&gt;</span> <span class="pre">Home</span> <span class="pre">Directory</span></code> to see the files and folders located in your home directory. This is the same data organization structure as what you would see in a Unix terminal, or in your Desktop GUI. The <code class="docutils literal notranslate"><span class="pre">Upload</span></code> and <code class="docutils literal notranslate"><span class="pre">Download</span></code> buttons allow you to upload and download files, respectively, which can be useful if you need to transfer a shell script from your personal computer to the cluster, or to download fully preprocessed results onto your local machine. If you feel more comfortable using a shell, you can click on the button <code class="docutils literal notranslate"><span class="pre">Open</span> <span class="pre">in</span> <span class="pre">Terminal</span></code> to use a Unix terminal.</p>
<p>For our purposes, however, we will be focusing on <strong>Open On-Demand</strong>, a graphical user interface that emulates a personal computer through your web browser. Click on <code class="docutils literal notranslate"><span class="pre">My</span> <span class="pre">Interactive</span> <span class="pre">Sessions</span></code>, and from the list, click on <code class="docutils literal notranslate"><span class="pre">Basic</span> <span class="pre">Desktop</span></code>. In the field <code class="docutils literal notranslate"><span class="pre">Slurm</span> <span class="pre">account</span></code>, enter the account name that was registered for you when you applied for a UMRCP; in my case, it is <code class="docutils literal notranslate"><span class="pre">ajahn0</span></code>. For <code class="docutils literal notranslate"><span class="pre">Partition</span></code>, select <code class="docutils literal notranslate"><span class="pre">standard</span></code>. The rest of the fields - numer of cores, memory, and number of GPUs - do not matter that much for our Basic Desktop, since most of the analyses we will be doing will be submitted as <code class="docutils literal notranslate"><span class="pre">batch</span> <span class="pre">jobs</span></code>, explained in more detail below. The main use for the Basic Desktop is to download data, use data viewers such as <code class="docutils literal notranslate"><span class="pre">AFNI</span></code> to <code class="docutils literal notranslate"><span class="pre">fsleyes</span></code>, and to provide an environment that is easier to navigate than a single shell. For now, I will set the <code class="docutils literal notranslate"><span class="pre">Number</span> <span class="pre">of</span> <span class="pre">hours</span></code> to <code class="docutils literal notranslate"><span class="pre">120</span></code>, the <code class="docutils literal notranslate"><span class="pre">Number</span> <span class="pre">of</span> <span class="pre">cores</span></code> to <code class="docutils literal notranslate"><span class="pre">1</span></code>, and <code class="docutils literal notranslate"><span class="pre">Memory</span></code> to <code class="docutils literal notranslate"><span class="pre">8</span></code>. We won’t need GPUs for this Desktop, so we will leave it at <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<figure class="align-default">
<img alt="CAT12/05_InteractiveApps.png" src="CAT12/05_InteractiveApps.png" />
</figure>
<p>When you have filled out all of these fields, click on the <code class="docutils literal notranslate"><span class="pre">Launch</span></code> button, which will submit a request for a new Basic Desktop session. When it has loaded, click on <code class="docutils literal notranslate"><span class="pre">Launch</span> <span class="pre">Basic</span> <span class="pre">Desktop</span></code>. This will open a new tab in your web browser that will look like a standard Desktop. On the menu bar at the bottom, there is an icon for a Terminal, and an icon for a web browser. Click on the Terminal icon to open a new Terminal, and click on the web browser icon to open a Firefox web browser:</p>
<figure class="align-default">
<img alt="CAT12/05_Desktop.png" src="CAT12/05_Desktop.png" />
</figure>
<p>To run CAT12 on the computing cluster, we will have to download both SPM12 and CAT12 to our home directory, just like we did in the SPM12 tutorial and an earlier chapter of this CAT12 tutorial. Follow those instructions to install both packages in your home directory, and to install the CAT12 program in the <code class="docutils literal notranslate"><span class="pre">spm12/toolbox</span></code> directory. Likewise, navigate to the ADNI website, go to Data Collections, and click on <code class="docutils literal notranslate"><span class="pre">ADN1:Baseline</span> <span class="pre">3T</span></code>. Check the box next to <code class="docutils literal notranslate"><span class="pre">All</span></code> to select all of the images, and then select <code class="docutils literal notranslate"><span class="pre">1-Click</span> <span class="pre">Download</span></code> and click on <code class="docutils literal notranslate"><span class="pre">Zip</span> <span class="pre">File</span> <span class="pre">1</span></code>. Once the images have been downloaded, open a Terminal, type <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">~/Downloads</span></code>, and then type <code class="docutils literal notranslate"><span class="pre">unzip</span> <span class="pre">ADNI1\</span> <span class="pre">Baseline\</span> <span class="pre">3T.zip</span></code>. This will expand all of the files into a new directory called <code class="docutils literal notranslate"><span class="pre">ADNI</span></code>. We will move this to our storage directory <code class="docutils literal notranslate"><span class="pre">turbo</span></code> by typing: <code class="docutils literal notranslate"><span class="pre">mv</span> <span class="pre">ADNI</span> <span class="pre">/nfs/turbo/lsa-ajahn</span></code>.</p>
<p>To organize the data and make it more manageable, use the following code to create a file, subjList.txt, that contains a list of all the subject IDs; it will then rename each subject’s anatomical image to a more compact label including the subject ID, and then remove the subdirectories that are no longer needed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

if [ ! -f subjList.txt ]; then
  ls | grep _S_ &gt; subjList.txt
fi

for i in `cat subjList.txt`; do
  mv $i/MPR*Scaled/*/*/*.nii $i/${i}_T1w.nii
  rm -r $i/MPR*
done
</pre></div>
</div>
<p>Each subject will then have their own anatomical image:</p>
<figure class="align-default">
<img alt="CAT12/05_Anatomical_Images.png" src="CAT12/05_Anatomical_Images.png" />
</figure>
</section>
<section id="creating-a-template-script">
<h2>Creating a Template Script<a class="headerlink" href="#creating-a-template-script" title="Link to this heading"></a></h2>
<p>Once you have installed the software and downloaded the data, return to the Great Lakes dashboard. From the <code class="docutils literal notranslate"><span class="pre">Interactive</span> <span class="pre">Apps</span></code> list, select <code class="docutils literal notranslate"><span class="pre">MATLAB</span></code>. Similar to the Basic Desktop Interactive App, we need to specify the computational resources we require. Select the <code class="docutils literal notranslate"><span class="pre">MATLAB</span> <span class="pre">version</span></code> <code class="docutils literal notranslate"><span class="pre">2020a</span></code>, 120 hours, 4 cores, and 10GB of memory. We will be using this app just to create a batch template, which will then be submitted via batch jobs on the computing cluster. Click the <code class="docutils literal notranslate"><span class="pre">Launch</span></code> button, and then <code class="docutils literal notranslate"><span class="pre">Launch</span> <span class="pre">MATLAB</span></code> when it is ready.</p>
<p>When Matlab has appeared in a new tab, navigate to the directory where the anatomical images are stored by typing <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/nfs/turbo/lsa-ajahn</span></code>. Then, type <code class="docutils literal notranslate"><span class="pre">addpath</span> <span class="pre">~/spm12</span></code> from the terminal, assuming that you installed SPM12 in your home directory, and navigate to our tutorial data by typing <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/nfs/turbo/lsa-ajahn/ADNI</span></code>. Type <code class="docutils literal notranslate"><span class="pre">spm</span> <span class="pre">fmri</span></code> to open the program, and from the dropdown menu underneath <code class="docutils literal notranslate"><span class="pre">toolbox</span></code>, select <code class="docutils literal notranslate"><span class="pre">cat12</span></code>. Click the <code class="docutils literal notranslate"><span class="pre">Segment</span></code> button. Similar to what we did on the personal computer, we just have to enter the volumes that need to be segmented. However, since we will be generating an individual batch for each subject, we shoudl change the <code class="docutils literal notranslate"><span class="pre">Split</span> <span class="pre">job</span> <span class="pre">into</span> <span class="pre">separate</span> <span class="pre">processes</span></code> from the default of <code class="docutils literal notranslate"><span class="pre">4</span></code> to <code class="docutils literal notranslate"><span class="pre">0</span></code>, assigning each job to a single processor.</p>
<p>Double-click on <code class="docutils literal notranslate"><span class="pre">Volumes</span></code>, navigate to the folder <code class="docutils literal notranslate"><span class="pre">002_S_0413</span></code>, and select the file <code class="docutils literal notranslate"><span class="pre">002_S_0413_T1w.nii</span></code>. There is nothing special about this file; we just need a single file to create our template. Click on <code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">-&gt;</span> <span class="pre">Save</span> <span class="pre">Batch</span> <span class="pre">and</span> <span class="pre">Script</span></code>, and name the file <code class="docutils literal notranslate"><span class="pre">CAT12_SPM_Batch_Template</span></code>, saving it to the directory that contains all of the subjects. Use a text editor to open the file <code class="docutils literal notranslate"><span class="pre">CAT12_SPM_Batch_Template_job.m</span></code>, and change the subject ID - in this case, <code class="docutils literal notranslate"><span class="pre">002_S_0413</span></code> - to <code class="docutils literal notranslate"><span class="pre">changeme</span></code>. This string of text will be used later in a <code class="docutils literal notranslate"><span class="pre">sed</span></code> command to generate a batch file for each subject. Also, at the very end of the file, add this line of code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spm_jobman</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="n">matlabbatch</span><span class="p">)</span>
</pre></div>
</div>
<p>Which will run all of the code above it stored in the <code class="docutils literal notranslate"><span class="pre">matlabbatch</span></code> structure.</p>
<p>Next, we will create a template file for the Matlab commands to be run from the terminal. Although we created the batch template file using Matlab, we will be submitting all of the jobs from the command line, and can run them using Matlab commands but without opening the Matlab GUI. Use a text editor to create a file called <code class="docutils literal notranslate"><span class="pre">Matlab_Template_Job.sh</span></code>, and enter the following code into it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -l</span>
<span class="s1">&#39;/sw/arcts/centos7/matlab/R2020a/bin/matlab&#39;</span> <span class="o">-</span><span class="n">nodesktop</span> <span class="o">-</span><span class="n">noFigureWindows</span> <span class="o">-</span><span class="n">nosplash</span> <span class="o">-</span><span class="n">r</span> <span class="s2">&quot;addpath &#39;~/spm12&#39;; changeme; exit&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;Job finished for subject changeme without errors&quot;</span>
</pre></div>
</div>
<p>The options <code class="docutils literal notranslate"><span class="pre">-nodesktop</span></code>, <code class="docutils literal notranslate"><span class="pre">noFigureWindows</span></code>, and <code class="docutils literal notranslate"><span class="pre">-nosplash</span></code> signal that the Matlab GUI should not be opened up, and everything after the <code class="docutils literal notranslate"><span class="pre">-r</span></code> option is normal Matlab code, similar to what you would run if you were in a Matlab terminal. Our goal is to</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="CAT12_04_Analysis.html" class="btn btn-neutral float-left" title="CAT12 Tutorial #4: Group-Level Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../Supercomputer/Supercomputer_Overview.html" class="btn btn-neutral float-right" title="Introduction to Supercomputing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Andy Jahn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>