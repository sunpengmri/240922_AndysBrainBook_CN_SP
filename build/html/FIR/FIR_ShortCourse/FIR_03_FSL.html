<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chapter #3: FIR Analysis in FSL &mdash; Andy&#39;s Brain Book 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Design Optimization" href="../../Practicals/DesignOptimization.html" />
    <link rel="prev" title="Chapter #2: FIR Analysis in SPM" href="FIR_02_SPM.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Andy's Brain Book
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/fsl_mac_install.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unix for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_Intro.html">What is Unix?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_01_Navigation.html">Unix Tutorial #1: 目录操作 (Directories and Navigation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_02_CopyRemove.html">Unix Tutorial #2: Copying and Removing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_03_ReadingTextFiles.html">Unix Tutorial #3: Reading Text Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_04_ShellsVariables.html">Unix Tutorial #4: Shells and Path Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_05_ForLoops.html">Unix Tutorial #5: For-Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_06_IfElse.html">Unix Tutorial #6: Conditional Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_07_Scripting.html">Unix Tutorial #7: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_08_Sed.html">Unix Tutorial #8: The Sed Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_09_AutomatingTheAnalysis.html">Unix Tutorial #9: Automating The Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Short Course with FSL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_Intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_01_DataDownload.html">fMRI Tutorial #1: Downloading the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_02_ExperimentalDesign.html">fMRI Tutorial #2: Overview of The Flanker Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_03_LookingAtTheData.html">fMRI Tutorial #3: Looking at the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_04_Preprocessing.html">fMRI Tutorial #4: Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_05_1stLevelAnalysis.html">fMRI Tutorial #5: Statistics and Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_06_Scripting.html">fMRI Tutorial #6: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_07_2ndLevelAnalysis.html">fMRI Tutorial #7: 2nd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_08_3rdLevelAnalysis.html">fMRI Tutorial #8: 3rd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_09_ROIAnalysis.html">fMRI Tutorial #9: ROI Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_10_Summary.html">fMRI Tutorial #10: Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_Appendices.html">fMRI Short Course: Appendices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FreeSurfer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FreeSurfer/FreeSurfer_Introduction.html">FreeSurfer Short Course</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">E-Prime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../E-Prime/E-Prime_Overview.html">Overview of E-Prime</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AFNI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../AFNI/AFNI_Overview.html">AFNI Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SPM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../SPM/SPM_Overview.html">SPM Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functional Connectivity with the CONN Toolbox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FunctionalConnectivity/CONN_Overview.html">Functional Connectivity and the CONN Toolbox</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parametric Modulation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PM/PM_Overview.html">Parametric Modulation in SPM, FSL, and AFNI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Image Visualization with MRIcroGL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRIcroGL/MRIcroGL_Overview.html">Image Visualization with MRIcroGL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction to the Human Connectome Project (HCP)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../HCP/HCP_Overview.html">Introduction to the Human Connectome Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Finite Impulse Response (FIR) Models</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../FIR_Overview.html">Finite Impulse Response (FIR)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../FIR_Overview.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FIR_Overview.html#next-steps">Next Steps</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../FIR_Overview.html#video">Video</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="FIR_01_AFNI.html">Chapter #1: FIR Analysis in AFNI</a></li>
<li class="toctree-l3"><a class="reference internal" href="FIR_02_SPM.html">Chapter #2: FIR Analysis in SPM</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Chapter #3: FIR Analysis in FSL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preprocessing-and-the-first-level-model">Preprocessing and the First-Level Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-the-script">Creating the Script</a></li>
<li class="toctree-l4"><a class="reference internal" href="#viewing-the-firs">Viewing the FIRs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#video">Video</a></li>
<li class="toctree-l4"><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Practicals/DesignOptimization.html">Design Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Diffusion Analysis with MRtrix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRtrix/MRtrix_Introduction.html">Introduction to MRtrix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ASL Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/ASL_Techniques.html">fASL Tutorial #1: Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_02_Download.html">fASL Tutorial #2: Downloading and Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_03_Task.html">fASL Tutorial #3: The N-Back Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/04_fASL_GUI.html">fASL Tutorial #4: The GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/05_fASL_Results.html">fASL Tutorial #5: Examining the Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/06_fASL_Quantification.html">fASL Tutorial #6: Quantification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Frequently Asked Questions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FrequentlyAskedQuestions/FrequentlyAskedQuestions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Statistics/GIMME.html">GIMME (Group Iterative Multiple Model Estimation)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Open Science</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../OpenScience/OS_Overview.html">Open Science</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Normalization Tools (ANTs)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ANTs/ANTs_Overview.html">Advanced Normalization Tools (ANTs)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tract-Based Spatial Statistics (TBSS)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../TBSS/TBSS_Overview.html">Introduction to Tract-Based Spatial Statistics (TBSS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Stats/Stats_Overview.html">Statistics for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machine Learning for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ML/ML_Overview.html">Machine Learning for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Slicer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Slicer/Slicer_Overview.html">Slicer Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CAT12</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CAT12/CAT12_Overview.html">Voxel-Based Morphometry with CAT12</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using the Supercomputer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Supercomputer/Supercomputer_Overview.html">Introduction to Supercomputing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Matlab for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Matlab/Matlab_Overview.html">Matlab for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ITK-Snap</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ITK-Snap/ITK-Snap_Overview.html">ITK-Snap_Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PythonForNeuroimagers/PythonForNeuroimagers_Overview.html">Python for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta-Analysis for fMRI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MetaAnalysis/MetaAnalysis_Overview.html">Meta-Analysis for Neuroimagers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Andy's Brain Book</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../FIR_Overview.html">Finite Impulse Response (FIR)</a></li>
      <li class="breadcrumb-item active">Chapter #3: FIR Analysis in FSL</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/FIR/FIR_ShortCourse/FIR_03_FSL.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="chapter-3-fir-analysis-in-fsl">
<span id="fir-03-fsl"></span><h1>Chapter #3: FIR Analysis in FSL<a class="headerlink" href="#chapter-3-fir-analysis-in-fsl" title="Link to this heading"></a></h1>
<hr class="docutils" />
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>Finite Impulse Response analysis in FSL is more similar to SPM than to AFNI; the basic setup happens in the GUI, and you specify a window along with the number of time-points you want to estimate. Since both the preprocessing and modeling happens within the same FEAT GUI, the analysis will be more compact than in SPM.</p>
<p>Before you begin, create the onset time files by navigating to the directory containing all of your subject, and then copying and pasting the following code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

#Check whether the file subjList.txt exists; if not, create it
if [ ! -f subjList.txt ]; then
        ls -d sub-?? &gt; subjList.txt
fi

#Loop over all subjects and format timing files into FSL format
for subj in `cat subjList.txt` ; do
        cd $subj/func #Navigate to the subject&#39;s func directory, which contains the timing files

        cat ${subj}_task-tonecounting_events.tsv | awk &#39;{if (NR!=1 &amp;&amp; $5==&quot;&quot;) {print $1, $2, &quot;1&quot;}}&#39; &gt; toneCount_run1.txt
        cat ${subj}_task-tonecounting_events.tsv | awk &#39;{if ($5==&quot;probe&quot;) {print $1, $2, &quot;1&quot;}}&#39; &gt; toneProbe_run1.txt

        cd ../..
done
</pre></div>
</div>
<p>This will create new files in the <code class="docutils literal notranslate"><span class="pre">func</span></code> directory called <code class="docutils literal notranslate"><span class="pre">toneCount_run1.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">toneProbe_run1.txt</span></code>, respectively.</p>
</section>
<section id="preprocessing-and-the-first-level-model">
<h2>Preprocessing and the First-Level Model<a class="headerlink" href="#preprocessing-and-the-first-level-model" title="Link to this heading"></a></h2>
<p>Now, navigate to the folder <code class="docutils literal notranslate"><span class="pre">sub-01</span></code> and type <code class="docutils literal notranslate"><span class="pre">Feat_gui</span></code>. This will open the FEAT GUI; make sure the defaults of <code class="docutils literal notranslate"><span class="pre">First-level</span> <span class="pre">analysis</span></code> and <code class="docutils literal notranslate"><span class="pre">Full</span> <span class="pre">Analysis</span></code> are selected, and then click on the button <code class="docutils literal notranslate"><span class="pre">Select</span> <span class="pre">4D</span> <span class="pre">data</span></code>. Select the file <code class="docutils literal notranslate"><span class="pre">func/sub-01_task-tonecounting_bold.nii.gz</span></code>, and click <code class="docutils literal notranslate"><span class="pre">OK</span></code>. In the field next to <code class="docutils literal notranslate"><span class="pre">Output</span> <span class="pre">directory</span></code> type <code class="docutils literal notranslate"><span class="pre">run1</span></code>, and leave the other defaults in the Data and Pre-stats tabs as they are. In the <code class="docutils literal notranslate"><span class="pre">Registration</span></code> tab, set the search values in both the Main structural image and Standard space fields to <code class="docutils literal notranslate"><span class="pre">Full</span> <span class="pre">Search</span></code> and <code class="docutils literal notranslate"><span class="pre">12</span> <span class="pre">DOF</span></code> (you may use <code class="docutils literal notranslate"><span class="pre">BBR</span></code> if you want; to make the analysis quicker, we will use these other settings). In the <code class="docutils literal notranslate"><span class="pre">Main</span> <span class="pre">structural</span> <span class="pre">image</span></code> field, select the image <code class="docutils literal notranslate"><span class="pre">anat/sub-01_T1w_brain.nii.gz</span></code>. Then, click on the <code class="docutils literal notranslate"><span class="pre">Stats</span></code> tab and click the button <code class="docutils literal notranslate"><span class="pre">Full</span> <span class="pre">model</span> <span class="pre">setup</span></code>.</p>
<p>Set the <code class="docutils literal notranslate"><span class="pre">Number</span> <span class="pre">of</span> <span class="pre">original</span> <span class="pre">EVs</span></code> to <code class="docutils literal notranslate"><span class="pre">2</span></code>, and for the EV name for the first regressor, type <code class="docutils literal notranslate"><span class="pre">ToneCounting</span></code>. Change the <code class="docutils literal notranslate"><span class="pre">Basic</span> <span class="pre">shape</span></code> to <code class="docutils literal notranslate"><span class="pre">Custom</span> <span class="pre">(3</span> <span class="pre">column</span> <span class="pre">format)</span></code>, and select the file <code class="docutils literal notranslate"><span class="pre">toneCount_run1.txt</span></code>. In the dropdown menu next to <code class="docutils literal notranslate"><span class="pre">Convolution</span></code>, select <code class="docutils literal notranslate"><span class="pre">FIR</span> <span class="pre">basis</span> <span class="pre">functions</span></code>. As with AFNI and SPM, you can select the time window and the number of time-points to estimate; change the <code class="docutils literal notranslate"><span class="pre">Number</span></code> to <code class="docutils literal notranslate"><span class="pre">10</span></code> and the <code class="docutils literal notranslate"><span class="pre">Window</span></code> to <code class="docutils literal notranslate"><span class="pre">20</span></code>. This will estimate 10 time-points at 2 second intervals in a 20-second window after the onset of the stimulus. Click on the <code class="docutils literal notranslate"><span class="pre">2</span></code> tab to select the second regressor, give it the name <code class="docutils literal notranslate"><span class="pre">Probe</span></code>, and select <code class="docutils literal notranslate"><span class="pre">Custom</span> <span class="pre">(3</span> <span class="pre">column</span> <span class="pre">format)</span></code> and the file <code class="docutils literal notranslate"><span class="pre">toneProbe_run1.txt</span></code>; use the same <code class="docutils literal notranslate"><span class="pre">Number</span></code> and <code class="docutils literal notranslate"><span class="pre">Window</span></code> values of <code class="docutils literal notranslate"><span class="pre">10</span></code> and <code class="docutils literal notranslate"><span class="pre">20</span></code>:</p>
<figure class="align-default">
<img alt="../../_images/03_FEAT_FIR_Setup.png" src="../../_images/03_FEAT_FIR_Setup.png" />
</figure>
<section id="specifying-the-contrasts">
<h3>Specifying the Contrasts<a class="headerlink" href="#specifying-the-contrasts" title="Link to this heading"></a></h3>
<p>If you click on the <code class="docutils literal notranslate"><span class="pre">Contrasts</span> <span class="pre">&amp;</span> <span class="pre">F-tests</span></code> tab, you may get a message telling you to use Real EVs; this is because the Original EVs are usually restricted to estimating the amplitude of the regressor, and ignore additional regressors such as temporal derivatives and motion regressors. In this case we are interested in the additional regressors, specifically the estimated time-points after the onset of the condition.</p>
<p>In the field next to <code class="docutils literal notranslate"><span class="pre">F-tests</span></code>, type <code class="docutils literal notranslate"><span class="pre">1</span></code> and press enter. You should see 10 contrasts automatically filled in with a diagonal of 1’s for each time-point after the ToneCounting condition, and a box selected in the column <code class="docutils literal notranslate"><span class="pre">F1</span></code>. Just as in the SPM tutorial, this will test whether there is any significant difference anywhere for any of the time-points. We can also add two more contrasts by changing the <code class="docutils literal notranslate"><span class="pre">Contrasts</span></code> number to <code class="docutils literal notranslate"><span class="pre">12</span></code>; name these additional contrasts <code class="docutils literal notranslate"><span class="pre">ToneCounting_TRs3_4-1</span></code> and <code class="docutils literal notranslate"><span class="pre">ToneCounting_TR10-1</span></code>, and give them the contrasts [-1 0 0.5 0.5 0 0 0 0 0 0] and [-1 0 0 0 0 0 0 0 0 1], respectively. The first will test whether the average of TRs 3 and 4 is greater than 1, and the second will test whether TR 10’s activiy is greater than TR 1’s.</p>
<figure class="align-default">
<img alt="../../_images/03_FEAT_FIR_Contrasts.png" src="../../_images/03_FEAT_FIR_Contrasts.png" />
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The box to the left of each regressor marked <code class="docutils literal notranslate"><span class="pre">C1</span></code>, <code class="docutils literal notranslate"><span class="pre">C2</span></code>, etc., will also create a separate t-contrast for that particular regressor. If you don’t want individual t-tests for each regressor, uncheck the boxes from <code class="docutils literal notranslate"><span class="pre">C1</span></code> to <code class="docutils literal notranslate"><span class="pre">C10</span></code>, and leave the F-test boxes checked. However, these individual t-tests will be useful later on if you want to extract contrast estimates for each time-point in a group-level ROI analysis.</p>
</div>
<p>If you click on <code class="docutils literal notranslate"><span class="pre">View</span> <span class="pre">Design</span></code>, you should see the following image, representing 10 regressors after the onset of each condition:</p>
<figure class="align-default">
<img alt="../../_images/03_FEAT_FIR_Design.png" src="../../_images/03_FEAT_FIR_Design.png" />
</figure>
</section>
</section>
<section id="creating-the-script">
<h2>Creating the Script<a class="headerlink" href="#creating-the-script" title="Link to this heading"></a></h2>
<p>Next, click <code class="docutils literal notranslate"><span class="pre">Done</span></code>, and then click <code class="docutils literal notranslate"><span class="pre">Save</span></code>; call the output file <code class="docutils literal notranslate"><span class="pre">Design_run1</span></code>, and save it to the directory containing all of your subjects. Then use your terminal to navigate to the directory containing the subjects, and copy and paste the following code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

# Generate the subject list to make modifying this script
# to run just a subset of subjects easier.

for id in `seq -w 1 2` ; do
    subj=&quot;sub-$id&quot;
    echo &quot;===&gt; Starting processing of $subj&quot;
    echo
    cd $subj

        # If the brain mask doesn’t exist, create it
        if [ ! -f anat/${subj}_T1w_brain_f02.nii.gz ]; then
            echo &quot;Skull-stripped brain not found, using bet with a fractional intensity threshold of 0.5&quot;
            # Note: This fractional intensity appears to work well for most of the subjects in the
            # Flanker dataset. You may want to change it if you modify this script for your own study.
            bet2 anat/${subj}_T1w.nii.gz \
                anat/${subj}_T1w_brain.nii.gz
        fi

        # Copy the design files into the subject directory, and then
        # change “sub-01” to the current subject number
        cp ../design_run1.fsf .

        # Note that we are using the | character to delimit the patterns
        # instead of the usual / character because there are / characters
        # in the pattern.
        sed -i &#39;&#39; &quot;s|sub-01|${subj}|g&quot; \
            design_run1.fsf

        # Now everything is set up to run feat
        echo &quot;===&gt; Starting feat for run 1&quot;
        feat design_run1.fsf
                echo

    # Go back to the directory containing all of the subjects, and repeat the loop
    cd ..
done

echo
</pre></div>
</div>
<p>This will analyze all of the subjects with the FIR model you specified in the FEAT GUI; it will take a couple of hours, depending on the speed of your computer.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Subjects 1 and 2 have 104 TRs in their ToneCounting runs, while subjects 4-14 have 112; subject 3 has 113. To make the script run without errors for the rest of the subjects, you will need to edit the <code class="docutils literal notranslate"><span class="pre">design_run1.fsf</span></code> script and change line 39 from <cite>set fmri(npts) 104`</cite> to <code class="docutils literal notranslate"><span class="pre">113</span></code> for subject 3, and <code class="docutils literal notranslate"><span class="pre">112</span></code> for subjects 4-14. Then rerun the script above, changing <code class="docutils literal notranslate"><span class="pre">seq</span> <span class="pre">-w</span> <span class="pre">1</span> <span class="pre">2</span></code> to <code class="docutils literal notranslate"><span class="pre">seq</span> <span class="pre">-w</span> <span class="pre">3</span></code> for subject 3, and <code class="docutils literal notranslate"><span class="pre">seq</span> <span class="pre">-w</span> <span class="pre">4</span> <span class="pre">14</span></code> for the rest of the subjects.</p>
</div>
</section>
<section id="viewing-the-firs">
<h2>Viewing the FIRs<a class="headerlink" href="#viewing-the-firs" title="Link to this heading"></a></h2>
<p>In order to view the estimated time-points as a time-series, you will need to concatenate them using <code class="docutils literal notranslate"><span class="pre">fslmerge</span></code>. Navigate to the directory <code class="docutils literal notranslate"><span class="pre">sub-01/run1.feat/stats</span></code> and type the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fslmerge</span> <span class="o">-</span><span class="n">t</span> <span class="n">FIRs</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="n">zstat1</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="n">zstat2</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="n">zstat3</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="n">zstat4</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="n">zstat5</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="n">zstat6</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="n">zstat7</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="n">zstat8</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="n">zstat9</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="n">zstat10</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>This will create a new file, <code class="docutils literal notranslate"><span class="pre">FIRs.nii.gz</span></code>, which you can look at in fsleyes. Type <code class="docutils literal notranslate"><span class="pre">fsleyes</span></code> from the command line to open up the viewer, and then select <code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">-&gt;</span> <span class="pre">Add</span> <span class="pre">from</span> <span class="pre">file</span></code>, and choose the file sub-01/run1.feat/reg/highres.nii.gz. Then select <code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">-&gt;</span> <span class="pre">Add</span> <span class="pre">from</span> <span class="pre">file</span></code>, navigate to the <code class="docutils literal notranslate"><span class="pre">sub-01/run1.feat/stats</span></code> directory, and select the file <code class="docutils literal notranslate"><span class="pre">fstat1.nii.gz</span></code> and <code class="docutils literal notranslate"><span class="pre">FIRs.nii.gz</span></code>. Highlight the <code class="docutils literal notranslate"><span class="pre">fstat1</span></code> file, threshold it however you want, and note where there seem to be brighter intensity voxels, indicating a higher f-statistic. Then highlight the <code class="docutils literal notranslate"><span class="pre">FIRs</span></code> file, and click on <code class="docutils literal notranslate"><span class="pre">View</span> <span class="pre">-&gt;</span> <span class="pre">Time</span> <span class="pre">Series</span></code>. You should see something like this:</p>
<figure class="align-default">
<img alt="../../_images/03_View_FIRs.png" src="../../_images/03_View_FIRs.png" />
</figure>
<p>As you click the crosshairs on different voxels, the time-series will update to show the estimated BOLD response to each time-point in the window you specified. Once you run the preprocessing and first-level analysis for all of the subjects, you can then do a group-level analysis on the time-points and contrast that you want, and extract time-points using an ROI analysis as in the Flanker study.</p>
</section>
<section id="video">
<h2>Video<a class="headerlink" href="#video" title="Link to this heading"></a></h2>
<p>For a video demonstration of how to do FIR analysis in FSL, click <a class="reference external" href="https://youtu.be/hMJFPZHEHeI">here</a>.</p>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading"></a></h2>
<p>You have now learned how to perform a Finite Impulse Response analysis in all of the major software packages; which one you choose is ultimately up to you.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="FIR_02_SPM.html" class="btn btn-neutral float-left" title="Chapter #2: FIR Analysis in SPM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../Practicals/DesignOptimization.html" class="btn btn-neutral float-right" title="Design Optimization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Andy Jahn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>