<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SPM Tutorial #9: ROI Analysis &mdash; Andy&#39;s Brain Book 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Appendix A: Summary Statistics" href="SummaryStatistics.html" />
    <link rel="prev" title="SPM Intermezzo: Toolboxes" href="SPM_Intermezzo_Toolboxes.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Andy's Brain Book
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/fsl_mac_install.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unix for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_Intro.html">What is Unix?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_01_Navigation.html">Unix Tutorial #1: 目录操作 (Directories and Navigation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_02_CopyRemove.html">Unix Tutorial #2: Copying and Removing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_03_ReadingTextFiles.html">Unix Tutorial #3: Reading Text Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_04_ShellsVariables.html">Unix Tutorial #4: Shells and Path Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_05_ForLoops.html">Unix Tutorial #5: For-Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_06_IfElse.html">Unix Tutorial #6: Conditional Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_07_Scripting.html">Unix Tutorial #7: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_08_Sed.html">Unix Tutorial #8: The Sed Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_09_AutomatingTheAnalysis.html">Unix Tutorial #9: Automating The Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Short Course with FSL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_Intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_01_DataDownload.html">fMRI Tutorial #1: Downloading the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_02_ExperimentalDesign.html">fMRI Tutorial #2: Overview of The Flanker Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_03_LookingAtTheData.html">fMRI Tutorial #3: Looking at the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_04_Preprocessing.html">fMRI Tutorial #4: Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_05_1stLevelAnalysis.html">fMRI Tutorial #5: Statistics and Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_06_Scripting.html">fMRI Tutorial #6: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_07_2ndLevelAnalysis.html">fMRI Tutorial #7: 2nd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_08_3rdLevelAnalysis.html">fMRI Tutorial #8: 3rd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_09_ROIAnalysis.html">fMRI Tutorial #9: ROI Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_10_Summary.html">fMRI Tutorial #10: Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_Appendices.html">fMRI Short Course: Appendices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FreeSurfer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FreeSurfer/FreeSurfer_Introduction.html">FreeSurfer Short Course</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">E-Prime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../E-Prime/E-Prime_Overview.html">Overview of E-Prime</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AFNI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../AFNI/AFNI_Overview.html">AFNI Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SPM</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../SPM_Overview.html">SPM Overview</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../SPM_Overview.html#what-is-spm">What is SPM?</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="SPM_fMRI_Intro.html">Introduction to SPM</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_01_DataDownload.html">SPM Tutorial #1: Downloading the Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_02_Flanker.html">SPM Tutorial #2: The Flanker Task</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_03_LookingAtData.html">SPM Tutorial #3: Looking at the Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_04_Preprocessing.html">SPM Tutorial #4: Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_05_1stLevelAnalysis.html">SPM Tutorial #5: Statistics and Modeling</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_06_Scripting.html">SPM Tutorial #6: Scripting</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_07_SettingTheOrigin.html">SPM Tutorial #7: Setting the Origin</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_08_GroupAnalysis.html">SPM Tutorial #8: Group Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_Intermezzo_Toolboxes.html">SPM Intermezzo: Toolboxes</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">SPM Tutorial #9: ROI Analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-atlases">Using Atlases</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extracting-data-from-the-anatomical-mask">Extracting Data from the Anatomical Mask</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extracting-data-from-a-sphere">Extracting Data from a Sphere</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-the-command-line-for-roi-analysis">Using the Command Line for ROI Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#biased-analyses">Biased Analyses</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="#video">Video</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="SummaryStatistics.html">Appendix A: Summary Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_PPI.html">Appendix B: Psychophysiological Interactions (PPI) in SPM</a></li>
<li class="toctree-l3"><a class="reference internal" href="AppendixC_ParametricModulation.html">Appendix C: Parametric Modulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="AppendixD_DesignOptimization.html">Appendix D: DesignOptimization</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functional Connectivity with the CONN Toolbox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FunctionalConnectivity/CONN_Overview.html">Functional Connectivity and the CONN Toolbox</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parametric Modulation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PM/PM_Overview.html">Parametric Modulation in SPM, FSL, and AFNI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Image Visualization with MRIcroGL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRIcroGL/MRIcroGL_Overview.html">Image Visualization with MRIcroGL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction to the Human Connectome Project (HCP)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../HCP/HCP_Overview.html">Introduction to the Human Connectome Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Finite Impulse Response (FIR) Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FIR/FIR_Overview.html">Finite Impulse Response (FIR)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Practicals/DesignOptimization.html">Design Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Diffusion Analysis with MRtrix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRtrix/MRtrix_Introduction.html">Introduction to MRtrix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ASL Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/ASL_Techniques.html">fASL Tutorial #1: Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_02_Download.html">fASL Tutorial #2: Downloading and Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_03_Task.html">fASL Tutorial #3: The N-Back Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/04_fASL_GUI.html">fASL Tutorial #4: The GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/05_fASL_Results.html">fASL Tutorial #5: Examining the Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/06_fASL_Quantification.html">fASL Tutorial #6: Quantification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Frequently Asked Questions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FrequentlyAskedQuestions/FrequentlyAskedQuestions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Statistics/GIMME.html">GIMME (Group Iterative Multiple Model Estimation)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Open Science</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../OpenScience/OS_Overview.html">Open Science</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Normalization Tools (ANTs)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ANTs/ANTs_Overview.html">Advanced Normalization Tools (ANTs)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tract-Based Spatial Statistics (TBSS)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../TBSS/TBSS_Overview.html">Introduction to Tract-Based Spatial Statistics (TBSS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Stats/Stats_Overview.html">Statistics for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machine Learning for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ML/ML_Overview.html">Machine Learning for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Slicer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Slicer/Slicer_Overview.html">Slicer Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CAT12</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CAT12/CAT12_Overview.html">Voxel-Based Morphometry with CAT12</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using the Supercomputer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Supercomputer/Supercomputer_Overview.html">Introduction to Supercomputing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Matlab for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Matlab/Matlab_Overview.html">Matlab for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ITK-Snap</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ITK-Snap/ITK-Snap_Overview.html">ITK-Snap_Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PythonForNeuroimagers/PythonForNeuroimagers_Overview.html">Python for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta-Analysis for fMRI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MetaAnalysis/MetaAnalysis_Overview.html">Meta-Analysis for Neuroimagers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Andy's Brain Book</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../SPM_Overview.html">SPM Overview</a></li>
      <li class="breadcrumb-item active">SPM Tutorial #9: ROI Analysis</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/SPM/SPM_Short_Course/SPM_09_ROIAnalysis.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="spm-tutorial-9-roi-analysis">
<span id="spm-09-roianalysis"></span><h1>SPM Tutorial #9: ROI Analysis<a class="headerlink" href="#spm-tutorial-9-roi-analysis" title="Link to this heading"></a></h1>
<hr class="docutils" />
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>You’ve just completed a group-level analysis, and identified which regions of the brain show a significant difference between the Incongruent and Congruent conditions of the experiment. For some researchers, this may be all that they want to do.</p>
<p>This kind of analysis is called a <strong>whole-brain</strong> or <strong>exploratory</strong> analysis. These types of analyses are useful when the experimenter doesn’t have a hypothesis about where the difference may be located; the result will be used as the basis for future research.</p>
<p>When a large number of studies have been run about a specific topic, however, we can begin to make more specific hypotheses about where we should find our results in the brain images. For example, cognitive control has been studied for many years, and many fMRI studies have been published about it using different paradigms that compare more cognitively demanding tasks to less cognitively demanding tasks. Often, significant increases in the BOLD signal during cognitively demanding conditions are seen in a region of the brain known as the <strong>dorsal medial prefrontal cortex</strong>, or dmPFC for short. For the Flanker study, then, we could restrict our analysis to this region and only extract data from voxels within that region. This is known as a <strong>region of interest (ROI)</strong> analysis. A general name for an analysis in which you choose to analyze a region selected before you look at whole-brain results is called a <strong>confirmatory analysis</strong>.</p>
<p>Whole-brain maps can hide important details about the effects that we’re studying. We may find a significant effect of incongruent-congruent, but the reason the effect is significant could be because incongruent is greater than congruent, or because congruent is much more negative than congruent, or some combination of the two. The only way to determine what is driving the effect is with ROI analysis, and this is especially important when dealing with interactions and more sophisticated designs.</p>
</section>
<section id="using-atlases">
<h2>Using Atlases<a class="headerlink" href="#using-atlases" title="Link to this heading"></a></h2>
<p>One way to create a region for our ROI analysis is to use an <strong>atlas</strong>, or a map that partitions the brain into anatomically distinct regions.</p>
<p>The WFU PickAtlas toolbox that you installed in the <a class="reference internal" href="SPM_Intermezzo_Toolboxes.html#spm-intermezzo-toolboxes"><span class="std std-ref">last tutorial</span></a> contains several different atlases: Two human atlases, two monkey atlases, and a mouse atlas. Select the <code class="docutils literal notranslate"><span class="pre">HUMAN</span> <span class="pre">ATLAS</span></code> option to open up an atlas of <strong>Brodmann Areas</strong>, cortical parcellations based on their tissue structure and cell organization. From previous studies of cognitive control we would expect our study to show significant BOLD activity in the <strong>dorsal anterior cingulate</strong> (dACC) region, corresponding to Brodmann Area 32. Click on the region <code class="docutils literal notranslate"><span class="pre">brodmann</span> <span class="pre">area</span> <span class="pre">32</span></code> in the left menu, and then click the <code class="docutils literal notranslate"><span class="pre">ADD-&gt;</span></code> button near the top of the screen. The axial slices that you see in the middle of the screen represent a template brain, and voxels that belong to the working region you selected will be highlighted in red. Click the up and down arrows to the right of the brain to see the extent of the region that you selected.</p>
<p>You may think that the default voxels of that region are painted on too thin a slice of cortex to adequately capture your region of interest. In that case, you can enter a number in the <code class="docutils literal notranslate"><span class="pre">DILATE</span></code> field, and click either the <code class="docutils literal notranslate"><span class="pre">2D</span></code> or <code class="docutils literal notranslate"><span class="pre">3D</span></code> buttons to dilate the mask by the number of voxels you specify in either two dimensions or three dimensions. Enter a value of “1” and click <code class="docutils literal notranslate"><span class="pre">3D</span></code>; observe how the size and extent of the mask changes.</p>
<figure class="align-default">
<img alt="../../_images/09_WFU_PickAtlas.png" src="../../_images/09_WFU_PickAtlas.png" />
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can add as many regions as you want to your ROI. For example, if you wanted to cover the entire anterior cingulate region, you could select both brodmann areas 32 and 24. Both sets of voxels would be highlighted in red, and both would belong to the same mask when you save it.</p>
</div>
<p>When you are satisfied with the mask you have generated, click the <code class="docutils literal notranslate"><span class="pre">SAVE</span> <span class="pre">MASK</span></code> button near the bottom of the screen. Label the mask “BA_32”, and save it to the Flanker directory that contains all of your subjects. (If you wanted to better organize your data, you could create another directory called “Masks”, and save the mask into that folder.)</p>
</section>
<section id="extracting-data-from-the-anatomical-mask">
<h2>Extracting Data from the Anatomical Mask<a class="headerlink" href="#extracting-data-from-the-anatomical-mask" title="Link to this heading"></a></h2>
<p>Once you’ve created the mask, you can then extract each subject’s contrast estimates from it. There are two ways that we could extract our contrast of interest Incongruent-Congurent:</p>
<ol class="arabic simple">
<li><p>Extract the contrast estimate Incongruent-Congruent from our stats file; or</p></li>
<li><p>Extract the individual beta weights for Incongruent and Congruent separately, and then take the difference between the two.</p></li>
</ol>
<p>As we will see, option #2 allows you to determine what is driving the effect; in other words, whether a significant effect is due to both beta weights being positive but the Incongruent beta weights being more positive, both weights being negative but the Congruent betas more negative, or a combination of the two. It is only by extracting both sets of beta weights that we can determine this.</p>
<p>First, click the Results button from the SPM GUI, and load the SPM.mat file from the folder <code class="docutils literal notranslate"><span class="pre">2ndLevel_Incongruent</span></code>. Select the <code class="docutils literal notranslate"><span class="pre">Incongruent</span></code> contrast, and for <code class="docutils literal notranslate"><span class="pre">apply</span> <span class="pre">masking</span></code>, select <code class="docutils literal notranslate"><span class="pre">image</span></code>. Load the BA_32.nii image you created using the WFU PickAtlas toolbox, and choose <code class="docutils literal notranslate"><span class="pre">inclusive</span></code> when it asks you the nature of the mask; this will restrict our analysis to the voxels inside the mask, as opposed to analyzing only those voxels that are excluded by the mask. (The latter option can be useful if you have a mask of a lesioned area, for example.) Select <code class="docutils literal notranslate"><span class="pre">No</span></code> for <code class="docutils literal notranslate"><span class="pre">ROI</span> <span class="pre">Analysis</span></code>, and <code class="docutils literal notranslate"><span class="pre">none</span></code> for the p-value adjustment.</p>
<p>For the uncorrected p-value threshold, set the value to <code class="docutils literal notranslate"><span class="pre">1</span></code> and the extent threshold to 0 - this will in effect do no thresholding at all, for reasons we will see in just a moment.</p>
<p>The glass brain now shows highlighted voxels in the BA_32 mask that we selected. Right click in any of the glass brain panels and select <code class="docutils literal notranslate"><span class="pre">goto</span> <span class="pre">global</span> <span class="pre">maximum</span></code>. This will highlight the current ROI that you have created. Then right-click again, and select <code class="docutils literal notranslate"><span class="pre">Extract</span> <span class="pre">data</span> <span class="pre">-&gt;</span> <span class="pre">whitened</span> <span class="pre">and</span> <span class="pre">filtered</span> <span class="pre">y</span> <span class="pre">-&gt;</span> <span class="pre">This</span> <span class="pre">cluster</span></code>. This will output to the Matlab terminal a list of each contrast estimate for each subject, for each voxel in the mask. To make this list of numbers more manageable and easier to interpret, type the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Inc</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>This returns a set of 26 numbers representing the contrast estimate for each subject averaged over all of the voxels in the ROI. We will then do the same procedure for the Congruent contrasts, loading the SPM.mat file from the <code class="docutils literal notranslate"><span class="pre">2ndLevel_Congruent</span></code> directory and selecting the same options as above. When you have displayed the results within the BA_32 ROI, extract the data, and then type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Con</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>We now have a pair of 26 numbers, one pair per subject. We can enter this pair into a paired-samples t-test with the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">stats</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttest</span><span class="p">(</span><span class="n">Inc</span><span class="p">,</span><span class="n">Con</span><span class="p">)</span>
</pre></div>
</div>
<p>This will return four variables, representing different parts of the hypothesis test:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>h: Is the result significant? (0 = No; 1 = Yes)
p: The p-value for the hypothesis test
ci: The confidence interval for the contrast estimate
stats: Additional statistics, including the t-statistic, degrees of freedom, and the standard deviation
</pre></div>
</div>
<figure class="align-default">
<img alt="../../_images/09_Ttest_results.png" src="../../_images/09_Ttest_results.png" />
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As an exercise, do the same procedure for the 2ndLevel_Inc-Con results. After you have extracted the data and put it into a variable labeled <code class="docutils literal notranslate"><span class="pre">Inc_Con</span></code>, compare the values to the output from typing “Inc-Con” (note the difference between the underscore character and the dash character). What do you notice? Does it make sense?</p>
</div>
</section>
<section id="extracting-data-from-a-sphere">
<h2>Extracting Data from a Sphere<a class="headerlink" href="#extracting-data-from-a-sphere" title="Link to this heading"></a></h2>
<p>You may have noticed that the results from the ROI analysis using the anatomical mask were not significant. This may be because the ACC mask covers a very large region; although the ACC is labeled as a single anatomical region, we may be extracting data from several distinct functional areas. Consequently, this may not be the best ROI approach to take.</p>
<p>Another technique is called the <strong>spherical ROI</strong> approach. In this case, a sphere of a given diameter is centered at a triplet of specified x-, y-, and z-coordinates. These coordinates are often based on the peak activation of another study that uses the same or a similar experimental design to what you are using. This is considered an <strong>independent</strong> analysis, since the ROI is defined based on a separate study.</p>
<p>The following animation shows the difference between anatomical and spherical ROIs:</p>
<figure class="align-default">
<img alt="../../_images/09_ROI_Analysis_Anatomical_Spherical.gif" src="../../_images/09_ROI_Analysis_Anatomical_Spherical.gif" />
</figure>
<p>To create this ROI, we will need to find peak coordinates from another study; let’s randomly pick a paper, such as Jahn et al., 2016. In the Results section, we find that there is a Conflict effect for a Stroop task - a distinct but related experimental design also intended to tap into cognitive control - with a peak t-statistic at MNI coordinates 0, 20, 44.</p>
<p>To create the sphere, we will be using the <strong>Marsbar</strong> toolbox that we installed in the <a class="reference internal" href="SPM_Intermezzo_Toolboxes.html#spm-intermezzo-toolboxes"><span class="std std-ref">last chapter</span></a>. From the SPM GUI, click on <code class="docutils literal notranslate"><span class="pre">Toolbox</span> <span class="pre">-&gt;</span> <span class="pre">marsbar</span></code>.</p>
<p>Marsbar allows you to create an ROI using several different methods, such as:</p>
<ol class="arabic simple">
<li><p>A sphere (which we will do in this tutorial);</p></li>
<li><p>The cluster from a result that you generate;</p></li>
<li><p>A box with dimensions that you specify.</p></li>
</ol>
<p>To create a sphere, click on <code class="docutils literal notranslate"><span class="pre">ROI</span> <span class="pre">definition</span> <span class="pre">-&gt;</span> <span class="pre">Build</span></code>. From the <code class="docutils literal notranslate"><span class="pre">Type</span> <span class="pre">of</span> <span class="pre">ROI</span></code> dropdown menu, select <code class="docutils literal notranslate"><span class="pre">Sphere</span></code> and enter the coordinates <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">20</span> <span class="pre">44</span></code>. Enter a Sphere radius of 5, and for both the Description of ROI and Label for ROI fields, enter <code class="docutils literal notranslate"><span class="pre">dACC_Sphere</span></code>. Save the file to your Flanker directory as <code class="docutils literal notranslate"><span class="pre">dACC_Sphere_roi</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the paper, the peak of the activation was technically within a region called the pre-supplementary motor area, or pre-SMA. There is still some debate over where these cognitive control activations are located, but for this tutorial I have chosen to use the term dACC.</p>
</div>
<p>Now we have a .mat file that contains the necessary information to build our spherical ROI. Before we generate the ROI as a NIFTI file, click on <code class="docutils literal notranslate"><span class="pre">ROI</span> <span class="pre">definition</span></code> and select <code class="docutils literal notranslate"><span class="pre">View</span></code>. Click on your newly created <code class="docutils literal notranslate"><span class="pre">dACC_Sphere_roi.mat</span></code> file, and make sure that it is located in the region where it should be.</p>
<figure class="align-default" id="id1">
<img alt="../../_images/09_Check_ROI.png" src="../../_images/09_Check_ROI.png" />
<figcaption>
<p><span class="caption-text">Examining the ROI created by marsbar.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>If the sphere is in the right place, go back to the marsbar ROI and select <code class="docutils literal notranslate"><span class="pre">ROI</span> <span class="pre">definition</span> <span class="pre">-&gt;</span> <span class="pre">Export</span></code>. In the <code class="docutils literal notranslate"><span class="pre">Export</span> <span class="pre">ROI(s)</span> <span class="pre">to</span></code> dropdown menu, select <code class="docutils literal notranslate"><span class="pre">image</span></code>; from the selection menu, click on the <code class="docutils literal notranslate"><span class="pre">dACC_Sphere_roi.mat</span></code> file. Leave the <code class="docutils literal notranslate"><span class="pre">Space</span> <span class="pre">for</span> <span class="pre">ROI</span> <span class="pre">image</span></code> as the default (i.e., Base space for ROIs), and select the Flanker directory as the output folder. Label the image as <code class="docutils literal notranslate"><span class="pre">dACC_Sphere</span></code>.</p>
<p>We now have a mask that we can use for our ROI analysis, and we can use the same method as we did in the above section on extracting data from the anatomical mask. If you do it correctly, you should get a p-value of 0.04 for a t-test of the Incongruent-Congruent contrast.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Marsbar is also capable of ROI analyses using the marsbar GUI. This procedure involves many steps, and will not be covered in this tutorial. For those interested in learning more about it, see <a class="reference external" href="http://andysbrainblog.blogspot.com/2012/11/parameter-extraction-with-marsbar.html">this blog post</a>.</p>
</div>
</section>
<section id="using-the-command-line-for-roi-analysis">
<h2>Using the Command Line for ROI Analysis<a class="headerlink" href="#using-the-command-line-for-roi-analysis" title="Link to this heading"></a></h2>
<p>If you already have a mask and a contrast that you are extracting from, you can do an ROI analysis using Matlab code and SPM’s spm_get_data command. The following script (which can also be downloaded <a class="reference external" href="https://github.com/andrewjahn/SPM_Scripts/blob/master/Extract_ROI_Data.m">here</a>) requires an ROI and a contrast as arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">ROI_data</span> <span class="o">=</span> <span class="n">Extract_ROI_Data</span><span class="p">(</span><span class="n">ROI</span><span class="p">,</span> <span class="n">Contrast</span><span class="p">)</span>

    <span class="n">Y</span> <span class="o">=</span> <span class="n">spm_read_vols</span><span class="p">(</span><span class="n">spm_vol</span><span class="p">(</span><span class="n">ROI</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">indx</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">Y</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">ind2sub</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">Y</span><span class="p">),</span><span class="n">indx</span><span class="p">);</span>

    <span class="n">XYZ</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="p">]</span><span class="s1">&#39;;</span>

    <span class="n">ROI_data</span> <span class="o">=</span> <span class="n">nanmean</span><span class="p">(</span><span class="n">spm_get_data</span><span class="p">(</span><span class="n">Contrast</span><span class="p">,</span> <span class="n">XYZ</span><span class="p">),</span><span class="mi">2</span><span class="p">);</span>

<span class="n">end</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Contrast</span></code> argument can be a path pointing to a contrast, such as “con_0001.nii” that was generated during either the 1st- or 2nd-level analysis. Alternatively, you can navigate into a 2nd-level directory and type <code class="docutils literal notranslate"><span class="pre">load</span> <span class="pre">SPM</span></code>. This will load the SPM structure, and it contains a field called <code class="docutils literal notranslate"><span class="pre">SPM.xY.P</span></code>: a cell array with paths to each of the contrasts that went into the 2nd-level analysis.</p>
<p>In our current example, navigate to the folder <code class="docutils literal notranslate"><span class="pre">2ndLevel_Inc-Con</span></code>. Save the above code into a .m file and call it <code class="docutils literal notranslate"><span class="pre">Extract_ROI_Data</span></code>. Then type the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">load</span> <span class="n">SPM</span>
<span class="n">Extract_ROI_Data</span><span class="p">(</span><span class="s1">&#39;BA_32.nii&#39;</span><span class="p">,</span> <span class="n">SPM</span><span class="o">.</span><span class="n">xY</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
</pre></div>
</div>
<p>It should return the same values as when you did the anatomical ROI analysis above for the BA32 mask.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default voxel resolution is 2x2x2mm for masks created with either the wfupickatlas or marsbar toolbox. In order to use the script above, this voxel resolution needs to match the resolution of the data you are extracting from. For example, if you specified a resampling resolution of 3x3x3 during the normalization preprocessing step, you will need to <a class="reference external" href="https://andysbrainbook.readthedocs.io/en/latest/FrequentlyAskedQuestions/FrequentlyAskedQuestions.html#resampling">resample</a> the mask so that the voxel dimensions match. The following image shows how to use SPM’s <code class="docutils literal notranslate"><span class="pre">Coregister</span> <span class="pre">(Reslice)</span></code> command to resample the BA_32 ROI. The resliced image will have an “r” prepended to it:</p>
</div>
<figure class="align-default">
<img alt="../../_images/09_ROI_Reslice.png" src="../../_images/09_ROI_Reslice.png" />
</figure>
</section>
<section id="biased-analyses">
<h2>Biased Analyses<a class="headerlink" href="#biased-analyses" title="Link to this heading"></a></h2>
<p>When performing an ROI analysis, make sure that the ROI isn’t <strong>biased</strong>, or artificially inflating the parameter estimates that you extract. In a nutshell, a biased analysis uses an ROI that is defined by the data that you are analyzing - for example, it only consists of voxels that pass a high statistical threshold. An unbiased ROI (also known as an <strong>independent ROI</strong>) is not defined by the data in your study, and can either be created from an atlas or by the results of another study. For more details on the difference between the two types of analyses, see <a class="reference internal" href="../../fMRI_Short_Course/fMRI_Appendices/Appendix_B_BiasedAnalysis.html#appendix-b-biasedanalysis"><span class="std std-ref">Appendix B</span></a>.</p>
<p>A demonstration of how to do a biased analysis in SPM may help you better understand this concept. Load the 2nd-level results for the Inc-Con contrast, and use the previous thresholds of an uncorrected voxel-wise threshold of p=0.001 and a cluster threshold of 20. When the results are displayed, drag the crosshair to the cluster in the dACC and click the <code class="docutils literal notranslate"><span class="pre">current</span> <span class="pre">cluster</span></code> button. (This will snap the crosshairs to the peak voxel within this cluster; if you did it correctly, the peak coordinates should be about <code class="docutils literal notranslate"><span class="pre">6,</span> <span class="pre">23,</span> <span class="pre">53</span></code>.) Click on the <code class="docutils literal notranslate"><span class="pre">save</span></code> dropdown menu, and select <code class="docutils literal notranslate"><span class="pre">current</span> <span class="pre">cluster</span></code>. Call the output file <code class="docutils literal notranslate"><span class="pre">dACC_001</span></code>.</p>
<p>Now use this file as a mask for an ROI analysis, following the steps you completed earlier. How does the significance of the contrast estimates from this cluster compare to the significance of the data you extracted using an anatomical approach? A spherical ROI approach? Why? To help you with articulating the reason for the large difference in the results, reread Appendix B and also watch <a class="reference external" href="https://www.youtube.com/watch?v=nVLeMY6TLkk">this video</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The same biased ROI approach can be done without creating a mask; you can simply threshold the contrast as you normally would when performing a whole-brain analysis, highlight the cluster you are interested in, and extract the data as usual. The purpose of saving out the thresholded cluster as a mask was to familiarize you with SPM’s “save” functions, and to have the masks in case you want to use them with another software package, such as AFNI.</p>
</div>
</section>
<hr class="docutils" />
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Create an anatomical mask of a region of your choosing, and test whether the contrast of Inc-Con is significant within that ROI. Show a figure displaying the ROI, and show the results from the ttest command. (N.B.: When evaluating the p-value, take into account how many ROIs you are using to test the same contrast - as the number of tests goes up, your p-value should become proportionately more conservative. A good guideline to follow is to use Bonferroni correction based on the number of ROIs that you test; e.g, if you test two ROIs, then divide the p-value by 2, for a corrected alpha level of 0.025.)</p></li>
<li><p>Use the code given in the section on spherical ROI analysis to create a sphere with a 7mm radius located at MNI coordinates 36, -2, 48, and extract the data for the contrast <code class="docutils literal notranslate"><span class="pre">Inc-Con</span></code> from this region. Include a figure showing the ROI you used, either with SPM’s Display function, or with Marsbar’s “View ROI” function. Show the data that was extracted from this ROI (i.e., a list of the average contrast estimate per each subject, using the <code class="docutils literal notranslate"><span class="pre">mean(y,2)</span></code> code above).</p></li>
<li><p>Do a biased ROI analysis by creating a dorsal anterior cingulate mask from the Inc-Con contrast, using a voxel-wise threshold of p=0.0005 and a cluster threshold of 20. Save the mask as <code class="docutils literal notranslate"><span class="pre">dACC_0005</span></code>. When you extract the data, how does it compare to your earlier biased analysis using a mask with a threshold of p=0.001? Why? Show the code you used, and copy and paste the output from your t-test (e.g., using the code: <code class="docutils literal notranslate"><span class="pre">[h,</span> <span class="pre">p,</span> <span class="pre">ci,</span> <span class="pre">stats]</span> <span class="pre">=</span> <span class="pre">ttest(Inc_Con_0005)</span></code>, for example).</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="video">
<h2>Video<a class="headerlink" href="#video" title="Link to this heading"></a></h2>
<p>For a video walkthrough of ROI analysis in SPM, click <a class="reference external" href="https://www.youtube.com/watch?v=zVuSHTJLJj4">here</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="SPM_Intermezzo_Toolboxes.html" class="btn btn-neutral float-left" title="SPM Intermezzo: Toolboxes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="SummaryStatistics.html" class="btn btn-neutral float-right" title="Appendix A: Summary Statistics" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Andy Jahn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>