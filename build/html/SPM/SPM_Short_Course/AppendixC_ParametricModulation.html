<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Appendix C: Parametric Modulation &mdash; Andy&#39;s Brain Book 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Appendix D: DesignOptimization" href="AppendixD_DesignOptimization.html" />
    <link rel="prev" title="Appendix B: Psychophysiological Interactions (PPI) in SPM" href="SPM_PPI.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Andy's Brain Book
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/fsl_mac_install.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unix for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_Intro.html">What is Unix?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_01_Navigation.html">Unix Tutorial #1: 目录操作 (Directories and Navigation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_02_CopyRemove.html">Unix Tutorial #2: Copying and Removing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_03_ReadingTextFiles.html">Unix Tutorial #3: Reading Text Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_04_ShellsVariables.html">Unix Tutorial #4: Shells and Path Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_05_ForLoops.html">Unix Tutorial #5: For-Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_06_IfElse.html">Unix Tutorial #6: Conditional Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_07_Scripting.html">Unix Tutorial #7: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_08_Sed.html">Unix Tutorial #8: The Sed Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_09_AutomatingTheAnalysis.html">Unix Tutorial #9: Automating The Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Short Course with FSL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_Intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_01_DataDownload.html">fMRI Tutorial #1: Downloading the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_02_ExperimentalDesign.html">fMRI Tutorial #2: Overview of The Flanker Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_03_LookingAtTheData.html">fMRI Tutorial #3: Looking at the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_04_Preprocessing.html">fMRI Tutorial #4: Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_05_1stLevelAnalysis.html">fMRI Tutorial #5: Statistics and Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_06_Scripting.html">fMRI Tutorial #6: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_07_2ndLevelAnalysis.html">fMRI Tutorial #7: 2nd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_08_3rdLevelAnalysis.html">fMRI Tutorial #8: 3rd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_09_ROIAnalysis.html">fMRI Tutorial #9: ROI Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_10_Summary.html">fMRI Tutorial #10: Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_Appendices.html">fMRI Short Course: Appendices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FreeSurfer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FreeSurfer/FreeSurfer_Introduction.html">FreeSurfer Short Course</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">E-Prime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../E-Prime/E-Prime_Overview.html">Overview of E-Prime</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AFNI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../AFNI/AFNI_Overview.html">AFNI Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SPM</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../SPM_Overview.html">SPM Overview</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../SPM_Overview.html#what-is-spm">What is SPM?</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="SPM_fMRI_Intro.html">Introduction to SPM</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_01_DataDownload.html">SPM Tutorial #1: Downloading the Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_02_Flanker.html">SPM Tutorial #2: The Flanker Task</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_03_LookingAtData.html">SPM Tutorial #3: Looking at the Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_04_Preprocessing.html">SPM Tutorial #4: Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_05_1stLevelAnalysis.html">SPM Tutorial #5: Statistics and Modeling</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_06_Scripting.html">SPM Tutorial #6: Scripting</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_07_SettingTheOrigin.html">SPM Tutorial #7: Setting the Origin</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_08_GroupAnalysis.html">SPM Tutorial #8: Group Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_Intermezzo_Toolboxes.html">SPM Intermezzo: Toolboxes</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_09_ROIAnalysis.html">SPM Tutorial #9: ROI Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="SummaryStatistics.html">Appendix A: Summary Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="SPM_PPI.html">Appendix B: Psychophysiological Interactions (PPI) in SPM</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Appendix C: Parametric Modulation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preprocessing-the-data">Preprocessing the Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-second-level-analysis">Setting up the Second-Level Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#next-steps">Next Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#video">Video</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="AppendixD_DesignOptimization.html">Appendix D: DesignOptimization</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functional Connectivity with the CONN Toolbox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FunctionalConnectivity/CONN_Overview.html">Functional Connectivity and the CONN Toolbox</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parametric Modulation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PM/PM_Overview.html">Parametric Modulation in SPM, FSL, and AFNI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Image Visualization with MRIcroGL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRIcroGL/MRIcroGL_Overview.html">Image Visualization with MRIcroGL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction to the Human Connectome Project (HCP)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../HCP/HCP_Overview.html">Introduction to the Human Connectome Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Finite Impulse Response (FIR) Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FIR/FIR_Overview.html">Finite Impulse Response (FIR)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Practicals/DesignOptimization.html">Design Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Diffusion Analysis with MRtrix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRtrix/MRtrix_Introduction.html">Introduction to MRtrix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ASL Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/ASL_Techniques.html">fASL Tutorial #1: Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_02_Download.html">fASL Tutorial #2: Downloading and Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_03_Task.html">fASL Tutorial #3: The N-Back Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/04_fASL_GUI.html">fASL Tutorial #4: The GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/05_fASL_Results.html">fASL Tutorial #5: Examining the Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/06_fASL_Quantification.html">fASL Tutorial #6: Quantification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Frequently Asked Questions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FrequentlyAskedQuestions/FrequentlyAskedQuestions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Statistics/GIMME.html">GIMME (Group Iterative Multiple Model Estimation)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Open Science</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../OpenScience/OS_Overview.html">Open Science</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Normalization Tools (ANTs)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ANTs/ANTs_Overview.html">Advanced Normalization Tools (ANTs)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tract-Based Spatial Statistics (TBSS)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../TBSS/TBSS_Overview.html">Introduction to Tract-Based Spatial Statistics (TBSS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Stats/Stats_Overview.html">Statistics for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machine Learning for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ML/ML_Overview.html">Machine Learning for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Slicer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Slicer/Slicer_Overview.html">Slicer Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CAT12</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CAT12/CAT12_Overview.html">Voxel-Based Morphometry with CAT12</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using the Supercomputer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Supercomputer/Supercomputer_Overview.html">Introduction to Supercomputing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Matlab for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Matlab/Matlab_Overview.html">Matlab for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ITK-Snap</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ITK-Snap/ITK-Snap_Overview.html">ITK-Snap_Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PythonForNeuroimagers/PythonForNeuroimagers_Overview.html">Python for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta-Analysis for fMRI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MetaAnalysis/MetaAnalysis_Overview.html">Meta-Analysis for Neuroimagers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Andy's Brain Book</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../SPM_Overview.html">SPM Overview</a></li>
      <li class="breadcrumb-item active">Appendix C: Parametric Modulation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/SPM/SPM_Short_Course/AppendixC_ParametricModulation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="appendix-c-parametric-modulation">
<span id="appendixc-parametricmodulation"></span><h1>Appendix C: Parametric Modulation<a class="headerlink" href="#appendix-c-parametric-modulation" title="Link to this heading"></a></h1>
<hr class="docutils" />
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>This tutorial will show you how to set up a parametric modulation analysis in SPM. A review of parametric modulation, as well as the dataset we will be analyzing, can be found <a class="reference internal" href="../../PM/PM_Overview.html#pm-overview"><span class="std std-ref">here</span></a>. This tutorial will focus on preprocessing the data and using the parametric modulators in the general linear model.</p>
</section>
<section id="preprocessing-the-data">
<h2>Preprocessing the Data<a class="headerlink" href="#preprocessing-the-data" title="Link to this heading"></a></h2>
<hr class="docutils" />
<section id="creating-the-timing-files">
<h3>Creating the Timing Files<a class="headerlink" href="#creating-the-timing-files" title="Link to this heading"></a></h3>
<p>We will first create timing files that contain onsets for the Gamble, the parametric value for the potential Gain, and the parametric value for the potential Loss, for each run; in total, we will create nine regressors.</p>
<p>You can download a script to convert the timings into a format that SPM understands by clicking <a class="reference external" href="https://github.com/andrewjahn/FSL_Scripts/blob/master/make_FSL_Timings_Gambles.sh">here</a>, clicking on the <code class="docutils literal notranslate"><span class="pre">Raw</span></code> button, and right-clicking anywhere on the screen and selecting <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">As</span></code>. Save the file as a shell script into the <code class="docutils literal notranslate"><span class="pre">Gambles</span></code> directory. Once it has been downloaded, navigate to that directory with a Terminal and run the script by typing <code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">make_FSL_Timings_Gambles.sh</span></code>. You should see nine text files in each <code class="docutils literal notranslate"><span class="pre">func</span></code> directory:</p>
<figure class="align-default">
<img alt="../../_images/Appendix_F_Onsets.png" src="../../_images/Appendix_F_Onsets.png" />
</figure>
</section>
<section id="creating-the-preprocessing-script">
<h3>Creating the Preprocessing Script<a class="headerlink" href="#creating-the-preprocessing-script" title="Link to this heading"></a></h3>
<p>Similar to the <a class="reference internal" href="SPM_06_Scripting.html#spm-06-scripting"><span class="std std-ref">scripting section</span></a> of the SPM tutorial, we will create a Batch script that can be used in a for-loop to analyze all of our subjects. Assuming you are familiar already with the details of preprocessing, we won’t go over how to fill in each of the fields; however, for this dataset, note that the functional and anatomical data for subject 01 need to be reoriented in order to normalize the brain appropriately. From the Matlab terminal, navigate into both the <code class="docutils literal notranslate"><span class="pre">anat</span></code> and <code class="docutils literal notranslate"><span class="pre">func</span></code> directories and unzip the files with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gunzip</span> <span class="o">*.</span><span class="n">gz</span>
</pre></div>
</div>
<p>Then, open the SPM GUI, click on the <code class="docutils literal notranslate"><span class="pre">Display</span></code> button, and select <code class="docutils literal notranslate"><span class="pre">sub-01_task-mixedgamblestask_run-01_bold.nii</span></code>. This subject’s images are tilted forward in the “pitch” orientation; let’s undo this by typing <code class="docutils literal notranslate"><span class="pre">6</span></code> in the <code class="docutils literal notranslate"><span class="pre">pitch</span> <span class="pre">(rad)</span></code> field, and setting the origin at the anterior commissure; click on <code class="docutils literal notranslate"><span class="pre">Reorient</span></code> and apply these transformations to all of the functional images. Then, open the anatomical image in the same display window, and set the origin at the anterior commissure. The rest of the steps should run without any errors.</p>
<p>To prepare the data for a parametric modulation analysis, we will create a preprocessing pipeline similar to the one we used for the example dataset <a class="reference internal" href="../SPM_Overview.html#spm-overview"><span class="std std-ref">here</span></a>. If you haven’t already, go through the tutorial with the Flanker dataset; there you can find the details of each preprocessing and statistical analysis step, which we won’t discuss here in depth; the modules of coregistration, slice-timing correction, and normalization are virtually identical. The only major difference is in the model setup, which has one condition per run - here, labeled “Gamble” - and two parametric modulators, Gain and Loss. We set the polynomial expansion to 1st order, and switch the <code class="docutils literal notranslate"><span class="pre">Orthogonalise</span> <span class="pre">modulations</span></code> option from <code class="docutils literal notranslate"><span class="pre">Yes</span></code> to <code class="docutils literal notranslate"><span class="pre">No</span></code>. This last step is important; the default of <code class="docutils literal notranslate"><span class="pre">Yes</span></code> will orthogonalize all of the parametric modulators with respect to the first one, which means that it becomes extremely (and artificially) difficult to generate a significant result for any of the modulators besides the first one. For a detailed discussion about why this is the case, see <a class="reference external" href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0126255">this paper</a> by Jeanette Mumford.</p>
<p>At this point, you would save the Batch file and edit the matlab script to turn it into a for-loop; an edited script has already been created <a class="reference external" href="https://github.com/andrewjahn/SPM_Scripts/blob/master/run1stLevelAnalysis_job_PM.m">here</a>, which you can download by clicking on <code class="docutils literal notranslate"><span class="pre">Raw</span></code>, right-clicking anywhere on the screen, and selecting <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">As</span></code>. Save it to your <code class="docutils literal notranslate"><span class="pre">Gambles</span></code> directory, removing the “.txt” extension. Then, from the Matlab terminal, make sure you are in the <code class="docutils literal notranslate"><span class="pre">Gambles</span></code> directory, and type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">run1stLevelAnalysis_job_PM</span>
</pre></div>
</div>
<p>This will start preprocessing and analyzing all of the subjects, and it will take about three to four hours.</p>
</section>
</section>
<section id="setting-up-the-second-level-analysis">
<h2>Setting up the Second-Level Analysis<a class="headerlink" href="#setting-up-the-second-level-analysis" title="Link to this heading"></a></h2>
<p>For our group analysis, we will create two directories, one for the parametric modulation of Gain and one for the parametric modulation of Loss. From the Matlab terminal, type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="mi">2</span><span class="n">ndLevel_GainPM</span>
<span class="n">mkdir</span> <span class="mi">2</span><span class="n">ndLevel_LossPM</span>
</pre></div>
</div>
<p>Then, click on <code class="docutils literal notranslate"><span class="pre">Specify</span> <span class="pre">2nd-level</span></code> from the SPM GUI, and for the <code class="docutils literal notranslate"><span class="pre">Directory</span></code> field select <code class="docutils literal notranslate"><span class="pre">2ndLevel_GainPM</span></code>. Within <code class="docutils literal notranslate"><span class="pre">Scans</span></code>, use the filter field to select <code class="docutils literal notranslate"><span class="pre">con_0001.nii</span></code>, which is the contrast for the Gain modulator, and then click the <code class="docutils literal notranslate"><span class="pre">Go</span></code> button. Estimate the model, and then click on <code class="docutils literal notranslate"><span class="pre">Results</span></code>; type <code class="docutils literal notranslate"><span class="pre">GainPM</span></code> for the name, and give it a contrast weight of +1. Click <code class="docutils literal notranslate"><span class="pre">OK</span></code>, and set the following parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Apply</span> <span class="n">masking</span> <span class="o">-&gt;</span> <span class="n">none</span>
<span class="n">p</span> <span class="n">value</span> <span class="n">adjustment</span> <span class="n">to</span> <span class="n">control</span> <span class="o">-&gt;</span> <span class="n">none</span> <span class="o">-&gt;</span> <span class="mf">0.001</span>
<span class="n">extent</span> <span class="n">threshold</span> <span class="p">(</span><span class="n">voxels</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="mi">50</span>
</pre></div>
</div>
<p>These thresholds have been chosen ad hoc, but they should be close to giving you a cluster false positive rate of p=0.05. Click on <code class="docutils literal notranslate"><span class="pre">overlays</span> <span class="pre">-&gt;</span> <span class="pre">sections</span></code> and select a template from the <code class="docutils literal notranslate"><span class="pre">canonical</span></code> directory of your SPM folder. You should see an activation map like this, with significant clusters within the ventral striatum:</p>
<figure class="align-default">
<img alt="../../_images/AppendixC_GainPM.png" src="../../_images/AppendixC_GainPM.png" />
</figure>
<p>Now do the same procedure for the Loss parametric modulators, which should be the image con_0002.nii. In the <code class="docutils literal notranslate"><span class="pre">Results</span></code> window, give it a weight of -1, using the same parameters as before. Compare both of your results to Tom et al., 2007, and observe whether there is a similar pattern.</p>
<figure class="align-default">
<img alt="../../_images/AppendixC_LossPM.png" src="../../_images/AppendixC_LossPM.png" />
</figure>
<figure class="align-default" id="id1">
<img alt="../../_images/Appendix_F_Tom_Results.png" src="../../_images/Appendix_F_Tom_Results.png" />
<figcaption>
<p><span class="caption-text">The original results from Tom et al., 2007.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading"></a></h2>
<p>You may have noticed that the extent of the results is not the same as it was in the original Tom et al. paper. One option to enhance the results is to instead use Threshold-Free Cluster Enhancement (TFCE), as outlined in this chapter. If you have FSL installed, you could merge all of the con_0001.nii images, for example, by typing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>fslmerge -t allCon_0001s.nii.gz `ls $PWD/sub-??/1stLevel/con_0001*`
</pre></div>
</div>
<p>And then running randomise with the TFCE option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">randomise</span> <span class="o">-</span><span class="n">i</span> <span class="n">allCon_0001s</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="o">-</span><span class="n">o</span> <span class="n">allCon_0001s_randomise</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="n">T</span> <span class="o">-</span><span class="n">n</span> <span class="mi">5000</span>
</pre></div>
</div>
<p>You can then load the file <code class="docutils literal notranslate"><span class="pre">allZs_randomise_tfce_corrp_tstat1</span></code> in fsleyes, and change the <code class="docutils literal notranslate"><span class="pre">Min.</span></code> threshold of 0.95. This will show all of the TFCE clusters at an alpha threshold of p=0.05. Note how many more clusters there are, and how these were hidden with the traditional SPM approach.</p>
</section>
<section id="video">
<h2>Video<a class="headerlink" href="#video" title="Link to this heading"></a></h2>
<p>For a screencast of how to set up a parametric modulation analysis in SPM, click <a class="reference external" href="https://youtu.be/EjmJ412SQM8">here</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="SPM_PPI.html" class="btn btn-neutral float-left" title="Appendix B: Psychophysiological Interactions (PPI) in SPM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="AppendixD_DesignOptimization.html" class="btn btn-neutral float-right" title="Appendix D: DesignOptimization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Andy Jahn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>