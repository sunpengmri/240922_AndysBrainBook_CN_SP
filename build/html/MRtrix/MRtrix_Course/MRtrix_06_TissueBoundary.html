<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MRtrix Tutorial #6: Creating the Tissue Boundaries &mdash; Andy&#39;s Brain Book 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="MRtrix Tutorial #7: Streamlines" href="MRtrix_07_Streamlines.html" />
    <link rel="prev" title="MRtrix Tutorial #5: Constrained Spherical Deconvolution" href="MRtrix_05_BasisFunctions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Andy's Brain Book
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/fsl_mac_install.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unix for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_Intro.html">What is Unix?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_01_Navigation.html">Unix Tutorial #1: 目录操作 (Directories and Navigation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_02_CopyRemove.html">Unix Tutorial #2: Copying and Removing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_03_ReadingTextFiles.html">Unix Tutorial #3: Reading Text Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_04_ShellsVariables.html">Unix Tutorial #4: Shells and Path Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_05_ForLoops.html">Unix Tutorial #5: For-Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_06_IfElse.html">Unix Tutorial #6: Conditional Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_07_Scripting.html">Unix Tutorial #7: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_08_Sed.html">Unix Tutorial #8: The Sed Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_09_AutomatingTheAnalysis.html">Unix Tutorial #9: Automating The Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Short Course with FSL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_Intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_01_DataDownload.html">fMRI Tutorial #1: Downloading the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_02_ExperimentalDesign.html">fMRI Tutorial #2: Overview of The Flanker Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_03_LookingAtTheData.html">fMRI Tutorial #3: Looking at the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_04_Preprocessing.html">fMRI Tutorial #4: Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_05_1stLevelAnalysis.html">fMRI Tutorial #5: Statistics and Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_06_Scripting.html">fMRI Tutorial #6: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_07_2ndLevelAnalysis.html">fMRI Tutorial #7: 2nd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_08_3rdLevelAnalysis.html">fMRI Tutorial #8: 3rd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_09_ROIAnalysis.html">fMRI Tutorial #9: ROI Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_10_Summary.html">fMRI Tutorial #10: Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_Appendices.html">fMRI Short Course: Appendices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FreeSurfer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FreeSurfer/FreeSurfer_Introduction.html">FreeSurfer Short Course</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">E-Prime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../E-Prime/E-Prime_Overview.html">Overview of E-Prime</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AFNI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../AFNI/AFNI_Overview.html">AFNI Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SPM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../SPM/SPM_Overview.html">SPM Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functional Connectivity with the CONN Toolbox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FunctionalConnectivity/CONN_Overview.html">Functional Connectivity and the CONN Toolbox</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parametric Modulation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PM/PM_Overview.html">Parametric Modulation in SPM, FSL, and AFNI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Image Visualization with MRIcroGL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRIcroGL/MRIcroGL_Overview.html">Image Visualization with MRIcroGL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction to the Human Connectome Project (HCP)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../HCP/HCP_Overview.html">Introduction to the Human Connectome Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Finite Impulse Response (FIR) Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FIR/FIR_Overview.html">Finite Impulse Response (FIR)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Practicals/DesignOptimization.html">Design Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Diffusion Analysis with MRtrix</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../MRtrix_Introduction.html">Introduction to MRtrix</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../MRtrix_Introduction.html#what-is-mrtrix">What is MRtrix?</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../MRtrix_Introduction.html#goals-of-this-course">Goals of This Course</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="MRtrix_00_Diffusion_Overview.html">MRtrix Introduction: Overview of Diffusion Imaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="MRtrix_01_Download_Install.html">MRtrix Tutorial #1: Download and Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="MRtrix_02_DataDownload.html">MRtrix Tutorial #2: Downloading the Dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="MRtrix_03_DataFormats.html">MRtrix Tutorial #3: Looking at the Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="MRtrix_04_Preprocessing.html">MRtrix Tutorial #4: Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="MRtrix_05_BasisFunctions.html">MRtrix Tutorial #5: Constrained Spherical Deconvolution</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">MRtrix Tutorial #6: Creating the Tissue Boundaries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#converting-the-anatomical-image">Converting the Anatomical Image</a></li>
<li class="toctree-l4"><a class="reference internal" href="#coregistering-the-diffusion-and-anatomical-images">Coregistering the Diffusion and Anatomical Images</a></li>
<li class="toctree-l4"><a class="reference internal" href="#video">Video</a></li>
<li class="toctree-l4"><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="MRtrix_07_Streamlines.html">MRtrix Tutorial #7: Streamlines</a></li>
<li class="toctree-l3"><a class="reference internal" href="MRtrix_08_Connectome.html">MRtrix Tutorial #8: Creating and Viewing the Connectome</a></li>
<li class="toctree-l3"><a class="reference internal" href="MRtrix_09_Scripting.html">MRtrix Tutorial #9: Scripting</a></li>
<li class="toctree-l3"><a class="reference internal" href="MRtrix_10_GroupAnalysis.html">MRtrix Tutorial #10: Group-Level Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="MRtrix_11_FixelBasedAnalysis.html">MRtrix Tutorial #11: Fixel-Based Analysis</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ASL Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/ASL_Techniques.html">fASL Tutorial #1: Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_02_Download.html">fASL Tutorial #2: Downloading and Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_03_Task.html">fASL Tutorial #3: The N-Back Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/04_fASL_GUI.html">fASL Tutorial #4: The GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/05_fASL_Results.html">fASL Tutorial #5: Examining the Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/06_fASL_Quantification.html">fASL Tutorial #6: Quantification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Frequently Asked Questions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FrequentlyAskedQuestions/FrequentlyAskedQuestions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Statistics/GIMME.html">GIMME (Group Iterative Multiple Model Estimation)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Open Science</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../OpenScience/OS_Overview.html">Open Science</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Normalization Tools (ANTs)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ANTs/ANTs_Overview.html">Advanced Normalization Tools (ANTs)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tract-Based Spatial Statistics (TBSS)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../TBSS/TBSS_Overview.html">Introduction to Tract-Based Spatial Statistics (TBSS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Stats/Stats_Overview.html">Statistics for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machine Learning for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ML/ML_Overview.html">Machine Learning for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Slicer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Slicer/Slicer_Overview.html">Slicer Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CAT12</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CAT12/CAT12_Overview.html">Voxel-Based Morphometry with CAT12</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using the Supercomputer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Supercomputer/Supercomputer_Overview.html">Introduction to Supercomputing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Matlab for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Matlab/Matlab_Overview.html">Matlab for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ITK-Snap</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ITK-Snap/ITK-Snap_Overview.html">ITK-Snap_Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PythonForNeuroimagers/PythonForNeuroimagers_Overview.html">Python for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta-Analysis for fMRI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MetaAnalysis/MetaAnalysis_Overview.html">Meta-Analysis for Neuroimagers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Andy's Brain Book</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../MRtrix_Introduction.html">Introduction to MRtrix</a></li>
      <li class="breadcrumb-item active">MRtrix Tutorial #6: Creating the Tissue Boundaries</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/MRtrix/MRtrix_Course/MRtrix_06_TissueBoundary.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mrtrix-tutorial-6-creating-the-tissue-boundaries">
<span id="mrtrix-06-tissueboundary"></span><h1>MRtrix Tutorial #6: Creating the Tissue Boundaries<a class="headerlink" href="#mrtrix-tutorial-6-creating-the-tissue-boundaries" title="Link to this heading"></a></h1>
<hr class="docutils" />
<p>We are almost ready to begin our streamline analysis, in which we will place <strong>seeds</strong> at random locations along the boundary between the grey matter and the white matter. A streamline will grow from each seed and trace a path from that seed region until it terminates in another region. Some of the streamlines will terminate in places that don’t make sense - for example, a streamline may terminate at the border of the ventricles. We will cull these “error” streamlines, and be left with a majority of streamlines that appear to connect distant grey matter regions.</p>
<p>To do this, we will first need to create a <strong>boundary</strong> between the grey matter and the white matter. The MRtrix command <code class="docutils literal notranslate"><span class="pre">5ttgen</span></code> will use FSL’s FAST, along with other commands, to segment the anatomical image into five tissue types:</p>
<ol class="arabic simple">
<li><p>Grey Matter;</p></li>
<li><p>Subcortical Grey Matter (such as the amygdala and basal ganglia);</p></li>
<li><p>White Matter;</p></li>
<li><p>Cerebrospinal Fluid; and</p></li>
<li><p>Pathological Tissue.</p></li>
</ol>
<p>Once we have segmented the brain into those tissue classes, we can then use the boundary as a mask to restrict where we will place our seeds.</p>
<section id="converting-the-anatomical-image">
<h2>Converting the Anatomical Image<a class="headerlink" href="#converting-the-anatomical-image" title="Link to this heading"></a></h2>
<p>The anatomical image first needs to be converted to MRtrix format. Just as we did in a previous chapter, we will use the command <code class="docutils literal notranslate"><span class="pre">mrconvert</span></code>. If you are in the <code class="docutils literal notranslate"><span class="pre">dwi</span></code> directory, you can type the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mrconvert</span> <span class="o">../</span><span class="n">anat</span><span class="o">/</span><span class="n">sub</span><span class="o">-</span><span class="n">CON02_ses</span><span class="o">-</span><span class="n">preop_T1w</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="n">T1</span><span class="o">.</span><span class="n">mif</span>
</pre></div>
</div>
<p>This creates a new file, <code class="docutils literal notranslate"><span class="pre">T1.mif</span></code>, which you can look at in mrview.</p>
<p>We will now use the command <code class="docutils literal notranslate"><span class="pre">5ttgen</span></code> to segment the anatomical image into the tissue types listed above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">5</span><span class="n">ttgen</span> <span class="n">fsl</span> <span class="n">T1</span><span class="o">.</span><span class="n">mif</span> <span class="mi">5</span><span class="n">tt_nocoreg</span><span class="o">.</span><span class="n">mif</span>
</pre></div>
</div>
<p>This command will take about 10-15 minutes. If the segmentation has finished successfully, you should see the following images when you type <code class="docutils literal notranslate"><span class="pre">mrview</span> <span class="pre">5tt_nocoreg.mif</span></code> (pressing the left and right arrow keys scrolls through the different tissue types):</p>
<figure class="align-default" id="id1">
<img alt="../../_images/06_TissueTypes.png" src="../../_images/06_TissueTypes.png" />
<figcaption>
<p><span class="caption-text">The output from <code class="docutils literal notranslate"><span class="pre">5ttgen</span> <span class="pre">fsl</span> <span class="pre">anat.mif</span> <span class="pre">5tt_nocoreg.mif</span></code> will be a single dataset with 5 volumes, one per tissue type. Check this image with mrview, using the right and left arrow keys to toggle between tissue types. The tissue types are: GM, WM, CSF, subcortical GM, and pathological tissue. If no pathological tissue is detected, then that volume is blank.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the segmentation step fails, this may be due to insufficient contrast between the tissue types; for example, some anatomical images are either very dark across both the grey and white matter, or very light across both tissue types. We can help the segmentation process by increasing the intensity contrast (also known as <strong>intensity normalization</strong>) between the tissues with a command like AFNI’s 3dUnifize, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span><span class="n">dUnifize</span> <span class="o">-</span><span class="nb">input</span> <span class="n">anat</span><span class="o">.</span><span class="n">nii</span> <span class="o">-</span><span class="n">prefix</span> <span class="n">anat_unifize</span><span class="o">.</span><span class="n">nii</span>
</pre></div>
</div>
<p>The difference between the image before and after may be subtle, but it can prevent a segmentation error from being thrown.</p>
</div>
</section>
<section id="coregistering-the-diffusion-and-anatomical-images">
<h2>Coregistering the Diffusion and Anatomical Images<a class="headerlink" href="#coregistering-the-diffusion-and-anatomical-images" title="Link to this heading"></a></h2>
<p>If the segmentation has finished without any errors, our next step is to coregister the anatomical and diffusion-weighted images. This ensures that the boundaries of the tissue types are aligned with the boundaries of the diffusion-weighted images; even small differences in the location of the two scans can throw off the tractography results.</p>
<p>We will first use the commands <code class="docutils literal notranslate"><span class="pre">dwiextract</span></code> and <code class="docutils literal notranslate"><span class="pre">mrmath</span></code> to average together the B0 images from the diffusion data. These are the images that look most like T2-weighted functional scans, since a diffusion gradient wasn’t applied during their acquisition - in other words, they were acquired with a b-value of zero. To see how this works, navigate back to the <code class="docutils literal notranslate"><span class="pre">dwi</span></code> directory and type the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dwiextract</span> <span class="n">sub</span><span class="o">-</span><span class="mi">02</span><span class="n">_den_preproc_unbiased</span><span class="o">.</span><span class="n">mif</span> <span class="o">-</span> <span class="o">-</span><span class="n">bzero</span> <span class="o">|</span> <span class="n">mrmath</span> <span class="o">-</span> <span class="n">mean</span> <span class="n">mean_b0</span><span class="o">.</span><span class="n">mif</span> <span class="o">-</span><span class="n">axis</span> <span class="mi">3</span>
</pre></div>
</div>
<p>There are two parts to this command, separated by a pipe (”<code class="docutils literal notranslate"><span class="pre">|</span></code>”). The left half of the command, <code class="docutils literal notranslate"><span class="pre">dwiextract</span></code>, takes the preprocessed diffusion-weighted image as an input, and the <code class="docutils literal notranslate"><span class="pre">-bzero</span></code> option extracts the B0 images; the solitary <code class="docutils literal notranslate"><span class="pre">-</span></code> argument indicates that the output should be used as input for the second part of the command, to the right of the pipe. <code class="docutils literal notranslate"><span class="pre">mrmath</span></code> then takes these output B0 images and computes the mean along the 3rd axis, or the time dimension. In other words, if we start with an index of 0, then the number 3 indicates the 4th dimension, which simply means to average over all of the volumes.</p>
<p>In order to carry out the coregistration between the diffusion and anatomical images, we will need to take a brief detour outside of MRtrix. The software package doesn’t have a coregistration command in its library, so we will need to use another software package’s commands instead. Although you can choose any one you want, we will focus here on FSL’s <code class="docutils literal notranslate"><span class="pre">flirt</span></code> command.</p>
<p>The first step is to convert both the segmented anatomical image and the B0 images we just extracted:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mv</span> <span class="o">../</span><span class="n">anat</span><span class="o">/</span><span class="mi">5</span><span class="n">tt_nocoreg</span><span class="o">.</span><span class="n">mif</span> <span class="o">.</span>
<span class="n">mrconvert</span> <span class="n">mean_b0</span><span class="o">.</span><span class="n">mif</span> <span class="n">mean_b0</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span>
<span class="n">mrconvert</span> <span class="mi">5</span><span class="n">tt_nocoreg</span><span class="o">.</span><span class="n">mif</span> <span class="mi">5</span><span class="n">tt_nocoreg</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">flirt</span></code> can only work with a single 3D image (not 4D datasets), we will use <code class="docutils literal notranslate"><span class="pre">fslroi</span></code> to extract the first volume of the segmented dataset, which corresponds to the Grey Matter segmentation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fslroi</span> <span class="mi">5</span><span class="n">tt_nocoreg</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="mi">5</span><span class="n">tt_vol0</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="mi">0</span> <span class="mi">1</span>
</pre></div>
</div>
<p>We then use the <code class="docutils literal notranslate"><span class="pre">flirt</span></code> command to coregister the two datasets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flirt</span> <span class="o">-</span><span class="ow">in</span> <span class="n">mean_b0</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="o">-</span><span class="n">ref</span> <span class="mi">5</span><span class="n">tt_vol0</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="o">-</span><span class="n">interp</span> <span class="n">nearestneighbour</span> <span class="o">-</span><span class="n">dof</span> <span class="mi">6</span> <span class="o">-</span><span class="n">omat</span> <span class="n">diff2struct_fsl</span><span class="o">.</span><span class="n">mat</span>
</pre></div>
</div>
<p>This command uses the grey matter segmentation (i.e., “5tt_vol0.nii.gz”) as the reference image, meaning that it stays stationary. The averaged B0 images are then moved to find the best fit with the grey matter segmentation. The output of this command, “diff2struct_fsl.mat”, contains the <strong>transformation matrix</strong> that was used to overlay the diffusion image on top of the grey matter segmentation.</p>
<p>Now that we have generated our transformation matrix, we will need to convert it into a format that can be read by MRtrix. That is, we are now ready to travel back into MRtrix after briefly stepping outside of it. The command <code class="docutils literal notranslate"><span class="pre">transformconvert</span></code> does this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">transformconvert</span> <span class="n">diff2struct_fsl</span><span class="o">.</span><span class="n">mat</span> <span class="n">mean_b0</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="mi">5</span><span class="n">tt_nocoreg</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="n">flirt_import</span> <span class="n">diff2struct_mrtrix</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>Note that the above steps used the anatomical segmentation as the reference image. We did this because usually the coregistration is more accurate if the reference image has higher spatial resolution and sharper distinction between the tissue types. However, we also want to introduce as few edits and interpolations to the functional data as possible during preprocessing. Therefore, since we already have the steps to transform the diffusion image to the anatomical image, we can take the inverse of the transformation matrix to do the opposite - i.e., coregister the anatomical image to the diffusion image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mrtransform</span> <span class="mi">5</span><span class="n">tt_nocoreg</span><span class="o">.</span><span class="n">mif</span> <span class="o">-</span><span class="n">linear</span> <span class="n">diff2struct_mrtrix</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">inverse</span> <span class="mi">5</span><span class="n">tt_coreg</span><span class="o">.</span><span class="n">mif</span>
</pre></div>
</div>
<p>The resulting file, “5tt_coreg.mif”, can be loaded into <code class="docutils literal notranslate"><span class="pre">mrview</span></code> in order to examine the quality of the coregistration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mrview</span> <span class="n">sub</span><span class="o">-</span><span class="mi">02</span><span class="n">_den_preproc_unbiased</span><span class="o">.</span><span class="n">mif</span> <span class="o">-</span><span class="n">overlay</span><span class="o">.</span><span class="n">load</span> <span class="mi">5</span><span class="n">tt_nocoreg</span><span class="o">.</span><span class="n">mif</span> <span class="o">-</span><span class="n">overlay</span><span class="o">.</span><span class="n">colourmap</span> <span class="mi">2</span> <span class="o">-</span><span class="n">overlay</span><span class="o">.</span><span class="n">load</span> <span class="mi">5</span><span class="n">tt_coreg</span><span class="o">.</span><span class="n">mif</span> <span class="o">-</span><span class="n">overlay</span><span class="o">.</span><span class="n">colourmap</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The “overlay.colourmap” options specify different color codes for each image that is loaded. In this case, the boundaries before coregistration will be depicted in blue, and the boundaries after coregistration will be shown in red:</p>
<figure class="align-default" id="id2">
<img alt="../../_images/06_GM_Alignment.png" src="../../_images/06_GM_Alignment.png" />
<figcaption>
<p><span class="caption-text">The change in the boundaries before and after coregistration may be very slight, but they will have a large effect on the rest of the steps that we do. Make sure to check the boundaries in all three views; you can also use the <code class="docutils literal notranslate"><span class="pre">Tool</span> <span class="pre">-&gt;</span> <span class="pre">Overlay</span></code> menu to display or hide the different overlays.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The last step to create the “seed” boundary - the boundary separating the grey from the white matter, which we will use to create the seeds for our streamlines - is created with the command <code class="docutils literal notranslate"><span class="pre">5tt2gmwmi</span></code> (which stands for “5 Tissue Type (segmentation) to Grey Matter / White Matter Interface)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">5</span><span class="n">tt2gmwmi</span> <span class="mi">5</span><span class="n">tt_coreg</span><span class="o">.</span><span class="n">mif</span> <span class="n">gmwmSeed_coreg</span><span class="o">.</span><span class="n">mif</span>
</pre></div>
</div>
<p>Again, we will check the result with <code class="docutils literal notranslate"><span class="pre">mrview</span></code> to make sure the interface is where we think it should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mrview</span> <span class="n">sub</span><span class="o">-</span><span class="mi">02</span><span class="n">_den_preproc_unbiased</span><span class="o">.</span><span class="n">mif</span> <span class="o">-</span><span class="n">overlay</span><span class="o">.</span><span class="n">load</span> <span class="n">gmwmSeed_coreg</span><span class="o">.</span><span class="n">mif</span>
</pre></div>
</div>
<p>You should see something like this at the end:</p>
<figure class="align-default">
<img alt="../../_images/06_GMWMI.png" src="../../_images/06_GMWMI.png" />
</figure>
</section>
<section id="video">
<h2>Video<a class="headerlink" href="#video" title="Link to this heading"></a></h2>
<p>A video walkthrough of creating the tissue boundaries can be found <a class="reference external" href="https://www.youtube.com/watch?v=A2ZyGE5BcfE">here</a>.</p>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading"></a></h2>
<p>Now that we have determined where the boundary is between the grey matter and the white matter, we are ready to begin generating <strong>streamlines</strong> in order to reconstruct the major white matter pathways of the brain. We will see how to do that in the next chapter.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="MRtrix_05_BasisFunctions.html" class="btn btn-neutral float-left" title="MRtrix Tutorial #5: Constrained Spherical Deconvolution" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="MRtrix_07_Streamlines.html" class="btn btn-neutral float-right" title="MRtrix Tutorial #7: Streamlines" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Andy Jahn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>