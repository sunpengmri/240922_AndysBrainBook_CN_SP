<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Appendix F: Parametric Modulation &mdash; Andy&#39;s Brain Book 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Appendix G: Reverse Inference" href="Appendix_G_ReverseInference.html" />
    <link rel="prev" title="Appendix E: Meta-Analysis" href="Appendix_E_Meta_Analysis.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Andy's Brain Book
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/fsl_mac_install.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unix for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_Intro.html">What is Unix?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_01_Navigation.html">Unix Tutorial #1: 目录操作 (Directories and Navigation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_02_CopyRemove.html">Unix Tutorial #2: Copying and Removing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_03_ReadingTextFiles.html">Unix Tutorial #3: Reading Text Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_04_ShellsVariables.html">Unix Tutorial #4: Shells and Path Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_05_ForLoops.html">Unix Tutorial #5: For-Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_06_IfElse.html">Unix Tutorial #6: Conditional Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_07_Scripting.html">Unix Tutorial #7: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_08_Sed.html">Unix Tutorial #8: The Sed Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_09_AutomatingTheAnalysis.html">Unix Tutorial #9: Automating The Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Short Course with FSL</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../fMRI_Intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_01_DataDownload.html">fMRI Tutorial #1: Downloading the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_02_ExperimentalDesign.html">fMRI Tutorial #2: Overview of The Flanker Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_03_LookingAtTheData.html">fMRI Tutorial #3: Looking at the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_04_Preprocessing.html">fMRI Tutorial #4: Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_05_1stLevelAnalysis.html">fMRI Tutorial #5: Statistics and Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_06_Scripting.html">fMRI Tutorial #6: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_07_2ndLevelAnalysis.html">fMRI Tutorial #7: 2nd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_08_3rdLevelAnalysis.html">fMRI Tutorial #8: 3rd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_09_ROIAnalysis.html">fMRI Tutorial #9: ROI Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fMRI_10_Summary.html">fMRI Tutorial #10: Summary</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../fMRI_Appendices.html">fMRI Short Course: Appendices</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../fMRI_Appendices.html#introduction">Introduction</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Appendix_A_ClusterCorrection.html">Appendix A: Cluster Correction</a></li>
<li class="toctree-l3"><a class="reference internal" href="Appendix_B_BiasedAnalysis.html">Appendix B: Biased Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="Appendix_C_Figures.html">Appendix C: Figures</a></li>
<li class="toctree-l3"><a class="reference internal" href="Appendix_D_OtherStats.html">Appendix D: Other Statistical Scenarios</a></li>
<li class="toctree-l3"><a class="reference internal" href="Appendix_E_Meta_Analysis.html">Appendix E: Meta-Analysis</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Appendix F: Parametric Modulation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preprocessing-the-data">Preprocessing the Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#higher-level-analysis">Higher-Level Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#viewing-the-results">Viewing the Results</a></li>
<li class="toctree-l4"><a class="reference internal" href="#next-steps">Next Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#video">Video</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Appendix_G_ReverseInference.html">Appendix G: Reverse Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="Appendix_H_DoubleDissociations.html">Appendix H: Double Dissociations</a></li>
<li class="toctree-l3"><a class="reference internal" href="Appendix_I_ICA_Denoising.html">Appendix I: Independent Components Analysis (ICA) with FSL and FIX</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FreeSurfer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FreeSurfer/FreeSurfer_Introduction.html">FreeSurfer Short Course</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">E-Prime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../E-Prime/E-Prime_Overview.html">Overview of E-Prime</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AFNI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../AFNI/AFNI_Overview.html">AFNI Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SPM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../SPM/SPM_Overview.html">SPM Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functional Connectivity with the CONN Toolbox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FunctionalConnectivity/CONN_Overview.html">Functional Connectivity and the CONN Toolbox</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parametric Modulation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PM/PM_Overview.html">Parametric Modulation in SPM, FSL, and AFNI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Image Visualization with MRIcroGL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRIcroGL/MRIcroGL_Overview.html">Image Visualization with MRIcroGL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction to the Human Connectome Project (HCP)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../HCP/HCP_Overview.html">Introduction to the Human Connectome Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Finite Impulse Response (FIR) Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FIR/FIR_Overview.html">Finite Impulse Response (FIR)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Practicals/DesignOptimization.html">Design Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Diffusion Analysis with MRtrix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRtrix/MRtrix_Introduction.html">Introduction to MRtrix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ASL Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/ASL_Techniques.html">fASL Tutorial #1: Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_02_Download.html">fASL Tutorial #2: Downloading and Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_03_Task.html">fASL Tutorial #3: The N-Back Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/04_fASL_GUI.html">fASL Tutorial #4: The GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/05_fASL_Results.html">fASL Tutorial #5: Examining the Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/06_fASL_Quantification.html">fASL Tutorial #6: Quantification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Frequently Asked Questions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FrequentlyAskedQuestions/FrequentlyAskedQuestions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Statistics/GIMME.html">GIMME (Group Iterative Multiple Model Estimation)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Open Science</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../OpenScience/OS_Overview.html">Open Science</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Normalization Tools (ANTs)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ANTs/ANTs_Overview.html">Advanced Normalization Tools (ANTs)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tract-Based Spatial Statistics (TBSS)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../TBSS/TBSS_Overview.html">Introduction to Tract-Based Spatial Statistics (TBSS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Stats/Stats_Overview.html">Statistics for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machine Learning for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ML/ML_Overview.html">Machine Learning for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Slicer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Slicer/Slicer_Overview.html">Slicer Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CAT12</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CAT12/CAT12_Overview.html">Voxel-Based Morphometry with CAT12</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using the Supercomputer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Supercomputer/Supercomputer_Overview.html">Introduction to Supercomputing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Matlab for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Matlab/Matlab_Overview.html">Matlab for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ITK-Snap</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ITK-Snap/ITK-Snap_Overview.html">ITK-Snap_Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PythonForNeuroimagers/PythonForNeuroimagers_Overview.html">Python for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta-Analysis for fMRI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MetaAnalysis/MetaAnalysis_Overview.html">Meta-Analysis for Neuroimagers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Andy's Brain Book</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../fMRI_Appendices.html">fMRI Short Course: Appendices</a></li>
      <li class="breadcrumb-item active">Appendix F: Parametric Modulation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/fMRI_Short_Course/fMRI_Appendices/Appendix_F_ParametricModulation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="appendix-f-parametric-modulation">
<span id="appendix-f-parametricmodulation"></span><h1>Appendix F: Parametric Modulation<a class="headerlink" href="#appendix-f-parametric-modulation" title="Link to this heading"></a></h1>
<hr class="docutils" />
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>This appendix demonstrates how to set up a <strong>parametric modulation</strong> analysis in FSL. An overview of what parametric modulation is can be found <a class="reference internal" href="../../PM/PM_Overview.html#pm-overview"><span class="std std-ref">here</span></a>, along with code for downloading the data. If you already have <a class="reference external" href="https://aws.amazon.com/cli/">Amazon Web Services</a> installed, then you can open a Terminal and type the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aws</span> <span class="n">s3</span> <span class="n">sync</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">sign</span><span class="o">-</span><span class="n">request</span> <span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">openneuro</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">ds000005</span> <span class="n">ds000005</span><span class="o">-</span><span class="n">download</span><span class="o">/</span>
<span class="n">mv</span> <span class="o">~/</span><span class="n">Downloads</span><span class="o">/</span><span class="n">ds000005</span><span class="o">-</span><span class="n">download</span> <span class="o">~/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">Gambles</span>
</pre></div>
</div>
<p>This will create a new folder on your Desktop called <code class="docutils literal notranslate"><span class="pre">Gambles</span></code>, which we will use to store the data and the output from our analyses.</p>
</section>
<section id="preprocessing-the-data">
<h2>Preprocessing the Data<a class="headerlink" href="#preprocessing-the-data" title="Link to this heading"></a></h2>
<hr class="docutils" />
<p>To prepare the data for a parametric modulation analysis, we will create a preprocessing pipeline similar to the one we used for the example dataset <a class="reference internal" href="../fMRI_Intro.html#fmri-intro"><span class="std std-ref">here</span></a>. If you haven’t already, go through the tutorial with the Flanker dataset; there you can find the details of each preprocessing and statistical analysis step, which we won’t discuss here in depth.</p>
<section id="creating-the-timing-files">
<h3>Creating the Timing Files<a class="headerlink" href="#creating-the-timing-files" title="Link to this heading"></a></h3>
<p>We will first create timing files that contain onsets for the Gamble, the parametric value for the potential Gain, and the parametric value for the potential Loss, for each run; in total, we will create nine regressors.</p>
<p>You can download a script to convert the timings into a format that FSL understands by clicking <a class="reference external" href="https://github.com/andrewjahn/FSL_Scripts/blob/master/make_FSL_Timings_Gambles.sh">here</a>, clicking on the <code class="docutils literal notranslate"><span class="pre">Raw</span></code> button, and right-clicking anywhere on the screen and selecting <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">As</span></code>. Save the file as a shell script into the <code class="docutils literal notranslate"><span class="pre">Gambles</span></code> directory. Once it has been downloaded, navigate to that directory with a Terminal and run the script by typing <code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">make_FSL_Timings_Gambles.sh</span></code>. You should see nine text files in each <code class="docutils literal notranslate"><span class="pre">func</span></code> directory:</p>
<figure class="align-default">
<img alt="../../_images/Appendix_F_Onsets1.png" src="../../_images/Appendix_F_Onsets1.png" />
</figure>
</section>
<section id="skull-stripping-the-brain">
<h3>Skull-Stripping the Brain<a class="headerlink" href="#skull-stripping-the-brain" title="Link to this heading"></a></h3>
<p>Before we open the FEAT GUI, we need to skull-strip the brain using <code class="docutils literal notranslate"><span class="pre">bet2</span></code>. From the Gambles directory, navigate to the <code class="docutils literal notranslate"><span class="pre">sub-01</span></code> directory and type the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bet2</span> <span class="n">anat</span><span class="o">/</span><span class="n">sub</span><span class="o">-</span><span class="mi">01</span><span class="n">_T1w</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="n">anat</span><span class="o">/</span><span class="n">sub</span><span class="o">-</span><span class="mi">01</span><span class="n">_T1w_brain</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
</section>
<section id="setting-up-the-feat-gui">
<h3>Setting up the FEAT GUI<a class="headerlink" href="#setting-up-the-feat-gui" title="Link to this heading"></a></h3>
<p>Now open the FEAT GUI by typing <code class="docutils literal notranslate"><span class="pre">Feat_gui</span></code> from the Terminal. Just as in the FSL tutorial, we will create a template design file that we can use in a for-loop to analyze all of the subjects.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">Data</span></code> tab, click on <code class="docutils literal notranslate"><span class="pre">Select</span> <span class="pre">4D</span> <span class="pre">data</span></code> and navigate to the <code class="docutils literal notranslate"><span class="pre">func</span></code> folder; select the file <code class="docutils literal notranslate"><span class="pre">sub-01_task-mixedgamblestask_run-01_bold.nii.gz</span></code> and click OK. In the <code class="docutils literal notranslate"><span class="pre">Output</span> <span class="pre">directory</span></code> field, type <code class="docutils literal notranslate"><span class="pre">run1</span></code>.</p>
<p>Leave the defaults as they are in the <code class="docutils literal notranslate"><span class="pre">Pre-stats</span></code> tab. In the <code class="docutils literal notranslate"><span class="pre">Registration</span></code> tab, select the file in the anat directory, <code class="docutils literal notranslate"><span class="pre">sub-01_T1w_brain.nii.gz</span></code>. The search space is up to you, but to speed up the analysis, change <code class="docutils literal notranslate"><span class="pre">Normal</span> <span class="pre">Search</span></code> to <code class="docutils literal notranslate"><span class="pre">Full</span> <span class="pre">Search</span></code> for both the main structural image and the standard space image, and select <code class="docutils literal notranslate"><span class="pre">12</span> <span class="pre">DOF</span></code> for both of them as well.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">Stats</span></code> tab, click on <code class="docutils literal notranslate"><span class="pre">Full</span> <span class="pre">Model</span> <span class="pre">Setup</span></code>. Type the number <code class="docutils literal notranslate"><span class="pre">3</span></code> in the field <code class="docutils literal notranslate"><span class="pre">Number</span> <span class="pre">of</span> <span class="pre">original</span> <span class="pre">EVs</span></code>, and label them in the following order:</p>
<ol class="arabic simple">
<li><p>Gambles</p></li>
<li><p>Gain_PM</p></li>
<li><p>Loss_PM</p></li>
</ol>
<p>For each one, select <code class="docutils literal notranslate"><span class="pre">Custom</span> <span class="pre">(3</span> <span class="pre">column</span> <span class="pre">format)</span></code> for the Basic Shape, and select the corresponding filename; e.g.,</p>
<ol class="arabic simple">
<li><p>Gambles -&gt; gambles_run1.txt</p></li>
<li><p>Gain_PM -&gt; gambles_gain_run1.txt</p></li>
<li><p>Loss_PM -&gt; gambles_loss_run1.txt</p></li>
</ol>
<p>In the <code class="docutils literal notranslate"><span class="pre">Contrasts</span> <span class="pre">&amp;</span> <span class="pre">F-tests</span></code> tab, create <code class="docutils literal notranslate"><span class="pre">4</span></code> contrasts, and label them as follows with the corresponding contrast weights:</p>
<ol class="arabic simple">
<li><p>Gambles [1 0 0]</p></li>
<li><p>Gain_PM [0 1 0]</p></li>
<li><p>Loss_PM [0 0 1]</p></li>
<li><p>Gain-Loss_PM [0 1 -1]</p></li>
</ol>
<p>When you are done, click on the <code class="docutils literal notranslate"><span class="pre">Save</span></code> button at the bottom of the GUI, and call it <code class="docutils literal notranslate"><span class="pre">design_run1.fsf</span></code>. Save it in the <code class="docutils literal notranslate"><span class="pre">Gambles</span></code> directory. Do the same procedure for the other two runs, updating the functional run and the timing files, and saving the design files as <code class="docutils literal notranslate"><span class="pre">design_run2.fsf</span></code> and <code class="docutils literal notranslate"><span class="pre">design_run3.fsf</span></code>. Save these files into the <code class="docutils literal notranslate"><span class="pre">Gambles</span></code> directory as well.</p>
<p>Next, download the file <a class="reference external" href="https://github.com/andrewjahn/FSL_Scripts/blob/master/run_1stLevel_Analysis_Gambles.sh">run_1stLevel_Analysis_Gambles.sh</a>, saving it into the <code class="docutils literal notranslate"><span class="pre">Gambles</span></code> directory just like you did with the timing conversion script. Run it by typing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="n">run_1stLevel_Analysis_Gambles</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>You should see an HTML file open for each run that is analyzed, which will generate 48 tabs total. The entire analysis should take four or five hours, depending on the speed of your machine.</p>
</section>
</section>
<section id="higher-level-analysis">
<h2>Higher-Level Analysis<a class="headerlink" href="#higher-level-analysis" title="Link to this heading"></a></h2>
<section id="setting-up-the-second-level-analysis">
<h3>Setting up the Second-Level Analysis<a class="headerlink" href="#setting-up-the-second-level-analysis" title="Link to this heading"></a></h3>
<p>From the <code class="docutils literal notranslate"><span class="pre">Gambles</span></code> directory, type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ls -d $PWD/sub-??/run*
</pre></div>
</div>
<p>This will create a list of all of the first-level FEAT directories. Copy the output to your clipboard, and open up a new FEAT GUI. Select <code class="docutils literal notranslate"><span class="pre">Higher-level</span> <span class="pre">analysis</span></code> from the dropdown menu, and make sure that <code class="docutils literal notranslate"><span class="pre">Inputs</span> <span class="pre">are</span> <span class="pre">lower-level</span> <span class="pre">FEAT</span> <span class="pre">directories</span></code> is selected. Change the <code class="docutils literal notranslate"><span class="pre">Number</span> <span class="pre">of</span> <span class="pre">inputs</span></code> to <code class="docutils literal notranslate"><span class="pre">48</span></code>, and then click on <code class="docutils literal notranslate"><span class="pre">Select</span> <span class="pre">FEAT</span> <span class="pre">directories</span></code>. Click <code class="docutils literal notranslate"><span class="pre">Paste</span></code>, and then press <code class="docutils literal notranslate"><span class="pre">ctrl+y</span></code> on the keyboard to paste the list of FEAT directories. Click <code class="docutils literal notranslate"><span class="pre">OK</span></code>, and leave the boxes checked next to <code class="docutils literal notranslate"><span class="pre">Use</span> <span class="pre">lower-level</span> <span class="pre">copes</span></code>. For the <code class="docutils literal notranslate"><span class="pre">Output</span> <span class="pre">directory</span></code>, enter <code class="docutils literal notranslate"><span class="pre">Gambles_2ndLevel</span></code>.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">Stats</span></code> tab, change the Mixed effects to <code class="docutils literal notranslate"><span class="pre">Fixed</span> <span class="pre">effects</span></code>. Click on <code class="docutils literal notranslate"><span class="pre">Full</span> <span class="pre">Model</span> <span class="pre">Setup</span></code>. Change the <code class="docutils literal notranslate"><span class="pre">Number</span> <span class="pre">of</span> <span class="pre">main</span> <span class="pre">EVs</span></code> to <code class="docutils literal notranslate"><span class="pre">16</span></code>, and fill in the matrix with three 1’s for each subject, as in the following figure:</p>
<figure class="align-default">
<img alt="../../_images/Appendix_F_EVs.png" src="../../_images/Appendix_F_EVs.png" />
</figure>
<p>And update the <code class="docutils literal notranslate"><span class="pre">Contrasts</span> <span class="pre">&amp;</span> <span class="pre">F-tests</span></code> tab so that there are 16 contrasts, and a contrast weight of 1 per subject:</p>
<figure class="align-default">
<img alt="../../_images/Appendix_F_Contrasts.png" src="../../_images/Appendix_F_Contrasts.png" />
</figure>
<p>Click OK, and then click the <code class="docutils literal notranslate"><span class="pre">Go</span></code> button. This will average the parameter estimate for each regressor across all three runs, and it will take an hour or two.</p>
</section>
<section id="setting-up-the-third-level-analysis">
<h3>Setting up the Third-Level Analysis<a class="headerlink" href="#setting-up-the-third-level-analysis" title="Link to this heading"></a></h3>
<p>Open a new FEAT GUI, and select <code class="docutils literal notranslate"><span class="pre">Inputs</span> <span class="pre">are</span> <span class="pre">3D</span> <span class="pre">cope</span> <span class="pre">images</span> <span class="pre">from</span> <span class="pre">FEAT</span> <span class="pre">directories</span></code> from the dropdown menu. Change the <code class="docutils literal notranslate"><span class="pre">Number</span> <span class="pre">of</span> <span class="pre">inputs</span></code> to <code class="docutils literal notranslate"><span class="pre">16</span></code>, and set the <code class="docutils literal notranslate"><span class="pre">Output</span> <span class="pre">directory</span></code> to <code class="docutils literal notranslate"><span class="pre">Gambles_3rdLevel_Gain</span></code>. Use a Terminal to navigate to the directory <code class="docutils literal notranslate"><span class="pre">Gambles_2ndLevel.gfeat/cope2.feat/stats</span></code>, and type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ls $PWD/cope* | sort -V
</pre></div>
</div>
<p>This will return a list of all of the cope images for the second contrast we specified, which is the parametric modulation of Gain. Copy this list, click on <code class="docutils literal notranslate"><span class="pre">Select</span> <span class="pre">cope</span> <span class="pre">images</span></code>, click <code class="docutils literal notranslate"><span class="pre">Paste</span></code>, and then type <code class="docutils literal notranslate"><span class="pre">ctrl+y</span></code> to paste the list. Click <code class="docutils literal notranslate"><span class="pre">OK</span></code>.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">Stats</span></code> tab, you can leave the default of <code class="docutils literal notranslate"><span class="pre">Mixed</span> <span class="pre">effects:</span> <span class="pre">FLAME</span> <span class="pre">1</span></code>. Click on <code class="docutils literal notranslate"><span class="pre">Model</span> <span class="pre">setup</span> <span class="pre">wizard</span></code>, and select <code class="docutils literal notranslate"><span class="pre">single</span> <span class="pre">group</span> <span class="pre">average</span></code>. Click <code class="docutils literal notranslate"><span class="pre">Process</span></code>, and then click <code class="docutils literal notranslate"><span class="pre">Go</span></code>. This analysis will take ten to twenty minutes.</p>
</section>
</section>
<section id="viewing-the-results">
<h2>Viewing the Results<a class="headerlink" href="#viewing-the-results" title="Link to this heading"></a></h2>
<p>To view the results, navigate to the directory <code class="docutils literal notranslate"><span class="pre">Gambles_3rdLevel_Gain.gfeat</span></code> and open fsleyes. Select <code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">-&gt;</span> <span class="pre">Add</span> <span class="pre">Standard</span></code> and choose the template <code class="docutils literal notranslate"><span class="pre">MNI152_T1_1mm</span></code>. Next, click on <code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">-&gt;</span> <span class="pre">Add</span> <span class="pre">from</span> <span class="pre">file</span></code>, and select <code class="docutils literal notranslate"><span class="pre">thresh_zstat1</span></code>. Change the colorscale to <code class="docutils literal notranslate"><span class="pre">Red-Yellow</span></code> to better see the outline of the cluster, and click on the Gear icon and choose <code class="docutils literal notranslate"><span class="pre">Linear</span> <span class="pre">interpolation</span></code> to smooth the edges. You should see something like this:</p>
<figure class="align-default">
<img alt="../../_images/Appendix_F_Zthresh.png" src="../../_images/Appendix_F_Zthresh.png" />
</figure>
<p>We see that there is significant parametric modulation of Gain within the ventral striatum, as we would expect. However, we also know that FSL’s FLAME1 method for cluster correction can be overly conservative; see, for example, Figure 1 of Eklund et al., 2016. We can instead use a non-parametric option such as randomise in conjunction with threshold-free cluster enhancement, in order to balance the width and the height of each cluster. This will strike a balance between false positives and false negatives; our false positive rate will be kept to 5%, but we will also see cluster that we wouldn’t otherwise with traditional cluster correction methods.</p>
<p>To do this, navigate to the directory <code class="docutils literal notranslate"><span class="pre">Gambles_2ndLevel.gfeat/cope2.feat/stats</span></code>, which contains the z-statistic images for the parametric modulation of Gain. Merge the files into a single dataset, and move it to the main <code class="docutils literal notranslate"><span class="pre">Gambles</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fslmerge</span> <span class="o">-</span><span class="n">t</span> <span class="n">allZs</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="n">zstat</span><span class="o">*</span>
<span class="n">mv</span> <span class="n">allZs</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="o">../../..</span>
<span class="n">cd</span> <span class="o">../../..</span>
</pre></div>
</div>
<p>Now run <code class="docutils literal notranslate"><span class="pre">randomise</span></code>, using the <code class="docutils literal notranslate"><span class="pre">-1</span></code> flag to indicate that it is a one-sample t-test, and the <code class="docutils literal notranslate"><span class="pre">-T</span></code> flag to do threshold-free cluster enhancement (TFCE). We will run 5000 simulations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">randomise</span> <span class="o">-</span><span class="n">i</span> <span class="n">allZs</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="o">-</span><span class="n">o</span> <span class="n">allZs_randomise</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="n">T</span> <span class="o">-</span><span class="n">n</span> <span class="mi">5000</span>
</pre></div>
</div>
<p>Load the file <code class="docutils literal notranslate"><span class="pre">allZs_randomise_tfce_corrp_tstat1</span></code> in fsleyes, and change the <code class="docutils literal notranslate"><span class="pre">Min.</span></code> threshold of 0.95. This will show all of the TFCE clusters at an alpha threshold of p=0.05. Note how many more clusters there are, and how these were hidden with the FLAME1 approach.</p>
<figure class="align-default">
<img alt="../../_images/Appendix_F_Results_TFCE.png" src="../../_images/Appendix_F_Results_TFCE.png" />
</figure>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading"></a></h2>
<p>As an exercise, try running the same analysis with the parametric modulation of Loss; these are located in the 2ndLevels directory as <code class="docutils literal notranslate"><span class="pre">cope3</span></code>. You may have to look at the unthresholded results, since in my experience the Loss results do not pass the threshold in either FLAME1 or TFCE. Nevertheless, you should still see an association of <strong>negative</strong> BOLD signal with the Loss parametric modulators. Compare your results to those of <a class="reference external" href="https://science.sciencemag.org/content/sci/315/5811/515.full.pdf">Tom et al., 2007</a>:</p>
<figure class="align-default">
<img alt="../../_images/Appendix_F_Tom_Results1.png" src="../../_images/Appendix_F_Tom_Results1.png" />
</figure>
</section>
<section id="video">
<h2>Video<a class="headerlink" href="#video" title="Link to this heading"></a></h2>
<p>A video demonstration of how to analyze the Tom et al. 2007 dataset can be found <a class="reference external" href="https://www.youtube.com/watch?v=SSDPVY3Ma_w">here</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Appendix_E_Meta_Analysis.html" class="btn btn-neutral float-left" title="Appendix E: Meta-Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Appendix_G_ReverseInference.html" class="btn btn-neutral float-right" title="Appendix G: Reverse Inference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Andy Jahn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>