<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FreeSurfer Tutorial #8: Group Analysis &mdash; Andy&#39;s Brain Book 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="FreeSurfer Tutorial #9: Cluster Correction" href="FS_09_ClusterCorrection.html" />
    <link rel="prev" title="FreeSurfer Tutorial #7: The FSGD File" href="FS_07_FSGD.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Andy's Brain Book
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/fsl_mac_install.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unix for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_Intro.html">What is Unix?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_01_Navigation.html">Unix Tutorial #1: 目录操作 (Directories and Navigation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_02_CopyRemove.html">Unix Tutorial #2: Copying and Removing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_03_ReadingTextFiles.html">Unix Tutorial #3: Reading Text Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_04_ShellsVariables.html">Unix Tutorial #4: Shells and Path Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_05_ForLoops.html">Unix Tutorial #5: For-Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_06_IfElse.html">Unix Tutorial #6: Conditional Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_07_Scripting.html">Unix Tutorial #7: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_08_Sed.html">Unix Tutorial #8: The Sed Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_09_AutomatingTheAnalysis.html">Unix Tutorial #9: Automating The Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Short Course with FSL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_Intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_01_DataDownload.html">fMRI Tutorial #1: Downloading the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_02_ExperimentalDesign.html">fMRI Tutorial #2: Overview of The Flanker Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_03_LookingAtTheData.html">fMRI Tutorial #3: Looking at the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_04_Preprocessing.html">fMRI Tutorial #4: Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_05_1stLevelAnalysis.html">fMRI Tutorial #5: Statistics and Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_06_Scripting.html">fMRI Tutorial #6: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_07_2ndLevelAnalysis.html">fMRI Tutorial #7: 2nd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_08_3rdLevelAnalysis.html">fMRI Tutorial #8: 3rd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_09_ROIAnalysis.html">fMRI Tutorial #9: ROI Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_10_Summary.html">fMRI Tutorial #10: Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_Appendices.html">fMRI Short Course: Appendices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FreeSurfer</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../FreeSurfer_Introduction.html">FreeSurfer Short Course</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../FreeSurfer_Introduction.html#overview">Overview</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="FS_01_BasicTerms.html">FreeSurfer Tutorial #1: Basic Terms</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_02_DownloadInstall.html">FreeSurfer Tutorial #2: How to Download and Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_03_ReconAll.html">FreeSurfer Tutorial #3: Recon-all</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_04_ReconAllParallel.html">FreeSurfer Tutorial #4: Running recon-all in Parallel</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_05_OpenScienceGrid.html">FreeSurfer Tutorial #5: Using the Open Science Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_06_Freeview.html">FreeSurfer Tutorial #6: Freeview</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_07_FSGD.html">FreeSurfer Tutorial #7: The FSGD File</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">FreeSurfer Tutorial #8: Group Analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-group-file-with-mris-preproc">Creating a group file with mris_preproc</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fitting-the-general-linear-model-with-mri-glmfit">Fitting the general linear model with mri_glmfit</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reviewing-the-output">Reviewing the Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#video">Video</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="FS_09_ClusterCorrection.html">FreeSurfer Tutorial #9: Cluster Correction</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_10_CorrelationAnalysis.html">FreeSurfer Tutorial #10: Correlation Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_11_ROIAnalysis.html">FreeSurfer Tutorial #11: Region of Interest Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_12_FailureModes.html">FreeSurfer Tutorial #12: Introduction to Failure Modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_13_PialSurface.html">FreeSurfer Tutorial #13: SkullStripping and Pial Surface Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_14_ControlPoints.html">FreeSurfer Tutorial #14: Control Points and Intensity Normalization</a></li>
<li class="toctree-l3"><a class="reference internal" href="AppendixA_LGI.html">Appendix A: Local Gyrification Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="AppendixB_PETSurfer.html">Appendix B: PETSurfer</a></li>
<li class="toctree-l3"><a class="reference internal" href="AppendixC_Annotations.html">Appendix C: Annotating Anatomical Images with Freeview</a></li>
<li class="toctree-l3"><a class="reference internal" href="AppendixD_SegmentingSubfields.html">Appendix D: Segmenting Hippocampal, Amygdala, Brainstem, and Thalamus Subfields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TRACULA_ShortCourse/TRACULA_01_Intro.html">TRACULA Tutorial #1: Overview</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">E-Prime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../E-Prime/E-Prime_Overview.html">Overview of E-Prime</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AFNI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../AFNI/AFNI_Overview.html">AFNI Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SPM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../SPM/SPM_Overview.html">SPM Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functional Connectivity with the CONN Toolbox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FunctionalConnectivity/CONN_Overview.html">Functional Connectivity and the CONN Toolbox</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parametric Modulation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PM/PM_Overview.html">Parametric Modulation in SPM, FSL, and AFNI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Image Visualization with MRIcroGL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRIcroGL/MRIcroGL_Overview.html">Image Visualization with MRIcroGL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction to the Human Connectome Project (HCP)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../HCP/HCP_Overview.html">Introduction to the Human Connectome Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Finite Impulse Response (FIR) Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FIR/FIR_Overview.html">Finite Impulse Response (FIR)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Practicals/DesignOptimization.html">Design Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Diffusion Analysis with MRtrix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRtrix/MRtrix_Introduction.html">Introduction to MRtrix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ASL Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/ASL_Techniques.html">fASL Tutorial #1: Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_02_Download.html">fASL Tutorial #2: Downloading and Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_03_Task.html">fASL Tutorial #3: The N-Back Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/04_fASL_GUI.html">fASL Tutorial #4: The GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/05_fASL_Results.html">fASL Tutorial #5: Examining the Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/06_fASL_Quantification.html">fASL Tutorial #6: Quantification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Frequently Asked Questions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FrequentlyAskedQuestions/FrequentlyAskedQuestions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Statistics/GIMME.html">GIMME (Group Iterative Multiple Model Estimation)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Open Science</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../OpenScience/OS_Overview.html">Open Science</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Normalization Tools (ANTs)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ANTs/ANTs_Overview.html">Advanced Normalization Tools (ANTs)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tract-Based Spatial Statistics (TBSS)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../TBSS/TBSS_Overview.html">Introduction to Tract-Based Spatial Statistics (TBSS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Stats/Stats_Overview.html">Statistics for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machine Learning for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ML/ML_Overview.html">Machine Learning for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Slicer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Slicer/Slicer_Overview.html">Slicer Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CAT12</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CAT12/CAT12_Overview.html">Voxel-Based Morphometry with CAT12</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using the Supercomputer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Supercomputer/Supercomputer_Overview.html">Introduction to Supercomputing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Matlab for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Matlab/Matlab_Overview.html">Matlab for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ITK-Snap</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ITK-Snap/ITK-Snap_Overview.html">ITK-Snap_Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PythonForNeuroimagers/PythonForNeuroimagers_Overview.html">Python for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta-Analysis for fMRI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MetaAnalysis/MetaAnalysis_Overview.html">Meta-Analysis for Neuroimagers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Andy's Brain Book</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../FreeSurfer_Introduction.html">FreeSurfer Short Course</a></li>
      <li class="breadcrumb-item active">FreeSurfer Tutorial #8: Group Analysis</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/FreeSurfer/FS_ShortCourse/FS_08_GroupAnalysis.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="freesurfer-tutorial-8-group-analysis">
<span id="fs-08-groupanalysis"></span><h1>FreeSurfer Tutorial #8: Group Analysis<a class="headerlink" href="#freesurfer-tutorial-8-group-analysis" title="Link to this heading"></a></h1>
<hr class="docutils" />
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The previous tutorials have focused on preparing the data for a group analysis: First, the data was preprocessed using recon-all, with different structural measurements calculated at each vertex; and second, we created an FSGD file and a contrast file indicating which groups we want to compare against each other.</p>
<p>If you recall from a previous tutorial, I recommended using the <code class="docutils literal notranslate"><span class="pre">qcache</span></code> option when running recon-all. This will generate thickness, volume, and curvature maps at several different smoothing sizes, such as 0mm, 10mm, and 25mm full-width half-maximum kernels. One of the benefits of surface-based analysis is that you can use much larger smoothing kernels than you can in volumetric-based analyses, because there is no risk of smoothing across gyri. When you run the group analysis you can choose among any of the following smoothing sizes:</p>
<figure class="align-default" id="id1">
<img alt="../../_images/08_Qcache_Output.png" src="../../_images/08_Qcache_Output.png" />
<figcaption>
<p><span class="caption-text">Example output from qcache. Notice how the thickness estimates across the subjects become smoother as a result of using large smoothing kernels.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Before looking at your group analyses, decide on which smoothing kernel you will use - and then stick to it. This will prevent you from checking every possible smoothing size, which in turn will require you to correct for the number of tests that you examine with different smoothing kernels.</p>
</div>
</section>
<section id="creating-a-group-file-with-mris-preproc">
<h2>Creating a group file with mris_preproc<a class="headerlink" href="#creating-a-group-file-with-mris-preproc" title="Link to this heading"></a></h2>
<p>In order to run a group analysis, we will need to combine all of our individual structural maps into a single dataset. This is similar to the idea of combining consecutive volumes of an fMRI run into a one dataset - as though the volumes are daisy-chained together and laid end to end. (Or, to think of it another way, the structural images are stacked on top of each other, like pancakes; or layered like nachos. Use whatever food analogy is most helpful to remember this important point.)</p>
<figure class="align-default">
<img alt="../../_images/08_mrispreproc_Concatenation.gif" src="../../_images/08_mrispreproc_Concatenation.gif" />
</figure>
<p>The data are also <strong>resampled</strong> to the fsaverage template, which is in MNI space. Whenever we do any kind of group analysis - comparing groups, region of interest analysis, and so on - each subject’s data must have the same dimensions and voxel resolution. Forgetting to resample usually leads to errors during this step. (All of this applies to fMRI analysis as well.)</p>
<p>We will perform all of these steps with a single command: <strong>mris_preproc</strong>. The command requires the following arguments:</p>
<ol class="arabic simple">
<li><p>An FSGD file (indicated by the <code class="docutils literal notranslate"><span class="pre">--fsgd</span></code> option);</p></li>
<li><p>A template to resample to (<code class="docutils literal notranslate"><span class="pre">--target</span></code>);</p></li>
<li><p>An indication of which hemisphere to resample (<code class="docutils literal notranslate"><span class="pre">--hemi</span></code>);</p></li>
<li><p>A label for the output file (<code class="docutils literal notranslate"><span class="pre">--out</span></code>).</p></li>
</ol>
<p>In this tutorial, we will also use the <code class="docutils literal notranslate"><span class="pre">--cache-in</span></code> option to specify which smoothed images we want to use in the analysis. You can choose any of the smoothed images generated by using the <code class="docutils literal notranslate"><span class="pre">--qcache</span></code> option with recon-all.</p>
<p>To make the command more compact and to make it adaptable to any study you wish to analyze, we will use nested for-loops:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/tcsh

setenv study $argv[1]

foreach hemi (lh rh)
  foreach smoothing (10)
    foreach meas (volume thickness)
      mris_preproc --fsgd FSGD/{$study}.fsgd \
        --cache-in {$meas}.fwhm{$smoothing}.fsaverage \
        --target fsaverage \
        --hemi {$hemi} \
        --out {$hemi}.{$meas}.{$study}.{$smoothing}.mgh
    end
  end
end
</pre></div>
</div>
<p>Copy this code into a shell script and save it as <code class="docutils literal notranslate"><span class="pre">runMrisPreproc.sh</span></code>. This code is also available for download <a class="reference external" href="https://github.com/andrewjahn/FreeSurfer_Scripts/blob/master/runMrisPreproc.sh">here</a>. Make sure the script is in the directory containing all of the subject directories (in this case, <code class="docutils literal notranslate"><span class="pre">Cannabis/FS</span></code>), and then run it by typing <code class="docutils literal notranslate"><span class="pre">tcsh</span> <span class="pre">runMrisPreproc.sh</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you haven’t used the <code class="docutils literal notranslate"><span class="pre">-qcache</span></code> option during recon-all, you can still smooth the data without having to rerun all of the preprocessing steps; e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recon</span><span class="o">-</span><span class="nb">all</span> <span class="o">-</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">subjName</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">qcache</span>
</pre></div>
</div>
<p>To smooth at a specific level, you can add it after the <code class="docutils literal notranslate"><span class="pre">-fwhm</span></code> option, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recon</span><span class="o">-</span><span class="nb">all</span> <span class="o">-</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">subjName</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">qcache</span> <span class="o">-</span><span class="n">fwhm</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you need a refresher on Unix, variables, and for-loops, see <a class="reference internal" href="../../unix/Unix_Intro.html#unix-intro"><span class="std std-ref">this tutorial</span></a>.</p>
</div>
</section>
<section id="fitting-the-general-linear-model-with-mri-glmfit">
<h2>Fitting the general linear model with mri_glmfit<a class="headerlink" href="#fitting-the-general-linear-model-with-mri-glmfit" title="Link to this heading"></a></h2>
<p>Now that all of the subjects are concatenated into a single dataset, we can fit a general linear model with FreeSurfer’s <code class="docutils literal notranslate"><span class="pre">mri_glmfit</span></code> command. In this example we will use the following inputs:</p>
<ol class="arabic simple">
<li><p>The concatenated dataset containing all of the subjects’ structural maps (<code class="docutils literal notranslate"><span class="pre">--y</span></code>);</p></li>
<li><p>The FSGD file (<code class="docutils literal notranslate"><span class="pre">--fsgd</span></code>);</p></li>
<li><p>A list of contrasts (each contrast specified by a different line containing <code class="docutils literal notranslate"><span class="pre">--C</span></code>);</p></li>
<li><p>The hemisphere of the template to analyze (<code class="docutils literal notranslate"><span class="pre">--surf</span></code>);</p></li>
<li><p>A mask to restrict our analysis only to the cortex (<code class="docutils literal notranslate"><span class="pre">--cortex</span></code>);</p></li>
<li><p>An output label for the directory containing the results (<code class="docutils literal notranslate"><span class="pre">--glmdir</span></code>).</p></li>
</ol>
<p>As above, we will use nested for loops to analyze the hemispheres, smoothing kernels, and structural measurements of our choosing. In this example we will analyze both the left and right hemispheres at a smoothing kernel of 10mm, and we will analyze the strucutral maps of volume and thickness:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/tcsh

set study = $argv[1]

foreach hemi (lh rh)
  foreach smoothness (10)
    foreach meas (volume thickness)
        mri_glmfit \
        --y {$hemi}.{$meas}.{$study}.{$smoothness}.mgh \
        --fsgd FSGD/{$study}.fsgd \
        --C Contrasts/CB-HC.mtx \
        --C Contrasts/HC-CB.mtx \
        --surf fsaverage {$hemi}  \
        --cortex  \
        --glmdir {$hemi}.{$meas}.{$study}.{$smoothness}.glmdir
    end
  end
end
</pre></div>
</div>
<p>Copy this code into a shell script and save it as <code class="docutils literal notranslate"><span class="pre">runGLMs.sh</span></code>. This code is also available for download <a class="reference external" href="https://github.com/andrewjahn/FreeSurfer_Scripts/blob/master/runGLMs.sh">here</a>. Run the script from the subject directory by typing <code class="docutils literal notranslate"><span class="pre">tcsh</span> <span class="pre">runGLMs.sh</span></code>.</p>
</section>
<section id="reviewing-the-output">
<h2>Reviewing the Output<a class="headerlink" href="#reviewing-the-output" title="Link to this heading"></a></h2>
<p>If the scripts run without any errors, you should see the following directories in your current directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lh</span><span class="o">.</span><span class="n">thickness</span><span class="o">.</span><span class="n">CannabisStudy</span><span class="mf">.10</span><span class="o">.</span><span class="n">glmdir</span>
<span class="n">lh</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">CannabisStudy</span><span class="mf">.10</span><span class="o">.</span><span class="n">glmdir</span>
<span class="n">rh</span><span class="o">.</span><span class="n">thickness</span><span class="o">.</span><span class="n">CannabisStudy</span><span class="mf">.10</span><span class="o">.</span><span class="n">glmdir</span>
<span class="n">rh</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">CannabisStudy</span><span class="mf">.10</span><span class="o">.</span><span class="n">glmdir</span>
</pre></div>
</div>
<p>The directory name indicates the hemisphere, structural measurement, name of the study, and the smoothing kernel used in the analysis. Each directory contains the same structure; if we navigate into the <code class="docutils literal notranslate"><span class="pre">lh.volume.CannabisStudy.10.glmdir</span></code> directory and type <code class="docutils literal notranslate"><span class="pre">ls</span></code>, for example, we will see the following:</p>
<figure class="align-default">
<img alt="../../_images/08_FreeSurfer_GroupAnalysis_Directory.png" src="../../_images/08_FreeSurfer_GroupAnalysis_Directory.png" />
</figure>
<p>The directories <code class="docutils literal notranslate"><span class="pre">CB-HC</span></code> and <code class="docutils literal notranslate"><span class="pre">HC-CB</span></code> contain the contrast data for each contrast specified in <code class="docutils literal notranslate"><span class="pre">mri_glmfit</span></code>, which we will review in the next section. Among the files in the current directory, <code class="docutils literal notranslate"><span class="pre">y.fsgd</span></code> is a copy of the FSGD file used to run the analysis; <code class="docutils literal notranslate"><span class="pre">mri_glmfit.log</span></code> contains the code that was run for the current analysis; <code class="docutils literal notranslate"><span class="pre">mask.mgh</span></code> is the mask used for the analysis; and <code class="docutils literal notranslate"><span class="pre">beta.mgh</span></code> is a concatenated dataset of the individual beta weights created by the analysis. You can read descriptions of the other outputs by typing <code class="docutils literal notranslate"><span class="pre">mri_glmfit</span></code> and examining the section under <code class="docutils literal notranslate"><span class="pre">Command-Line</span> <span class="pre">Arguments</span></code>.</p>
<p>Within each of the contrast directories you will see the following:</p>
<figure class="align-default">
<img alt="../../_images/08_ContrastDirectoryContents.png" src="../../_images/08_ContrastDirectoryContents.png" />
</figure>
<p>The file <code class="docutils literal notranslate"><span class="pre">gamma.mgh</span></code> is a contrast map - the beta dataset in the above directory multiplied by the contrast weights for this particular contrast. In the HC-CB directory, for example, <code class="docutils literal notranslate"><span class="pre">gamma.mgh</span></code> would show where the Control Group has greater volume than the Cannabis Group in the left hemisphere. <code class="docutils literal notranslate"><span class="pre">z.mgh</span></code> converts this contrast into a z-map, and <code class="docutils literal notranslate"><span class="pre">sig.mgh</span></code> converts the contrast into a map of p-values. As above, you can read descriptions of the other outputs in the <code class="docutils literal notranslate"><span class="pre">mri_glmfit</span></code> help manual.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>FreeSurfer uses -log10(p) notation; in other words, a value of 1 in the <code class="docutils literal notranslate"><span class="pre">sig.mgh</span></code> map represents a p-value of 0.1, a value of 2 represents a p-value of 0.01, and so on.</p>
</div>
<p>To render the statistical maps on the <code class="docutils literal notranslate"><span class="pre">fsaverage</span></code> template, navigate to any of the contrast directories (e.g., HC-CB) and type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>freeview -f $SUBJECTS_DIR/fsaverage/surf/lh.inflated:overlay=sig.mgh
</pre></div>
</div>
<p>Which will load the left hemisphere of the fsaverage template, and map the <code class="docutils literal notranslate"><span class="pre">sig.mgh</span></code> overlay onto it. The threshold of the p-values can be changed by clicking on the <code class="docutils literal notranslate"><span class="pre">Configure</span></code> button and moving the sliders.</p>
<figure class="align-default">
<img alt="../../_images/08_sigMGH_Overlay.png" src="../../_images/08_sigMGH_Overlay.png" />
</figure>
<p>Now that we have the results, what do we do with them? Your first impulse might be to put them in a manuscript and try to publish it; but to ensure that our results aren’t false positives, we will need to use a form of multiple comparisons correction known as <strong>cluster correction</strong>, described in the next tutorial.</p>
</section>
<hr class="docutils" />
<section id="video">
<h2>Video<a class="headerlink" href="#video" title="Link to this heading"></a></h2>
<p>For a video overview of <code class="docutils literal notranslate"><span class="pre">mris_preproc</span></code> and <code class="docutils literal notranslate"><span class="pre">mri_glmfit</span></code>, as well as how to view the results, see <a class="reference external" href="https://www.youtube.com/watch?v=hdSkEPG-G8s&amp;list=PLIQIswOrUH6_DWy5mJlSfj6AWY0y9iUce&amp;index=8">this video</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="FS_07_FSGD.html" class="btn btn-neutral float-left" title="FreeSurfer Tutorial #7: The FSGD File" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="FS_09_ClusterCorrection.html" class="btn btn-neutral float-right" title="FreeSurfer Tutorial #9: Cluster Correction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Andy Jahn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>