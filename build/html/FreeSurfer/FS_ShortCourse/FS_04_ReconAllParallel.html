<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FreeSurfer Tutorial #4: Running recon-all in Parallel &mdash; Andy&#39;s Brain Book 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="FreeSurfer Tutorial #5: Using the Open Science Grid" href="FS_05_OpenScienceGrid.html" />
    <link rel="prev" title="FreeSurfer Tutorial #3: Recon-all" href="FS_03_ReconAll.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Andy's Brain Book
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/fsl_mac_install.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unix for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_Intro.html">What is Unix?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_01_Navigation.html">Unix Tutorial #1: 目录操作 (Directories and Navigation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_02_CopyRemove.html">Unix Tutorial #2: Copying and Removing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_03_ReadingTextFiles.html">Unix Tutorial #3: Reading Text Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_04_ShellsVariables.html">Unix Tutorial #4: Shells and Path Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_05_ForLoops.html">Unix Tutorial #5: For-Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_06_IfElse.html">Unix Tutorial #6: Conditional Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_07_Scripting.html">Unix Tutorial #7: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_08_Sed.html">Unix Tutorial #8: The Sed Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_09_AutomatingTheAnalysis.html">Unix Tutorial #9: Automating The Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Short Course with FSL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_Intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_01_DataDownload.html">fMRI Tutorial #1: Downloading the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_02_ExperimentalDesign.html">fMRI Tutorial #2: Overview of The Flanker Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_03_LookingAtTheData.html">fMRI Tutorial #3: Looking at the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_04_Preprocessing.html">fMRI Tutorial #4: Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_05_1stLevelAnalysis.html">fMRI Tutorial #5: Statistics and Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_06_Scripting.html">fMRI Tutorial #6: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_07_2ndLevelAnalysis.html">fMRI Tutorial #7: 2nd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_08_3rdLevelAnalysis.html">fMRI Tutorial #8: 3rd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_09_ROIAnalysis.html">fMRI Tutorial #9: ROI Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_10_Summary.html">fMRI Tutorial #10: Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_Appendices.html">fMRI Short Course: Appendices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FreeSurfer</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../FreeSurfer_Introduction.html">FreeSurfer Short Course</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../FreeSurfer_Introduction.html#overview">Overview</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="FS_01_BasicTerms.html">FreeSurfer Tutorial #1: Basic Terms</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_02_DownloadInstall.html">FreeSurfer Tutorial #2: How to Download and Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_03_ReconAll.html">FreeSurfer Tutorial #3: Recon-all</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">FreeSurfer Tutorial #4: Running recon-all in Parallel</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#time-constraints-with-recon-all">Time Constraints with Recon-All</a></li>
<li class="toctree-l4"><a class="reference internal" href="#downloading-the-parallel-command">Downloading the Parallel Command</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-the-parallel-command">Using the Parallel Command</a></li>
<li class="toctree-l4"><a class="reference internal" href="#analyzing-the-cannabis-dataset">Analyzing the Cannabis Dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="#video">Video</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="FS_05_OpenScienceGrid.html">FreeSurfer Tutorial #5: Using the Open Science Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_06_Freeview.html">FreeSurfer Tutorial #6: Freeview</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_07_FSGD.html">FreeSurfer Tutorial #7: The FSGD File</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_08_GroupAnalysis.html">FreeSurfer Tutorial #8: Group Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_09_ClusterCorrection.html">FreeSurfer Tutorial #9: Cluster Correction</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_10_CorrelationAnalysis.html">FreeSurfer Tutorial #10: Correlation Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_11_ROIAnalysis.html">FreeSurfer Tutorial #11: Region of Interest Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_12_FailureModes.html">FreeSurfer Tutorial #12: Introduction to Failure Modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_13_PialSurface.html">FreeSurfer Tutorial #13: SkullStripping and Pial Surface Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="FS_14_ControlPoints.html">FreeSurfer Tutorial #14: Control Points and Intensity Normalization</a></li>
<li class="toctree-l3"><a class="reference internal" href="AppendixA_LGI.html">Appendix A: Local Gyrification Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="AppendixB_PETSurfer.html">Appendix B: PETSurfer</a></li>
<li class="toctree-l3"><a class="reference internal" href="AppendixC_Annotations.html">Appendix C: Annotating Anatomical Images with Freeview</a></li>
<li class="toctree-l3"><a class="reference internal" href="AppendixD_SegmentingSubfields.html">Appendix D: Segmenting Hippocampal, Amygdala, Brainstem, and Thalamus Subfields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TRACULA_ShortCourse/TRACULA_01_Intro.html">TRACULA Tutorial #1: Overview</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">E-Prime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../E-Prime/E-Prime_Overview.html">Overview of E-Prime</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AFNI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../AFNI/AFNI_Overview.html">AFNI Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SPM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../SPM/SPM_Overview.html">SPM Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functional Connectivity with the CONN Toolbox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FunctionalConnectivity/CONN_Overview.html">Functional Connectivity and the CONN Toolbox</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parametric Modulation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PM/PM_Overview.html">Parametric Modulation in SPM, FSL, and AFNI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Image Visualization with MRIcroGL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRIcroGL/MRIcroGL_Overview.html">Image Visualization with MRIcroGL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction to the Human Connectome Project (HCP)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../HCP/HCP_Overview.html">Introduction to the Human Connectome Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Finite Impulse Response (FIR) Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FIR/FIR_Overview.html">Finite Impulse Response (FIR)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Practicals/DesignOptimization.html">Design Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Diffusion Analysis with MRtrix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRtrix/MRtrix_Introduction.html">Introduction to MRtrix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ASL Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/ASL_Techniques.html">fASL Tutorial #1: Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_02_Download.html">fASL Tutorial #2: Downloading and Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_03_Task.html">fASL Tutorial #3: The N-Back Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/04_fASL_GUI.html">fASL Tutorial #4: The GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/05_fASL_Results.html">fASL Tutorial #5: Examining the Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/06_fASL_Quantification.html">fASL Tutorial #6: Quantification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Frequently Asked Questions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FrequentlyAskedQuestions/FrequentlyAskedQuestions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Statistics/GIMME.html">GIMME (Group Iterative Multiple Model Estimation)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Open Science</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../OpenScience/OS_Overview.html">Open Science</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Normalization Tools (ANTs)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ANTs/ANTs_Overview.html">Advanced Normalization Tools (ANTs)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tract-Based Spatial Statistics (TBSS)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../TBSS/TBSS_Overview.html">Introduction to Tract-Based Spatial Statistics (TBSS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Stats/Stats_Overview.html">Statistics for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machine Learning for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ML/ML_Overview.html">Machine Learning for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Slicer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Slicer/Slicer_Overview.html">Slicer Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CAT12</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CAT12/CAT12_Overview.html">Voxel-Based Morphometry with CAT12</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using the Supercomputer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Supercomputer/Supercomputer_Overview.html">Introduction to Supercomputing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Matlab for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Matlab/Matlab_Overview.html">Matlab for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ITK-Snap</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ITK-Snap/ITK-Snap_Overview.html">ITK-Snap_Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PythonForNeuroimagers/PythonForNeuroimagers_Overview.html">Python for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta-Analysis for fMRI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MetaAnalysis/MetaAnalysis_Overview.html">Meta-Analysis for Neuroimagers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Andy's Brain Book</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../FreeSurfer_Introduction.html">FreeSurfer Short Course</a></li>
      <li class="breadcrumb-item active">FreeSurfer Tutorial #4: Running recon-all in Parallel</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/FreeSurfer/FS_ShortCourse/FS_04_ReconAllParallel.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="freesurfer-tutorial-4-running-recon-all-in-parallel">
<span id="fs-04-reconallparallel"></span><h1>FreeSurfer Tutorial #4: Running recon-all in Parallel<a class="headerlink" href="#freesurfer-tutorial-4-running-recon-all-in-parallel" title="Link to this heading"></a></h1>
<hr class="docutils" />
<section id="time-constraints-with-recon-all">
<h2>Time Constraints with Recon-All<a class="headerlink" href="#time-constraints-with-recon-all" title="Link to this heading"></a></h2>
<p>As you will soon find out, FreeSurfer takes a long time to process an individual subject - around sixteen to twenty-four hours on a typical iMac, with some variation due to factors such as the quality of the input data. For many researchers, this can be a prohibitively long time to wait, especially if the study contains dozens or hundreds of subjects.</p>
<figure class="align-default">
<img alt="../../_images/04_Recon_all_Length.png" src="../../_images/04_Recon_all_Length.png" />
</figure>
<p>One way to reduce the amount of time it takes to analyze so many subjects is to run the analyses in parallel. Modern computers typically have a central processing unit with several <strong>cores</strong>, which can be individually used for different tasks. To illustrate what cores are, picture eight men and eight kitchens, with each kitchen only big enough for one man to prepare his meal. In this analogy, each computer core is a kitchen. Eight men cannot fit into one kitchen, but if the other kitchens are unlocked and made available for use, each man can make his own meal in each room.</p>
<p>Let’s assume that each meal takes one hour to make. Instead of each man waiting his turn for the same kitchen every hour, everybody makes their meals simultaneously. What would otherwise take eight hours - that is, for all of the men to make their meal in the same kitchen - now takes one hour. If we could do something similar with our data analysis, we could finish processing the anatomical images in a more reasonable amount of time.</p>
</section>
<section id="downloading-the-parallel-command">
<h2>Downloading the Parallel Command<a class="headerlink" href="#downloading-the-parallel-command" title="Link to this heading"></a></h2>
<p>Turning back to FreeSurfer, usually just one core is used each time recon-all is run. By using a command called <strong>parallel</strong> instead, each instance of recon-all can be assigned to a different core. If you are using a Macintosh computer, you can see the number of cores you have by typing the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sysctl</span> <span class="n">hw</span><span class="o">.</span><span class="n">physicalcpu</span> <span class="n">hw</span><span class="o">.</span><span class="n">logicalcpu</span>
</pre></div>
</div>
<p>Which should return something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hw</span><span class="o">.</span><span class="n">physicalcpu</span><span class="p">:</span> <span class="mi">4</span>
<span class="n">hw</span><span class="o">.</span><span class="n">logicalcpu</span><span class="p">:</span> <span class="mi">8</span>
</pre></div>
</div>
<p>The first entry is the number of physical cores, which is 4; and the second entry is the number of logical cores, which is 8. Nobody really understands what any of this means, but all you need to know is that the number of logical cores is the number of individual recon-all jobs that you can run simultaneously.</p>
<p>The parallel command doesn’t come standard with the Macintosh operating system; you will need to download it. A prerequisite is to download the Xcode application, which can be found in the Macintosh App Store.</p>
<figure class="align-default">
<img alt="../../_images/04_AppStore.png" src="../../_images/04_AppStore.png" />
</figure>
<p>You will then need to go to <a class="reference external" href="https://brew.sh/">this website</a> and install Homebrew, a package installation manager. Homebrew allows you to quickly install packages using the command line. For example, once you have installed Homebrew, open a terminal and type the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">brew</span> <span class="n">install</span> <span class="n">parallel</span>
</pre></div>
</div>
<p>Which will install the parallel command. (Check to see if it has been installed correctly by typing <cite>parallel -help</cite> at the command line and pressing return. You should see the help manual printed to your terminal window.)</p>
</section>
<section id="using-the-parallel-command">
<h2>Using the Parallel Command<a class="headerlink" href="#using-the-parallel-command" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You must be using the <strong>bash</strong> shell in order to use parallel. If you are unsure what shell you are using, type <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">$0</span></code>. If you are not in the bash shell, simply type <code class="docutils literal notranslate"><span class="pre">bash</span></code> and press return.</p>
<p>If you want to store the results of recon-all in the directory from which you run parallel, type <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">SUBJECTS_DIR=`pwd`</span></code>.</p>
</div>
<p>Parallel is run by <strong>piping</strong> the output of the <code class="docutils literal notranslate"><span class="pre">ls</span></code> command into the parallel command. For example, if you have six anatomical images labeled sub1.nii, sub2.nii … sub6.nii, you can analyze them in parallel by typing the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span> <span class="o">*.</span><span class="n">nii</span> <span class="o">|</span> <span class="n">parallel</span> <span class="o">--</span><span class="n">jobs</span> <span class="mi">8</span> <span class="n">recon</span><span class="o">-</span><span class="nb">all</span> <span class="o">-</span><span class="n">s</span> <span class="p">{</span><span class="o">.</span><span class="p">}</span> <span class="o">-</span><span class="n">i</span> <span class="p">{}</span> <span class="o">-</span><span class="nb">all</span> <span class="o">-</span><span class="n">qcache</span>
</pre></div>
</div>
<p>Let’s analyze what this command does:</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">ls</span></code> command uses a wildcard to expand all of the anatomical images that have the <code class="docutils literal notranslate"><span class="pre">.nii</span></code> extension.</p></li>
<li><p>The list is then piped into the <code class="docutils literal notranslate"><span class="pre">parallel</span></code> command, which uses the <code class="docutils literal notranslate"><span class="pre">--jobs</span> <span class="pre">8</span></code> option to indicate that 8 cores will be used to analyze the data. Each instance of recon-all will be assigned to a different core.</p></li>
<li><p>The dot in the curly braces for the <code class="docutils literal notranslate"><span class="pre">-s</span></code> option signifies that the <code class="docutils literal notranslate"><span class="pre">.nii</span></code> extension should be removed; in other words, the input to <code class="docutils literal notranslate"><span class="pre">-s</span></code> will be sub1, sub2 … sub6.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">-i</span></code> option indicates to use the output of the <code class="docutils literal notranslate"><span class="pre">ls</span></code> command as input to the <code class="docutils literal notranslate"><span class="pre">parallel</span></code> command.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">-all</span></code> and <code class="docutils literal notranslate"><span class="pre">-qcache</span></code> options have the same meaning as what was discussed in the previous tutorial on recon-all.</p></li>
</ol>
<p>Now run the command and observe what happens. If a typical recon-all job takes 15 hours on your computer, come back in 15 hours and see how many subjects have been processed. If you have eight cores and eight subjects, it should finish in the same amount of time it takes to process one subject; and if you have more than eight subjects, a new one will be processed as soon as one of the cores is freed up after finishing a subject.</p>
</section>
<section id="analyzing-the-cannabis-dataset">
<h2>Analyzing the Cannabis Dataset<a class="headerlink" href="#analyzing-the-cannabis-dataset" title="Link to this heading"></a></h2>
<p>If you have set up the directory correctly, all of the subjects should be in a folder called <code class="docutils literal notranslate"><span class="pre">Cannabis</span></code>. Create another directory called <code class="docutils literal notranslate"><span class="pre">FS</span></code>, and navigate into that directory. From a bash shell (see the note above), type the following code to run all of these subjects through the parallel command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ls .. | grep ^sub- &gt; subjList.txt

for sub in `cat subjList.txt`; do
cp ../${sub}/ses-BL/anat/*.gz .
done

gunzip *.gz

SUBJECTS_DIR=`pwd`

ls *.nii | parallel --jobs 8 recon-all -s {.} -i {} -all -qcache

rm *.nii

for sub in `cat subjList.txt`; do
mv ${sub}_ses-BL_T1w.nii ${sub}
done
</pre></div>
</div>
<p>The next tutorial will show you another way to batching your recon-all processes by using a supercomputer: The Open Science Grid.</p>
</section>
<hr class="docutils" />
<section id="video">
<h2>Video<a class="headerlink" href="#video" title="Link to this heading"></a></h2>
<p>For a video overview of the <code class="docutils literal notranslate"><span class="pre">parallel</span></code> command, see <a class="reference external" href="https://www.youtube.com/watch?v=XHN2tm3tNaw&amp;list=PLIQIswOrUH6_DWy5mJlSfj6AWY0y9iUce&amp;index=5&amp;t=0s">this video</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="FS_03_ReconAll.html" class="btn btn-neutral float-left" title="FreeSurfer Tutorial #3: Recon-all" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="FS_05_OpenScienceGrid.html" class="btn btn-neutral float-right" title="FreeSurfer Tutorial #5: Using the Open Science Grid" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Andy Jahn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>