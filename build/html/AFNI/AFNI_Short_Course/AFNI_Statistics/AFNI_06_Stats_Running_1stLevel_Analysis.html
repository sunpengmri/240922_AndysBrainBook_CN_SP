<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chapter 6: Running the First-Level Analysis &mdash; Andy&#39;s Brain Book 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="AFNI Tutorial #6: Scripting" href="../AFNI_06_Scripting.html" />
    <link rel="prev" title="Chapter 5: Creating Timing Files" href="AFNI_05_Creating_Timing_Files.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Andy's Brain Book
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/fsl_mac_install.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unix for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../unix/Unix_Intro.html">What is Unix?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unix/Unix_01_Navigation.html">Unix Tutorial #1: 目录操作 (Directories and Navigation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unix/Unix_02_CopyRemove.html">Unix Tutorial #2: Copying and Removing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unix/Unix_03_ReadingTextFiles.html">Unix Tutorial #3: Reading Text Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unix/Unix_04_ShellsVariables.html">Unix Tutorial #4: Shells and Path Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unix/Unix_05_ForLoops.html">Unix Tutorial #5: For-Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unix/Unix_06_IfElse.html">Unix Tutorial #6: Conditional Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unix/Unix_07_Scripting.html">Unix Tutorial #7: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unix/Unix_08_Sed.html">Unix Tutorial #8: The Sed Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unix/Unix_09_AutomatingTheAnalysis.html">Unix Tutorial #9: Automating The Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Short Course with FSL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../fMRI_Short_Course/fMRI_Intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fMRI_Short_Course/fMRI_01_DataDownload.html">fMRI Tutorial #1: Downloading the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fMRI_Short_Course/fMRI_02_ExperimentalDesign.html">fMRI Tutorial #2: Overview of The Flanker Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fMRI_Short_Course/fMRI_03_LookingAtTheData.html">fMRI Tutorial #3: Looking at the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fMRI_Short_Course/fMRI_04_Preprocessing.html">fMRI Tutorial #4: Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fMRI_Short_Course/fMRI_05_1stLevelAnalysis.html">fMRI Tutorial #5: Statistics and Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fMRI_Short_Course/fMRI_06_Scripting.html">fMRI Tutorial #6: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fMRI_Short_Course/fMRI_07_2ndLevelAnalysis.html">fMRI Tutorial #7: 2nd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fMRI_Short_Course/fMRI_08_3rdLevelAnalysis.html">fMRI Tutorial #8: 3rd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fMRI_Short_Course/fMRI_09_ROIAnalysis.html">fMRI Tutorial #9: ROI Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fMRI_Short_Course/fMRI_10_Summary.html">fMRI Tutorial #10: Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fMRI_Short_Course/fMRI_Appendices.html">fMRI Short Course: Appendices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FreeSurfer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../FreeSurfer/FreeSurfer_Introduction.html">FreeSurfer Short Course</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">E-Prime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../E-Prime/E-Prime_Overview.html">Overview of E-Prime</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AFNI</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../AFNI_Overview.html">AFNI Overview</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../AFNI_Overview.html#what-is-afni">What is AFNI?</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../AFNI_fMRI_Intro.html">Introduction to AFNI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../AFNI_01_DataDownload.html">AFNI Tutorial #1: Downloading the Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../AFNI_02_ExperimentalDesign.html">AFNI Tutorial #2: The Flanker Experiment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../AFNI_03_LookingAtTheData.html">AFNI Tutorial #3: Looking at the Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../AFNI_04_Preprocessing.html">AFNI Tutorial #4: AFNI Commands and Preprocessing</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../AFNI_05_1stLevelAnalysis.html">AFNI Tutorial #5: Statistics and Modeling</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../AFNI_05_1stLevelAnalysis.html#overview">Overview</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../AFNI_06_Scripting.html">AFNI Tutorial #6: Scripting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../AFNI_07_GroupAnalysis.html">AFNI Tutorial #7: Group Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../AFNI_08_ROIAnalysis.html">AFNI Tutorial #8: ROI Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../AFNI_09_SurfaceAnalysis.html">AFNI Tutorial #9: Surface-Based Analysis with SUMA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../AppendixA_ParametricModulation.html">Appendix A: Parametric Modulation in AFNI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../AppendixB_AnimalAnalysis.html">Appendix B: Analyzing Rat Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../AppendixC_HighlightingResults.html">Appendix C: Highlighting Vs. Hiding Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../AppendixD_EffectSizes.html">Appendix D: Reporting Effect Sizes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SPM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../SPM/SPM_Overview.html">SPM Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functional Connectivity with the CONN Toolbox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../FunctionalConnectivity/CONN_Overview.html">Functional Connectivity and the CONN Toolbox</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parametric Modulation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../PM/PM_Overview.html">Parametric Modulation in SPM, FSL, and AFNI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Image Visualization with MRIcroGL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../MRIcroGL/MRIcroGL_Overview.html">Image Visualization with MRIcroGL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction to the Human Connectome Project (HCP)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../HCP/HCP_Overview.html">Introduction to the Human Connectome Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Finite Impulse Response (FIR) Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../FIR/FIR_Overview.html">Finite Impulse Response (FIR)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Practicals/DesignOptimization.html">Design Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Diffusion Analysis with MRtrix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../MRtrix/MRtrix_Introduction.html">Introduction to MRtrix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ASL Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ASL/ASL_Techniques.html">fASL Tutorial #1: Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ASL/fASL_02_Download.html">fASL Tutorial #2: Downloading and Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ASL/fASL_03_Task.html">fASL Tutorial #3: The N-Back Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ASL/04_fASL_GUI.html">fASL Tutorial #4: The GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ASL/05_fASL_Results.html">fASL Tutorial #5: Examining the Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ASL/06_fASL_Quantification.html">fASL Tutorial #6: Quantification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Frequently Asked Questions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../FrequentlyAskedQuestions/FrequentlyAskedQuestions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Statistics/GIMME.html">GIMME (Group Iterative Multiple Model Estimation)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Open Science</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../OpenScience/OS_Overview.html">Open Science</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Normalization Tools (ANTs)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ANTs/ANTs_Overview.html">Advanced Normalization Tools (ANTs)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tract-Based Spatial Statistics (TBSS)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../TBSS/TBSS_Overview.html">Introduction to Tract-Based Spatial Statistics (TBSS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Stats/Stats_Overview.html">Statistics for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machine Learning for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ML/ML_Overview.html">Machine Learning for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Slicer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Slicer/Slicer_Overview.html">Slicer Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CAT12</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../CAT12/CAT12_Overview.html">Voxel-Based Morphometry with CAT12</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using the Supercomputer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Supercomputer/Supercomputer_Overview.html">Introduction to Supercomputing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Matlab for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Matlab/Matlab_Overview.html">Matlab for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ITK-Snap</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ITK-Snap/ITK-Snap_Overview.html">ITK-Snap_Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../PythonForNeuroimagers/PythonForNeuroimagers_Overview.html">Python for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta-Analysis for fMRI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../MetaAnalysis/MetaAnalysis_Overview.html">Meta-Analysis for Neuroimagers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Andy's Brain Book</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../AFNI_Overview.html">AFNI Overview</a></li>
          <li class="breadcrumb-item"><a href="../AFNI_05_1stLevelAnalysis.html">AFNI Tutorial #5: Statistics and Modeling</a></li>
      <li class="breadcrumb-item active">Chapter 6: Running the First-Level Analysis</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/AFNI/AFNI_Short_Course/AFNI_Statistics/AFNI_06_Stats_Running_1stLevel_Analysis.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="chapter-6-running-the-first-level-analysis">
<span id="afni-06-stats-running-1stlevel-analysis"></span><h1>Chapter 6: Running the First-Level Analysis<a class="headerlink" href="#chapter-6-running-the-first-level-analysis" title="Link to this heading"></a></h1>
<hr class="docutils" />
<section id="uber-subject-py-revisited">
<h2>uber_subject.py Revisited<a class="headerlink" href="#uber-subject-py-revisited" title="Link to this heading"></a></h2>
<p>Previously, we used the command <code class="docutils literal notranslate"><span class="pre">uber_subject.py</span></code> to <a class="reference internal" href="../AFNI_Preprocessing/AFNI_Intermezzo_Uber_Subject.html#afni-intermezzo-uber-subject"><span class="std std-ref">set up the preprocessing script for a single subject</span></a>. You may recall that we removed one of the processing blocks, called “regress”, because we were not focusing on regression at the time. Now, however, we will add the regress block back into our uber_subject.py script, and combine both preprocessing and 1st-level analysis into a single script.</p>
<p>Let’s create a new script for the same subject, <code class="docutils literal notranslate"><span class="pre">sub-08</span></code>. First, remove the preprocessed directory by navigating to the sub-08 directory and typing <code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-r</span> <span class="pre">subject_results</span></code>. From the directory containing all of your subjects, type <code class="docutils literal notranslate"><span class="pre">uber_subject.py</span></code> from the command line. This time, in the “analysis initialization” section, we will leave all of the blocks as they are (although since the data in this example dataset are already slice-time corrected, you could remove the “tshift” block without affecting the results, as discussed in an earlier chapter).</p>
<p>Fill in the anatomical and functional images <a class="reference internal" href="../AFNI_Preprocessing/AFNI_Intermezzo_Uber_Subject.html#afni-intermezzo-uber-subject"><span class="std std-ref">as you did for preprocessing</span></a>, and keep make the same changes to the “extra align options” and “extra tlrc options”. The sections of the GUI we will focus on in this chapter are: stimulus timing files; symbolic GLTs; and extra regress options.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If uber_subject.py isn’t working, you can download the output script <a class="reference external" href="https://github.com/andrewjahn/AFNI_Scripts/blob/master/sub_08_afni_proc.sh">here</a>.</p>
</div>
<section id="stimulus-timing-files">
<h3>Stimulus Timing Files<a class="headerlink" href="#stimulus-timing-files" title="Link to this heading"></a></h3>
<p>Having created the timing files in the <a class="reference internal" href="AFNI_05_Creating_Timing_Files.html#afni-05-creating-timing-files"><span class="std std-ref">previous chapter</span></a>, click on the “browse stim” button and select the files <code class="docutils literal notranslate"><span class="pre">congruent.1D</span></code> and <code class="docutils literal notranslate"><span class="pre">incongruent.1D</span></code> located in <code class="docutils literal notranslate"><span class="pre">sub-01/func</span></code>. (You can select multiple files by holding down the command key and clicking on individual files.)</p>
<p>When you click “OK”, you will see a table populated with the timing files you selected. In addition to showing the name of the timing file you selected, there are three other columns named “label”, “basis”, and “type”. “Label” is how the timing file will be reference in the command that does the model fitting (i.e., <code class="docutils literal notranslate"><span class="pre">3dDeconvolve</span></code>), whereas “basis” and “type” specify which basis function to apply to the timing files.</p>
<p>The default basis function of <code class="docutils literal notranslate"><span class="pre">GAM</span></code> specifies that the onset times should be convolved with the canonical HRF discussed in a <a class="reference internal" href="AFNI_03_Stats_HRF_Overview.html#afni-03-stats-hrf-overview"><span class="std std-ref">previous chapter</span></a>. This basis function requires that only one parameter be estimated - namely, the height of the HRF, which roughly corresponds to the amount of neural activity in response to that condition. Other basis functions that you can apply are the <code class="docutils literal notranslate"><span class="pre">BLOCK</span></code> function (i.e., the boxcar regressor that was discussed in the chapter on the HRF), a <code class="docutils literal notranslate"><span class="pre">TENT</span></code> function which estimates the activity at specified time-points after the onset of the condition, and <code class="docutils literal notranslate"><span class="pre">SPMG2</span></code>, which includes a temporal derivative.</p>
<p>The field below, “init file types”, allows you to specify the type of convolution you wish to use. The default of <code class="docutils literal notranslate"><span class="pre">times</span></code> means to convolve all of the time-points specified in the timing file and generate a parameter estimate for the HRF that on average fits all of the occurrences the best; <code class="docutils literal notranslate"><span class="pre">IM</span></code>, on the other hand, will estimate a separate beta weight for each trial (which can be used, e.g., for more advanced analyses such as <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S105381190400360X">beta-series analysis</a>). The <code class="docutils literal notranslate"><span class="pre">AM1</span></code> and <code class="docutils literal notranslate"><span class="pre">AM2</span></code> options are used for parametric modulation analyses (which are beyond the scope of the present tutorial), and <code class="docutils literal notranslate"><span class="pre">files</span></code> indicates that no convolution should be applied - which is useful for nuisance regressors such as motion.</p>
<p>When you have finished loading the files, this part of the GUI should look as follows:</p>
<figure class="align-default">
<img alt="../../../_images/06_Stimulus_Timing_Files.png" src="../../../_images/06_Stimulus_Timing_Files.png" />
</figure>
</section>
<section id="symbolic-glts">
<h3>Symbolic GLTs<a class="headerlink" href="#symbolic-glts" title="Link to this heading"></a></h3>
<p>The next section, “Symbolic GLTs”, allows you to specify general linear tests that will be calculated after the beta weights above are estimated for the conditions above. The notation is a little strange, and it is probably easiest to click on the “init with examples” button to show example syntax for setting up the tests. When you do, you will see two contrasts: C-I, and mean.CI.</p>
<p>Let’s look at the first contrast: This uses <strong>contrast weights</strong> to specify how the contrast between different conditions will be calculated, and it prepends the contrast weights to the labels specified in the “stimulus timing files” section. No sign implies a contrast weight of +1, while a negative sign implies a contrast weight of -1. Therefore, the line <code class="docutils literal notranslate"><span class="pre">congruent</span> <span class="pre">-incongruent</span></code> means to weight the parameter estimate for the Congruent condition with +1, and to weight the parameter estimate for the Incongruent condition with -1, and then to take the difference between the two. Using a different computation, the second contrast takes the average of the two conditions by multiplying both by 0.5.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As a general rule, contrast weights that compute a <em>difference</em> between conditions should sum to 0, and contrast weights that take an average across conditions should sum to 1.</p>
</div>
<p>Let’s modify this table to practice the GLT syntax, and to set up the contrasts that we want. In the first row, change the “label” column to <code class="docutils literal notranslate"><span class="pre">incongruent-congruent</span></code>, and in the “symbolic GLT” column, type <code class="docutils literal notranslate"><span class="pre">incongruent</span> <span class="pre">-congruent</span></code>. Likewise, in the second row specify a contrast of <code class="docutils literal notranslate"><span class="pre">congruent-incongruent</span></code>. When you have finished, the section should look like this:</p>
<figure class="align-default">
<img alt="../../../_images/06_Symbolic_GLTs.png" src="../../../_images/06_Symbolic_GLTs.png" />
</figure>
</section>
<section id="extra-regress-options">
<h3>Extra Regress Options<a class="headerlink" href="#extra-regress-options" title="Link to this heading"></a></h3>
<p>Lastly, we will indicate any preferences we have for the 3dDeconvolve command. The first field, “outlier censor limit”, will remove any TRs from the analysis that have a censored outlier fraction greater than the amount specified in the field to the right. (These outliers are detected by <code class="docutils literal notranslate"><span class="pre">3dToutcount</span></code>, which flags any voxels in a TR that have signal intensity greater than 3 standard deviations from the other voxels in brain mask.) If this is left at 0.0, then no TRs will be censored based on the output from 3dToutcount. We will leave this as is for now, since volumes with high amounts of motion will be censored.</p>
<p>The next field, “jobs for regression (num CPUs)”, specifies how many processors to use for the regression analysis. Since this step can be computationally demanding, use the maximum number of CPUs that you can spare. In this case, I will set it to <a href="#id1"><span class="problematic" id="id2">``</span></a>8`.</p>
<p>“GOFORIT level (override 3dD warnings)” will ignore any warnings about the design matrix detected by 3dDeconvolve. In general, you should not use GOFORIT unless you are positive that the matrix error is negligible. In general you will want 3dDeconvolve to throw a warning and stop running when it detects an abnormally high level of collinearity among two or more regressors.</p>
<p>The “bandpass in regression” field is usually for resting-state analyses, in order to remove both low and high frequency fluctuations. For task data, however, low-pass filtering (i.e., removing high frequency signal) risks removing actual signal related to the task. Leave this blank.</p>
<p>There are four checkboxes in addition. “Regress motion derivatives” will model higher-order derivatives of the motion regressors, which can capture more complex head movements. This is useful for populations that tend to move a lot, such as children or certain clinical subjects; and as long as you have a long time-series of data (e.g., more than 200 TRs in a run), you probably won’t run out of degrees of freedom for estimating these extra parameters. For this tutorial I will leave it unchecked, but you are free to do whatever you want.</p>
<p>I also leave the “run cluster simulation” box unchecked, as this computes whether a cluster is statistically significant in real time as you change the thresholding slider. Since I generally don’t perform inference on single subjects - we will do inference later at a group level - I omit this option. I do, however, check the “execute REMLfit” option, as this will create a separate statistical dataset that better accounts for temporal autocorrelation than the traditional 3dDeconvolve approach. Later on, we can use the output from 3dREMLfit to use information about the variability of the subject’s parameter estimates in order to create more precise group-level inference maps.</p>
<p>When you are done, this section should look like this:</p>
<figure class="align-default">
<img alt="../../../_images/06_Extra_Regress_Options.png" src="../../../_images/06_Extra_Regress_Options.png" />
</figure>
<p>Now, click the top three icons in succcession (the sheet of paper, the magnifying glass, and the green “Go” button) to run both the preprocessing and the regression. In total, it should take about 5-10 minutes.</p>
</section>
</section>
<section id="the-ideal-time-series-and-the-glm">
<h2>The Ideal Time-Series and the GLM<a class="headerlink" href="#the-ideal-time-series-and-the-glm" title="Link to this heading"></a></h2>
<p>While you’re waiting for the analysis to finish, let’s take a look at how the model we just created relates to the GLM. Remember that each voxel has a BOLD time-series (our outcome measure), which we represent with Y. We also have our two regressors, which we will represent with x1 and x2. These regressors constitute our design matrix, which we represent with a large X.</p>
<p>So far, all of these variables are known - Y is measured from the data, and x1 and x2 are made by convolving the HRF and the timing onsets. Since matrix algebra is used to set up the design matrix and estimate the beta weights, the orientations are turned ninety degrees: Normally we think of the time axis as going from left to right, but instead it is depicted as going from top to bottom. In other words, the onset of the run begins at the top of the timecourse.</p>
<p>The next part of the GLM equation is the beta weights, which we represent with B1 and B2. These represent our estimate of the amount the HRF needs to be scaled for each regressor to best match the original data in Y - hence the name “beta weights”. The last term in this equation is E, which represents the residuals, or the difference between our ideal time series model and the data after estimating the beta weights. If the model is a good fit, the residuals will decrease, and one or more of the beta weights are more likely to be statistically significant.</p>
</section>
<section id="examining-the-output">
<h2>Examining the Output<a class="headerlink" href="#examining-the-output" title="Link to this heading"></a></h2>
<p>When the script finishes, navigate into the folder <code class="docutils literal notranslate"><span class="pre">sub-08/subject_results/group.Flanker/subj.sub08/sub08.results</span></code>. In addition to the preprocessed blocks you saw previously, you will also see statistical datasets: The one labeled <code class="docutils literal notranslate"><span class="pre">stats.sub_08+tlrc</span></code> has been analyzed using the traditional 3dDeconvolve approach; the dataset <code class="docutils literal notranslate"><span class="pre">stats.sub_08_REML+tlrc</span></code> has accounted for temporal autocorrelation.</p>
<figure class="align-default">
<img alt="../../../_images/06_FirstLevel_Output.png" src="../../../_images/06_FirstLevel_Output.png" />
</figure>
<p>You will also see a few files beginning with an “X”, such as <code class="docutils literal notranslate"><span class="pre">X.xmat.1D</span></code>. These represent different parts of the design matrix. For example, you can view the design matrix by typing <code class="docutils literal notranslate"><span class="pre">aiv</span> <span class="pre">X.jpg</span></code>:</p>
<figure class="align-default">
<img alt="../../../_images/06_GLM.png" src="../../../_images/06_GLM.png" />
</figure>
<p>For a different view, looking at all of the regressors in separate rows, type <code class="docutils literal notranslate"><span class="pre">1dplot</span> <span class="pre">-sepscl</span> <span class="pre">X.xmat.1D</span></code>:</p>
<figure class="align-default" id="id5">
<img alt="../../../_images/06_GLM_1dplot.png" src="../../../_images/06_GLM_1dplot.png" />
<figcaption>
<p><span class="caption-text">If you rotate this figure by 90 degrees, you will see that it is a different representation of the same design matrix above.</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure the design matrix looks reasonable. Are the lower-frequency drifts modeled as you would expect them to be? Do the onsets for the trials in each condition match up with the timing files that you created in the last chapter?</p>
</div>
<section id="viewing-the-statistics-files">
<h3>Viewing the Statistics Files<a class="headerlink" href="#viewing-the-statistics-files" title="Link to this heading"></a></h3>
<p>We are now ready to look at the <strong>contrast maps</strong> of our data. Type <code class="docutils literal notranslate"><span class="pre">afni</span></code> to open up the GUI, and select <code class="docutils literal notranslate"><span class="pre">anat_file.sub_08</span></code> as the Underlay. (You can also use the MNI152 template if you’ve copied it into your current directory, or if you have placed it in the <code class="docutils literal notranslate"><span class="pre">aglobal</span></code> directory.) For the Overlay, select <code class="docutils literal notranslate"><span class="pre">stats.sub_08</span></code>. You should see something like this:</p>
<figure class="align-default">
<img alt="../../../_images/06_ViewingStats.png" src="../../../_images/06_ViewingStats.png" />
</figure>
<p>This may look overwhelming at first; but although the AFNI viewer can seem to have too many options, once you become more familiar with them you will be able to customize how you view your results. If this is your first time viewing statistics in AFNI, the most noticeable features of the “Define Overlay” panel will appear to be the <strong>slider bar</strong> (allowing you to threshold the images to only see values above a certain number), and the “ULay”, “OLay”, and “Thr” menus, corresponding to the Underlay, Overlay, and Threshold sub-briks.</p>
<p>Let’s begin with the slider bar. If you move it up and down, you will see voxels either disappear or re-appear. That is because we are <strong>thresholding</strong>, or removing, voxels that fall below the Threshold number to the left of the bar. This number will be based on the sub-brik that is selected in the “Thr” menu; in this case, the sub-brik that was selected for us when we opened the viewer was volume #2, the T-statistic map of the beta weights for the Congruent condition. As you move the slider to a value of, say, 1.9753, you will also notice that the number below the slider bar, <code class="docutils literal notranslate"><span class="pre">p=</span></code>, changes as well, to a value of 0.493. This represents the <strong>uncorrected p-value threshold</strong> for the currently selected Threshold map; in other words, any colored voxels pass an individual p-value threshold of 0.493.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to set a specific uncorrected p-value threshold, right-click on the <code class="docutils literal notranslate"><span class="pre">p=</span></code> text, select “set p-threshold”, and type the threshold you want (e.g., 0.001).</p>
</div>
<p>We haven’t corrected for multiple comparisons yet, so we can’t say whether any one of the individual voxels is statistically significant. However, viewing the data at an uncorrected p-value threshold can give you a general idea of the spatial layout of the statistics, and indicate whether the results are trending in the direction that you would predict, or if there appears to be something wrong. For example, highly correlated regressors would have very large parameter estimates and correspondingly high variability. You should also make sure that the activation, for a relatively high uncorrected p-value threshold (e.g., p=0.01 or higher), generally falls within the gray matter. If you find large numbers of “active” voxels within the ventricles, for example, it may indicate a problem with the data quality.</p>
<p>Now, change the OLay sub-brik to <code class="docutils literal notranslate"><span class="pre">incongruent-congruent#0_Coef</span></code> and the Thr sub-brik to <code class="docutils literal notranslate"><span class="pre">incongruent-congruent#0_Tstat</span></code>, and set the uncorrected p-value threshold to 0.05. Click around the brain, observing where the statistics are positive and where they are negative. Where do you notice significant “clusters” of activated voxels? Are they where you would expect them to be?</p>
<p>Later on, you will learn about a multiple correction technique called <strong>cluster correction</strong>. This method looks for clusters composed of voxels that pass a given uncorrected threshold, and then determines whether the cluster is significant or not. In this chapter we won’t go into how to calculate how large the cluster needs to be, but for now click the “<a href="#id3"><span class="problematic" id="id4">*</span></a>Clusterize” button and change the number of voxels to <code class="docutils literal notranslate"><span class="pre">45</span></code>. As a result, you will only see those clusters that are composed of 45 or more voxels that each pass an uncorrected p-value threshold of 0.05. You can click on the “Rpt” button to see a report of each cluster that passes this threshold, which lists the voxel size, the location of the peak voxel of the cluster, and options to move the crosshairs to the cluster and make it flash. All of these operations are summarized in the video link below.</p>
</section>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>In the lower right corner of the “Define Overlay” panel, you will see text that says <code class="docutils literal notranslate"><span class="pre">OLay</span> <span class="pre">=</span></code> and <code class="docutils literal notranslate"><span class="pre">Thr</span> <span class="pre">=</span></code>, and certain numbers on the right side of the equals sign. These indicate the value of the Overlay and Threshold datasets at the voxel where the crosshair is located; in other words, the parameter (or contrast) estimate, and the associated t-statistic. Select sub-brik #4 (incongruent#0_Coef) as an overlay, and write down the corresponding number that shows up in the <code class="docutils literal notranslate"><span class="pre">OLay</span> <span class="pre">=</span></code> field. Do the same thing for sub-brik #1 (congruent#0_Coef). Now select sub-brik #7 (incongruent-congruent_GLT#0_Coef), but before you do, think about what you would expect the value to be. Now select the sub-brik. Does it match what you predicted? Why or why not?</p></li>
<li><p>Do the same procedure in Exercise #1, looking at the contrasts of sub-briks #7 and #10. What do you notice about the value of the Overlay? Does this make sense given the contrast weights?</p></li>
<li><p>You can take the difference between beta weights by using an <strong>Image Calculator</strong>. Each of the major software packages has one; AFNI’s calculator is called <code class="docutils literal notranslate"><span class="pre">3dcalc</span></code>. Take the difference between the Incongruent and Congruent betas for sub-08 by navigating to <code class="docutils literal notranslate"><span class="pre">sub-08.results</span></code>, and typing <code class="docutils literal notranslate"><span class="pre">3dcalc</span> <span class="pre">-a</span> <span class="pre">stats.sub-08+tlrc'[4]'</span> <span class="pre">-b</span> <span class="pre">stats.sub-08+tlrc'[1]'</span> <span class="pre">-expr</span> <span class="pre">'a-b'</span> <span class="pre">-prefix</span> <span class="pre">Inc-Con+tlrc</span></code>. The way to read this command is that it assigns the 4th sub-brik of the stats dataset to variable “a”, and the 1st-sub-brik of the stats dataset to variable “b”. We know that these correspond to the Incongruent and Congruent beta weights, respectively, and then we contrast them by typing the mathematical expression “a-b” in the <code class="docutils literal notranslate"><span class="pre">-expr</span></code> option. We then provide a prefix of our choice, in this case, “Inc-Con”. The resulting output should be identical to what you what you see in the results viewer when you use Inc-Con as an overlay. Now do the same procedure to create an output file called “Con-Inc”, which contrasts the 1st sub-brik with the 4th sub-brik.</p></li>
<li><p>Although the default color scheme and display are good enough for most purposes, you will probably want to change it to suit your own taste and aesthetics. For example, once you have thresholded your statistical overlay, click on the <code class="docutils literal notranslate"><span class="pre">Define</span> <span class="pre">Datamode</span></code> button in the AFNI GUI, click on <code class="docutils literal notranslate"><span class="pre">Warp</span> <span class="pre">OLay</span> <span class="pre">on</span> <span class="pre">Demand</span></code>, and select the <code class="docutils literal notranslate"><span class="pre">Cu</span></code> resampling method (for “Cubic” interpolation) for the <code class="docutils literal notranslate"><span class="pre">OLay</span> <span class="pre">Resam</span> <span class="pre">mode</span></code>. This will smooth the edges of the voxels that survive the threshold you used. Going back to the <code class="docutils literal notranslate"><span class="pre">Define</span> <span class="pre">Overlay</span></code> panel, right click on the color bar, and sample different color palettes to see which one you like best.</p></li>
</ol>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading"></a></h2>
<p>When you have finished running the preprocessing and first-level analyses, we will then need to run this for each subject in our study. To speed up the process, we will learn about <strong>scripting</strong>, to which we now turn.</p>
</section>
<section id="video">
<h2>Video<a class="headerlink" href="#video" title="Link to this heading"></a></h2>
<p>A video walkthrough of how to set up and review the first-level analysis can be found by clicking <a class="reference external" href="https://www.youtube.com/watch?v=mFsVD7lRRmY">here</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="AFNI_05_Creating_Timing_Files.html" class="btn btn-neutral float-left" title="Chapter 5: Creating Timing Files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../AFNI_06_Scripting.html" class="btn btn-neutral float-right" title="AFNI Tutorial #6: Scripting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Andy Jahn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>