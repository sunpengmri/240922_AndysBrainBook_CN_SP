<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>fMRIPrep Tutorial #5: Running the 1st-level Analysis &mdash; Andy&#39;s Brain Book 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="fMRIPrep Tutorial #6: Group Analysis" href="fMRIPrep_Demo_6_GroupAnalysis.html" />
    <link rel="prev" title="fMRIPrep Tutorial #4: Additional Preprocessing Steps" href="fMRIPrep_Demo_4_AdditionalPreproc.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Andy's Brain Book
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/fsl_mac_install.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unix for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_Intro.html">What is Unix?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_01_Navigation.html">Unix Tutorial #1: 目录操作 (Directories and Navigation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_02_CopyRemove.html">Unix Tutorial #2: Copying and Removing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_03_ReadingTextFiles.html">Unix Tutorial #3: Reading Text Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_04_ShellsVariables.html">Unix Tutorial #4: Shells and Path Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_05_ForLoops.html">Unix Tutorial #5: For-Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_06_IfElse.html">Unix Tutorial #6: Conditional Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_07_Scripting.html">Unix Tutorial #7: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_08_Sed.html">Unix Tutorial #8: The Sed Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_09_AutomatingTheAnalysis.html">Unix Tutorial #9: Automating The Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Short Course with FSL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_Intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_01_DataDownload.html">fMRI Tutorial #1: Downloading the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_02_ExperimentalDesign.html">fMRI Tutorial #2: Overview of The Flanker Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_03_LookingAtTheData.html">fMRI Tutorial #3: Looking at the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_04_Preprocessing.html">fMRI Tutorial #4: Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_05_1stLevelAnalysis.html">fMRI Tutorial #5: Statistics and Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_06_Scripting.html">fMRI Tutorial #6: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_07_2ndLevelAnalysis.html">fMRI Tutorial #7: 2nd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_08_3rdLevelAnalysis.html">fMRI Tutorial #8: 3rd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_09_ROIAnalysis.html">fMRI Tutorial #9: ROI Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_10_Summary.html">fMRI Tutorial #10: Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_Appendices.html">fMRI Short Course: Appendices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FreeSurfer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FreeSurfer/FreeSurfer_Introduction.html">FreeSurfer Short Course</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">E-Prime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../E-Prime/E-Prime_Overview.html">Overview of E-Prime</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AFNI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../AFNI/AFNI_Overview.html">AFNI Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SPM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../SPM/SPM_Overview.html">SPM Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functional Connectivity with the CONN Toolbox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FunctionalConnectivity/CONN_Overview.html">Functional Connectivity and the CONN Toolbox</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parametric Modulation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PM/PM_Overview.html">Parametric Modulation in SPM, FSL, and AFNI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Image Visualization with MRIcroGL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRIcroGL/MRIcroGL_Overview.html">Image Visualization with MRIcroGL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction to the Human Connectome Project (HCP)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../HCP/HCP_Overview.html">Introduction to the Human Connectome Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Finite Impulse Response (FIR) Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FIR/FIR_Overview.html">Finite Impulse Response (FIR)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Practicals/DesignOptimization.html">Design Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Diffusion Analysis with MRtrix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRtrix/MRtrix_Introduction.html">Introduction to MRtrix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ASL Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/ASL_Techniques.html">fASL Tutorial #1: Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_02_Download.html">fASL Tutorial #2: Downloading and Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_03_Task.html">fASL Tutorial #3: The N-Back Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/04_fASL_GUI.html">fASL Tutorial #4: The GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/05_fASL_Results.html">fASL Tutorial #5: Examining the Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/06_fASL_Quantification.html">fASL Tutorial #6: Quantification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Frequently Asked Questions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FrequentlyAskedQuestions/FrequentlyAskedQuestions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Statistics/GIMME.html">GIMME (Group Iterative Multiple Model Estimation)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Open Science</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../OS_Overview.html">Open Science</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="BIDS_Overview.html">BIDS Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="MRIQC.html">BIDS App Tutorial #1: MRIQC</a></li>
<li class="toctree-l2"><a class="reference internal" href="fMRIPrep.html">BIDS App Tutorial #2: fMRIPrep</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="fMRIPrep_Demo.html">fMRIPrep Demonstration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="fMRIPrep_Demo_1_Download.html">fMRIPrep Tutorial #1: Downloading the Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="fMRIPrep_Demo_2_RunningAnalysis.html">fMRIPrep Tutorial #2: Running the Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="fMRIPrep_Demo_3_ExaminingPreprocData.html">fMRIPrep Tutorial #3: Examining the Preprocessed Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="fMRIPrep_Demo_4_AdditionalPreproc.html">fMRIPrep Tutorial #4: Additional Preprocessing Steps</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">fMRIPrep Tutorial #5: Running the 1st-level Analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examining-the-confound-regressors-file">Examining the Confound Regressors File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#converting-the-timings">Converting the Timings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modifying-the-confound-regressor-files">Modifying the Confound Regressor Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-the-3ddecon-file">Creating the 3dDecon File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#next-steps">Next Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#video">Video</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="fMRIPrep_Demo_6_GroupAnalysis.html">fMRIPrep Tutorial #6: Group Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Github_Overview.html">Overview of Github</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Normalization Tools (ANTs)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ANTs/ANTs_Overview.html">Advanced Normalization Tools (ANTs)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tract-Based Spatial Statistics (TBSS)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../TBSS/TBSS_Overview.html">Introduction to Tract-Based Spatial Statistics (TBSS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Stats/Stats_Overview.html">Statistics for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machine Learning for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ML/ML_Overview.html">Machine Learning for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Slicer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Slicer/Slicer_Overview.html">Slicer Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CAT12</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CAT12/CAT12_Overview.html">Voxel-Based Morphometry with CAT12</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using the Supercomputer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Supercomputer/Supercomputer_Overview.html">Introduction to Supercomputing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Matlab for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Matlab/Matlab_Overview.html">Matlab for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ITK-Snap</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ITK-Snap/ITK-Snap_Overview.html">ITK-Snap_Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PythonForNeuroimagers/PythonForNeuroimagers_Overview.html">Python for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta-Analysis for fMRI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MetaAnalysis/MetaAnalysis_Overview.html">Meta-Analysis for Neuroimagers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Andy's Brain Book</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../OS_Overview.html">Open Science</a></li>
          <li class="breadcrumb-item"><a href="fMRIPrep_Demo.html">fMRIPrep Demonstration</a></li>
      <li class="breadcrumb-item active">fMRIPrep Tutorial #5: Running the 1st-level Analysis</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/OpenScience/OS/fMRIPrep_Demo_5_1stLevelAnalysis.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="fmriprep-tutorial-5-running-the-1st-level-analysis">
<span id="fmriprep-demo-5-1stlevelanalysis"></span><h1>fMRIPrep Tutorial #5: Running the 1st-level Analysis<a class="headerlink" href="#fmriprep-tutorial-5-running-the-1st-level-analysis" title="Link to this heading"></a></h1>
<hr class="docutils" />
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>In the AFNI tutorial on <a class="reference internal" href="../../AFNI/AFNI_Short_Course/AFNI_Statistics/AFNI_06_Stats_Running_1stLevel_Analysis.html#afni-06-stats-running-1stlevel-analysis"><span class="std std-ref">1st-level analysis</span></a>, we learned how to create a General Linear Model to estimate the BOLD response to each condition in our experiment. We will be doing the same thing here, extracting the relevant motion confound regressors from the .tsv file generated by fMRIPrep.</p>
</section>
<section id="examining-the-confound-regressors-file">
<h2>Examining the Confound Regressors File<a class="headerlink" href="#examining-the-confound-regressors-file" title="Link to this heading"></a></h2>
<p>fMRIPrep creates a confound file for each run; for example, the confound regressor file for run 1 is called <code class="docutils literal notranslate"><span class="pre">sub-08_task-flanker_run-1_desc-confounds_regressors.tsv</span></code>. If you open this file in a spreadsheet program such as Excel, you will see the following:</p>
<figure class="align-default">
<img alt="../../_images/05_ConfoundSpreadsheet.png" src="../../_images/05_ConfoundSpreadsheet.png" />
</figure>
<p>You can see that the file contains many confounds, and you probably won’t use all of them. If we wanted to replicate our AFNI analysis as closely as possible, however, we will need to find the motion regressors in the x-, y-, and z-directions. The translation regressors can be found in columns EU, EY, and FC; while the rotation regressors can be found in columns FG, FK, and FO. Note that the location of these regressors may change from subject to subject, depending on how many components are extracted during ICA analysis of the different tissues.</p>
<p>There are several other regressors that you can include, such as global signal, framewise displacement, and different component time-series. Which ones to include are up to you; in any case, remember to use these regressors with AFNI’s <code class="docutils literal notranslate"><span class="pre">stim_files</span></code> options, which will <em>not</em> convolve the time-series with a basis function, such as the HRF.</p>
</section>
<section id="converting-the-timings">
<h2>Converting the Timings<a class="headerlink" href="#converting-the-timings" title="Link to this heading"></a></h2>
<p>Before we can run the 1st-level analysis, we will need to convert the timing files; the steps for doing this can be found <a class="reference internal" href="../../AFNI/AFNI_Short_Course/AFNI_Statistics/AFNI_05_Creating_Timing_Files.html#afni-05-creating-timing-files"><span class="std std-ref">here</span></a>. The paragraph to follow is pasted below:</p>
<blockquote class="epigraph">
<div><p>To format the timing files, download <a class="reference external" href="https://github.com/andrewjahn/AFNI_Scripts/blob/master/make_Timings.sh">this script</a>. (You can download it by clicking on the <code class="docutils literal notranslate"><span class="pre">Raw</span></code> button, then right-clicking in the newly-opened window and selecting “Save As”.) We won’t go into detail about how it works, but all you need to do is place it in the experimental folder containing the subjects (i.e., the <code class="docutils literal notranslate"><span class="pre">Flanker</span></code> directory), and type <code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">make_Timings.sh</span></code>. This will create timing files for each run for each subject and store them in each subject’s corresponding <code class="docutils literal notranslate"><span class="pre">func</span></code> directory. To check the output, type <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">sub-08/func/incongruent.1D</span></code>. You should see numbers similar to the ones in the figure above.</p>
</div></blockquote>
<p>When you have generated the timings, navigate to the fmriprep output directory for sub-08 in the derivatives folder, and type the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">stimuli</span>
<span class="n">cp</span> <span class="o">../../../../</span><span class="n">sub</span><span class="o">-</span><span class="mi">08</span><span class="o">/</span><span class="n">func</span><span class="o">/*</span><span class="mf">.1</span><span class="n">D</span> <span class="n">stimuli</span>
</pre></div>
</div>
<p>This will place the timing files within the <code class="docutils literal notranslate"><span class="pre">stimuli</span></code> directory.</p>
</section>
<section id="modifying-the-confound-regressor-files">
<h2>Modifying the Confound Regressor Files<a class="headerlink" href="#modifying-the-confound-regressor-files" title="Link to this heading"></a></h2>
<p>Before we can insert our confound regressors into the General Linear Model, we will need to do a few steps in Unix to format them correctly. AFNI expects a separate regressor file for each run, with later runs containing a string of zeros equal to the number of volumes in the previous run. For example, if we have two runs with 146 volumes each, the second regressor file should have 146 zeros before the first confound regressor.</p>
<p>First, we will create a backup of the second confound regressor file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="n">sub</span><span class="o">-</span><span class="mi">01</span><span class="n">_task</span><span class="o">-</span><span class="n">flanker_run</span><span class="o">-</span><span class="mi">2</span><span class="n">_desc</span><span class="o">-</span><span class="n">confounds_regressors</span><span class="o">.</span><span class="n">tsv</span> <span class="n">run</span><span class="o">-</span><span class="mi">2</span><span class="n">_confounds_regressors_BACKUP</span><span class="o">.</span><span class="n">tsv</span>
</pre></div>
</div>
<p>And then create a for-loop to extract the translation and rotation parameters for the x-, y-, and z-directions. The <code class="docutils literal notranslate"><span class="pre">awk</span></code> and <code class="docutils literal notranslate"><span class="pre">sed</span></code> commands will print the numbers in each of those columns, and then put them in files that either contain just the header, or everything except the header:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for reg in trans_x trans_y trans_z rot_x rot_y rot_z; do
  for run in 1 2; do
    awk -v col=$reg &#39;NR==1{for(i=1;i&lt;=NF;i++){if($i==col){c=i;break}} print $c} NR&gt;1{print $c}&#39; sub-08_task-flanker_run-${run}_desc-confounds_regressors.tsv &gt; ${reg}_run${run}_all_tmp.txt;
    sed &#39;1d&#39; ${reg}_run${run}_all_tmp.txt &gt; ${reg}_run${run}_noHead_tmp.txt
    sed &#39;1!d&#39; ${reg}_run${run}_all_tmp.txt &gt; ${reg}_run${run}_Head_tmp.txt
  done
done
</pre></div>
</div>
<p>We will then create a string of zeros equal to the number of volumes in the previous run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>NT=`3dinfo -nt r1_scale.nii`
if [ -f zeros_tmp.txt ]; then rm zeros_tmp.txt; fi
for ((i=0; i&lt;$NT; i++)); do echo 0 &gt;&gt; zeros_tmp.txt; done
</pre></div>
</div>
<p>Concatenating the two files using <code class="docutils literal notranslate"><span class="pre">cat</span></code> will generate a file that can now be read by AFNI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for reg in trans_x trans_y trans_z rot_x rot_y rot_z; do
  for run in 1 2; do
    if [ $run -eq 1 ]; then
      cat ${reg}_run${run}_noHead_tmp.txt &gt; ${reg}_run${run}.txt
    else
      cat zeros_tmp.txt ${reg}_run${run}_noHead_tmp.txt &gt; ${reg}_run${run}.txt
    fi
  done
done
rm *tmp*
</pre></div>
</div>
</section>
<section id="creating-the-3ddecon-file">
<h2>Creating the 3dDecon File<a class="headerlink" href="#creating-the-3ddecon-file" title="Link to this heading"></a></h2>
<p>We now have all of the ingredients we need to run the 1st-level analysis: timing files, preprocessed functional data, and a mask. To run this through 3dDeconvolve, click on <a class="reference external" href="https://github.com/andrewjahn/OpenScience_Scripts/blob/master/doDecon.sh">this link</a>, click on the <code class="docutils literal notranslate"><span class="pre">Raw</span></code> button, and then right-click and select “Save As”. Save the file into the folder <code class="docutils literal notranslate"><span class="pre">derivatives/fmriprep/sub-08/func</span></code>, and then navigate to that directory with a terminal and type the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcsh</span> <span class="n">doDecon</span><span class="o">.</span><span class="n">sh</span> <span class="n">sub</span><span class="o">-</span><span class="mi">08</span>
</pre></div>
</div>
<p>This will run the 1st-level analysis for sub-08. When it is finished, you can open the stats.tlrc file in the AFNI viewer and overlay it on the template “MNI152_2009_template.nii.gz”. If you threshold the image at p=0.001, change the color scale to red/blue, check the <code class="docutils literal notranslate"><span class="pre">Pos?</span></code> box, and clusterize it at n=40, you should see something like the figure below:</p>
<figure class="align-default" id="id1">
<img alt="../../_images/05_1stLevel_Comparison.png" src="../../_images/05_1stLevel_Comparison.png" />
<figcaption>
<p><span class="caption-text">The fMRIPrep results are shown on the left; the original results using the AFNI pipeline are shown on the right. Note that the basic pattern of activity is the same, and that the peak t-statistic in the mPFC is slightly higher in the fMRIPrep version.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading"></a></h2>
<p>Now that we have successfully analyzed a single subject, we now move on to a group-level analysis. To learn more about how to do that, click the <code class="docutils literal notranslate"><span class="pre">Next</span></code> button.</p>
</section>
<section id="video">
<h2>Video<a class="headerlink" href="#video" title="Link to this heading"></a></h2>
<p>A video demonstration of performing a first-level analysis can be found <a class="reference external" href="https://www.youtube.com/watch?v=OESt1--zuq4">here</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="fMRIPrep_Demo_4_AdditionalPreproc.html" class="btn btn-neutral float-left" title="fMRIPrep Tutorial #4: Additional Preprocessing Steps" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="fMRIPrep_Demo_6_GroupAnalysis.html" class="btn btn-neutral float-right" title="fMRIPrep Tutorial #6: Group Analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Andy Jahn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>