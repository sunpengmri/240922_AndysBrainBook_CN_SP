<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Machine Learning Tutorial #5: MVPA Analysis with The Decoding Toolbox &mdash; Andy&#39;s Brain Book 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Machine Learning Tutorial #6: Scripting" href="ML_06_Haxby_Scripting.html" />
    <link rel="prev" title="Machine Learning Tutorial #4: Creating the Timing Files" href="ML_04_Haxby_Timing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Andy's Brain Book
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/fsl_mac_install.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unix for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_Intro.html">What is Unix?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_01_Navigation.html">Unix Tutorial #1: 目录操作 (Directories and Navigation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_02_CopyRemove.html">Unix Tutorial #2: Copying and Removing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_03_ReadingTextFiles.html">Unix Tutorial #3: Reading Text Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_04_ShellsVariables.html">Unix Tutorial #4: Shells and Path Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_05_ForLoops.html">Unix Tutorial #5: For-Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_06_IfElse.html">Unix Tutorial #6: Conditional Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_07_Scripting.html">Unix Tutorial #7: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_08_Sed.html">Unix Tutorial #8: The Sed Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../unix/Unix_09_AutomatingTheAnalysis.html">Unix Tutorial #9: Automating The Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Short Course with FSL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_Intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_01_DataDownload.html">fMRI Tutorial #1: Downloading the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_02_ExperimentalDesign.html">fMRI Tutorial #2: Overview of The Flanker Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_03_LookingAtTheData.html">fMRI Tutorial #3: Looking at the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_04_Preprocessing.html">fMRI Tutorial #4: Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_05_1stLevelAnalysis.html">fMRI Tutorial #5: Statistics and Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_06_Scripting.html">fMRI Tutorial #6: Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_07_2ndLevelAnalysis.html">fMRI Tutorial #7: 2nd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_08_3rdLevelAnalysis.html">fMRI Tutorial #8: 3rd-Level Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_09_ROIAnalysis.html">fMRI Tutorial #9: ROI Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_10_Summary.html">fMRI Tutorial #10: Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fMRI_Short_Course/fMRI_Appendices.html">fMRI Short Course: Appendices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FreeSurfer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FreeSurfer/FreeSurfer_Introduction.html">FreeSurfer Short Course</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">E-Prime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../E-Prime/E-Prime_Overview.html">Overview of E-Prime</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AFNI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../AFNI/AFNI_Overview.html">AFNI Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SPM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../SPM/SPM_Overview.html">SPM Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functional Connectivity with the CONN Toolbox</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FunctionalConnectivity/CONN_Overview.html">Functional Connectivity and the CONN Toolbox</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parametric Modulation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PM/PM_Overview.html">Parametric Modulation in SPM, FSL, and AFNI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Image Visualization with MRIcroGL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRIcroGL/MRIcroGL_Overview.html">Image Visualization with MRIcroGL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction to the Human Connectome Project (HCP)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../HCP/HCP_Overview.html">Introduction to the Human Connectome Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Finite Impulse Response (FIR) Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FIR/FIR_Overview.html">Finite Impulse Response (FIR)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">fMRI Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Practicals/DesignOptimization.html">Design Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Diffusion Analysis with MRtrix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MRtrix/MRtrix_Introduction.html">Introduction to MRtrix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ASL Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/ASL_Techniques.html">fASL Tutorial #1: Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_02_Download.html">fASL Tutorial #2: Downloading and Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/fASL_03_Task.html">fASL Tutorial #3: The N-Back Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/04_fASL_GUI.html">fASL Tutorial #4: The GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/05_fASL_Results.html">fASL Tutorial #5: Examining the Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ASL/06_fASL_Quantification.html">fASL Tutorial #6: Quantification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Frequently Asked Questions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FrequentlyAskedQuestions/FrequentlyAskedQuestions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Statistics/GIMME.html">GIMME (Group Iterative Multiple Model Estimation)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Open Science</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../OpenScience/OS_Overview.html">Open Science</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Normalization Tools (ANTs)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ANTs/ANTs_Overview.html">Advanced Normalization Tools (ANTs)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tract-Based Spatial Statistics (TBSS)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../TBSS/TBSS_Overview.html">Introduction to Tract-Based Spatial Statistics (TBSS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Stats/Stats_Overview.html">Statistics for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machine Learning for Neuroimagers</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../ML_Overview.html">Machine Learning for Neuroimagers</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../ML_Overview.html#overview">Overview</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ML_00_Introduction.html">Machine Learning: Introduction to Basic Terms and Concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="ML_01_Brown_Example.html">Machine Learning Tutorial #1: Basic Example with Support Vector Machines</a></li>
<li class="toctree-l3"><a class="reference internal" href="ML_02_Haxby_Intro_Download.html">Machine Learning Tutorial #2: The Haxby Dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="ML_03_Haxby_Preprocessing.html">Machine Learning Tutorial #3: Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="ML_04_Haxby_Timing.html">Machine Learning Tutorial #4: Creating the Timing Files</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Machine Learning Tutorial #5: MVPA Analysis with The Decoding Toolbox</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-decoding-toolbox">The Decoding Toolbox</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modifying-the-template-script">Modifying the Template Script</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examining-the-results">Examining the Results</a></li>
<li class="toctree-l4"><a class="reference internal" href="#searchlight-analysis">Searchlight Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#video">Video</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exercises">Exercises</a></li>
<li class="toctree-l4"><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ML_06_Haxby_Scripting.html">Machine Learning Tutorial #6: Scripting</a></li>
<li class="toctree-l3"><a class="reference internal" href="ML_07_Haxby_GroupAnalysis.html">Machine Learning Tutorial #7: Group Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="ML_08_Haxby_NonParametric.html">Machine Learning Tutorial #8: Non-Parametric Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="ML_09_RSA.html">Machine Learning Tutorial #9: Representational Similarity Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="ML_10_Hyperalignment.html">Machine Learning Tutorial #10: Hyperalignment</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Slicer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Slicer/Slicer_Overview.html">Slicer Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CAT12</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CAT12/CAT12_Overview.html">Voxel-Based Morphometry with CAT12</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using the Supercomputer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Supercomputer/Supercomputer_Overview.html">Introduction to Supercomputing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Matlab for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Matlab/Matlab_Overview.html">Matlab for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ITK-Snap</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ITK-Snap/ITK-Snap_Overview.html">ITK-Snap_Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python for Neuroimagers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PythonForNeuroimagers/PythonForNeuroimagers_Overview.html">Python for Neuroimagers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta-Analysis for fMRI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MetaAnalysis/MetaAnalysis_Overview.html">Meta-Analysis for Neuroimagers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Andy's Brain Book</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../ML_Overview.html">Machine Learning for Neuroimagers</a></li>
      <li class="breadcrumb-item active">Machine Learning Tutorial #5: MVPA Analysis with The Decoding Toolbox</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/ML/ML_Short_Course/ML_05_Haxby_MVPA.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="machine-learning-tutorial-5-mvpa-analysis-with-the-decoding-toolbox">
<span id="ml-05-haxby-mvpa"></span><h1>Machine Learning Tutorial #5: MVPA Analysis with The Decoding Toolbox<a class="headerlink" href="#machine-learning-tutorial-5-mvpa-analysis-with-the-decoding-toolbox" title="Link to this heading"></a></h1>
<hr class="docutils" />
<section id="the-decoding-toolbox">
<h2>The Decoding Toolbox<a class="headerlink" href="#the-decoding-toolbox" title="Link to this heading"></a></h2>
<p>Having generated beta maps for this subject - one per condition for each run - we are now ready to run a <strong>multi-variate pattern analysis</strong>, using the beta maps as both training and testing data. This is similar to what we did in the first tutorial with AFNI’s <code class="docutils literal notranslate"><span class="pre">3dsvm</span></code> command, but we will be using a different package called <strong>The Decoding Toolbox</strong>.</p>
<p>A software package that runs in Matlab, The Decoding Toolbox can be downloaded from its homepage, located <a class="reference external" href="https://sites.google.com/site/tdtdecodingtoolbox/">here</a>. Scroll down the page and click on the link <code class="docutils literal notranslate"><span class="pre">Click</span> <span class="pre">here</span> <span class="pre">to</span> <span class="pre">download</span> <span class="pre">TDT</span></code>. Unzip the file when it is finished downloading, and move it to your home directory. Then open a Matlab terminal, click on “Set Path” at the top of the <code class="docutils literal notranslate"><span class="pre">Home</span></code> tab, and then click on <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">Folder</span> <span class="pre">with</span> <span class="pre">subfolders</span></code>. Select the directory <code class="docutils literal notranslate"><span class="pre">decoding_toolbox</span></code> within the folder <code class="docutils literal notranslate"><span class="pre">tdt_3.999</span></code>, then click <code class="docutils literal notranslate"><span class="pre">Open</span></code> and <code class="docutils literal notranslate"><span class="pre">Save</span></code>.</p>
<figure class="align-default">
<img alt="../../_images/05_TDT_Path.png" src="../../_images/05_TDT_Path.png" />
</figure>
</section>
<section id="modifying-the-template-script">
<h2>Modifying the Template Script<a class="headerlink" href="#modifying-the-template-script" title="Link to this heading"></a></h2>
<p>The Decoding Toolbox contains many different commands and scripts, which I encourage you to explore at your leisure. For the current study, however, you will only need to modify one script: <code class="docutils literal notranslate"><span class="pre">decoding_template.m</span></code>. Open this file by typing <code class="docutils literal notranslate"><span class="pre">open</span> <span class="pre">decoding_template</span></code> from the command line, which will display the file in the editor window. Using the <code class="docutils literal notranslate"><span class="pre">Editor</span></code> tab, click on <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">-&gt;</span> <span class="pre">Save</span> <span class="pre">As...</span></code> and save it to the folder <code class="docutils literal notranslate"><span class="pre">Haxby_Data</span></code>, labeling it <code class="docutils literal notranslate"><span class="pre">Haxby_MVPA_ROI</span></code>.</p>
<p>You will see several fields that need to be filled in or commented out. The first couple of <code class="docutils literal notranslate"><span class="pre">addpath</span></code> commands can be used to set the path to The Decoding Toolbox and SPM, if you need to; since we have already set those paths, we can comment out these lines.</p>
<p>On line 17, we have different analysis options. The default, <strong>searchlight</strong>, will analyze all of the voxels within a mask (or the entire brain) and determine which voxels are most useful for decoding a particular condition. We will revisit this in a later tutorial; for now, change this string to “ROI”, which will calculate the decoding accuracy across all of the voxels for each condition within a particular mask.</p>
<p>Lines 21 and 24, <code class="docutils literal notranslate"><span class="pre">cfg.results.dir</span></code> and <code class="docutils literal notranslate"><span class="pre">beta_loc</span></code>, can both be set to <code class="docutils literal notranslate"><span class="pre">[pwd</span> <span class="pre">'/SPM_Results_1']</span></code>.</p>
<p>On line 31, we will set a path to the mask. In the original Haxby paper, this mask was created by manually selecting the voxels within the lingual,
fusiform, inferior occipital, and middle occipital gyri, and then running an omnibus test to detect any voxels that responded to any of the conditions, thresholded at a p-value of p=0.000001. Any significant voxels within the manually defined mask were then binarized to create a new mask.</p>
<p>We could do this ourselves, but the masks have already been provided by the authors on <a class="reference external" href="http://data.pymvpa.org/datasets/haxby2001/">this website</a>. Clicking on the file <strong>subj1-2010.01.14.tar.gz</strong>, for example, will download the original functional and timing data for subj1, including the mask used in the original paper. Download this folder and then unzip it, and note that there are several masks that you are able to choose from; the file <code class="docutils literal notranslate"><span class="pre">mask4_vt.nii.gz</span></code> is a ventral temporal mask that contains the significant voxels from the omnibus test. Open a terminal, navigate to the directory <code class="docutils literal notranslate"><span class="pre">subj1</span></code> that you just downloaded, and unzip the file by typing <code class="docutils literal notranslate"><span class="pre">gunzip</span> <span class="pre">mask4_vt.nii.gz</span></code>; then navigate to the <code class="docutils literal notranslate"><span class="pre">Haxby_Data</span></code> directory, create a new directory for the masks by typing <code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">Haxby_Masks</span></code>, and move the file to this folder (e.g., <code class="docutils literal notranslate"><span class="pre">movefile('~/Downloads/subj1/mask4_vt.nii',</span> <span class="pre">'~/Desktop/Haxby_Data/Haxby_Masks/sub-1_mask4_vt_1.nii')</span></code>).</p>
<p>Beginning on line 36, we can list all of the conditions we have in our experiment. Since there were 8, we will create 8 labelnames, one for each condition; e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">labelname1</span> <span class="o">=</span> <span class="s1">&#39;bottle&#39;</span><span class="p">;</span>
<span class="n">labelname2</span> <span class="o">=</span> <span class="s1">&#39;cat&#39;</span><span class="p">;</span>
<span class="n">labelname3</span> <span class="o">=</span> <span class="s1">&#39;chair&#39;</span><span class="p">;</span>
<span class="n">labelname4</span> <span class="o">=</span> <span class="s1">&#39;face&#39;</span><span class="p">;</span>
<span class="n">labelname5</span> <span class="o">=</span> <span class="s1">&#39;house&#39;</span><span class="p">;</span>
<span class="n">labelname6</span> <span class="o">=</span> <span class="s1">&#39;scissors&#39;</span><span class="p">;</span>
<span class="n">labelname7</span> <span class="o">=</span> <span class="s1">&#39;scrambledpix&#39;</span><span class="p">;</span>
<span class="n">labelname8</span> <span class="o">=</span> <span class="s1">&#39;shoe&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>So far, the modified script should look something like this:</p>
<figure class="align-default">
<img alt="../../_images/05_Haxby_Script_Edited1.png" src="../../_images/05_Haxby_Script_Edited1.png" />
</figure>
<p>Line 63 indicates the output that you want from the analysis; the default is “accuracy minus chance.” A more useful output is a confusion matrix, which shows how accurate the classifier is at identifying each condition correctly. In this case, we will uncomment the line and change it to “confusion_matrix”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;confusion_matrix&#39;</span><span class="p">};</span>
</pre></div>
</div>
<p>The last line to edit is near the end, which starts with <code class="docutils literal notranslate"><span class="pre">cfg=decoding_describe_data</span></code>. This contains only two conditions; to expand it to our 8 conditions, we will replace it with this code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">decoding_describe_data</span><span class="p">(</span><span class="n">cfg</span><span class="p">,{</span><span class="n">labelname1</span> <span class="n">labelname2</span> <span class="n">labelname3</span> <span class="n">labelname4</span> <span class="n">labelname5</span> <span class="n">labelname6</span> <span class="n">labelname7</span> <span class="n">labelname8</span><span class="p">},[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span><span class="p">],</span><span class="n">regressor_names</span><span class="p">,</span><span class="n">beta_loc</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To keep your results organized, you can also include the option “cfg.results.filestart” to specify a prefix that is applied to the output files.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The latest operating system for Macintosh as of this writing (January 24th, 2021) is Catalina. You may run into an error installing SPM and The Decoding Toolbox, which is related to the MEX files. The following code should fix this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">find</span> <span class="o">.</span> <span class="o">-</span><span class="n">name</span> <span class="s2">&quot;*.mexmaci64&quot;</span> <span class="o">-</span><span class="n">exec</span> <span class="n">xattr</span> <span class="o">-</span><span class="n">d</span> <span class="n">com</span><span class="o">.</span><span class="n">apple</span><span class="o">.</span><span class="n">quarantine</span> <span class="p">{}</span> \<span class="p">;</span>
</pre></div>
</div>
</div>
</section>
<section id="examining-the-results">
<h2>Examining the Results<a class="headerlink" href="#examining-the-results" title="Link to this heading"></a></h2>
<p>Now save the file and run it from the terminal by typing <code class="docutils literal notranslate"><span class="pre">Haxby_MVPA_ROI</span></code>. This should only take a few moments, and you will then see the following figures:</p>
<figure class="align-default" id="id1">
<img alt="../../_images/05_Haxby_ROI_Output.png" src="../../_images/05_Haxby_ROI_Output.png" />
<figcaption>
<p><span class="caption-text">The output from an MVPA ROI analysis. The figure on the left shows the beta maps that are used as both training and testing data, which uses a leave-one-out cross-validation procedure. The figure on the right shows a three-dimensional representation of the voxels in the mask.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The results are stored in two places: Your Matlab workspace, in the variable <code class="docutils literal notranslate"><span class="pre">results</span></code>, and in a .mat file in the statistics directory called <code class="docutils literal notranslate"><span class="pre">res_confusion_matrix.mat</span></code>. (That way, you still have the results written to your disk even if you clear your Matlab workspace.) To see the confusion matrix, type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="o">.</span><span class="n">output</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p>Which will return something like this:</p>
<figure class="align-default">
<img alt="../../_images/05_Haxby_ROI_Results.png" src="../../_images/05_Haxby_ROI_Results.png" />
</figure>
<p>This can also be represented as a heatmap:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">;</span> <span class="n">heatmap</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="o">.</span><span class="n">output</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span> <span class="s1">&#39;Colormap&#39;</span><span class="p">,</span> <span class="n">jet</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../../_images/05_Haxby_ConfusionMatrix_Heatmap.png" src="../../_images/05_Haxby_ConfusionMatrix_Heatmap.png" />
</figure>
<p>Going from left to right, and from top to bottom, the columns and rows are 1) bottle; 2) cat; 3) chair; 4) face; 5) house; 6) scissors; 7) scrambledpix; and 8) shoe - the same order as they were entered into the GLM.</p>
<p>How should we interpret this? If we look at the number in the upper left corner, we see that it is 58.33%. That means that when the classifier was trained with the beta maps for the bottle condition, it accurately identified other beta maps for the bottle condition 58.33% of the time. If we look at the neighboring square to the right with a value of 8.33%, that is the amount that bottle beta maps were misidentified as cat beta maps. A perfect classifier would be 100% on all of the squares along the diagonal, since every condition would be correctly classified. Note that the highest classification accuracy is for faces and houses and the lowest accuracy is for scissors, replicating the main findings in the Haxby paper.</p>
</section>
<section id="searchlight-analysis">
<h2>Searchlight Analysis<a class="headerlink" href="#searchlight-analysis" title="Link to this heading"></a></h2>
<p>The ROI analysis we just did gave us a single classification accuracy number per condition. This is useful if we have an ROI a priori, but what if we want to look at the whole brain?</p>
<p>One method to do this is called <strong>searchlight analysis</strong>. The searchlight is composed of a cluster of voxels of a given size specified by the user, which is centered consecutively at each voxel in the brain. The above ROI analysis is done here in miniature, with a leave-one-out cross-validation performed at each position of the searchlight; the classification accuracy is then stored in the center of the searchlight, and the process is repeated for the next voxel.</p>
<p>To run this analysis, click on <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">-&gt;</span> <span class="pre">Save</span> <span class="pre">As...</span></code> and call the new file <code class="docutils literal notranslate"><span class="pre">Haxby_MVPA_Searchlight</span></code>. Open it in the terminal and change the <code class="docutils literal notranslate"><span class="pre">cfg.analysis</span></code> from “ROI” to “searchlight”. Since we are examining a relatively large area, let’s increase the searchlight radius to 5. Later one, in lines 50-53, you can decide to change the units to millimeters instead of voxels, and whether to make the searchlight spherical. Also, if we want to run the searchlight across the whole brain and not just the mask we specified previously, comment out line 31 (<code class="docutils literal notranslate"><span class="pre">cfg.files.mask</span></code>). Let’s also uncomment lines 53 and 54 (i.e., <code class="docutils literal notranslate"><span class="pre">cfg.searchlight.spherical</span></code> and <code class="docutils literal notranslate"><span class="pre">cfg.verbose</span></code>), and change line 70 from “confusion_matrix” to “accuracy_minus_chance”, which will create the accuracy map. Save the script, and then run it from the terminal by typing <code class="docutils literal notranslate"><span class="pre">Haxby_MVPA_Searchlight</span></code>.</p>
<p>You will see the same training and testing data figure as before, along with a figure that appears to show a group of voxels being used as a mask. Every few seconds or so, the group of voxels will move to a different location, demonstrating how the searchlight moves through all of the voxels in the brain. Note that it sometimes seems irregularly shaped, especially near the edges of the brain, but that it is a spherical cluster inside the brain mask.</p>
<figure class="align-default">
<img alt="../../_images/05_Haxby_Searchlight.png" src="../../_images/05_Haxby_Searchlight.png" />
</figure>
<p>The result of this analysis is a file in the <code class="docutils literal notranslate"><span class="pre">SPM_Results_1</span></code> directory called <code class="docutils literal notranslate"><span class="pre">res_accuracy_minus_chance.nii</span></code>. I find it useful to overlay this on the subject’s coregistered anatomical image in a viewer such as AFNI; after copying the file <code class="docutils literal notranslate"><span class="pre">rsub-1_T1w.nii</span></code> into the <code class="docutils literal notranslate"><span class="pre">SPM_Results_1</span></code> directory and loading the AFNI viewer, experiment with different viewing settings, in particular the threshold. Remember that the values in the image are the accuracy scores minus chance; since chance in this study is 1/8, or 12.5%., any negative values are accuracy scores less than chance, and any positive values are above chance. For example, if in a certain voxel we find a value of 25, that means the classification accuracy at that voxel is 25%+12.5%, or 37.5% total.</p>
<figure class="align-default" id="id2">
<img alt="../../_images/05_Haxby_Searchlight_Results.png" src="../../_images/05_Haxby_Searchlight_Results.png" />
<figcaption>
<p><span class="caption-text">Sample figure of the searchlight results, overlaid onto the subject’s coregistered anatomical volume. The image is thresholded at 30, which shows classification accuracies of 42.5% or greater. The highest classification accuracies are found in the ventral temporal cortex, similar to what was found in the Haxby 2001 paper.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="video">
<h2>Video<a class="headerlink" href="#video" title="Link to this heading"></a></h2>
<p>The video walkthroughs for this chapter are divided into two parts: To see how to do an ROI MVPA analysis, click <a class="reference external" href="https://www.youtube.com/watch?v=R0R-1kCIBAI">here</a>. To see how to do a searchlight analysis, click <a class="reference external" href="https://www.youtube.com/watch?v=CTxVHBh6OmI">here</a>.</p>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>In the <code class="docutils literal notranslate"><span class="pre">Haxby_MVPA_ROI</span></code> script, remove the last four labels (i.e., lines 41-44), either by commenting them out or deleting them. (Hint: You will also need to modify line 85 in order for the script to run without errors.) What difference do you notice in the updated <code class="docutils literal notranslate"><span class="pre">results</span></code> variable? Why do you think it has or has not changed? Show a screenshot of the edits you made, and a screenshot of the updated confusion matrix.</p></li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">Haxby_MVPA_Searchlight</span></code> script, change the Searchlight radius to 6mm, and rerun the script. Show a screenshot of the code that you edited. Use SPM’s Display command to show the resulting <code class="docutils literal notranslate"><span class="pre">res_accuracy_minus_chance.nii</span></code> image, again focusing your crosshairs on the ventral temporal cortex in coordinates [23, -30, -24]. Take another screenshot of the image. How does it compare to the previous searchlight that was used? Why do you think there is a difference?</p></li>
<li><p>Look at other output of the command <code class="docutils literal notranslate"><span class="pre">help</span> <span class="pre">decoding_transform_results</span></code> for a list of possible outputs. Using the same searchlight parameters as in Exercise #2, create an output of both <code class="docutils literal notranslate"><span class="pre">accuracy_minus_chance</span></code> and <code class="docutils literal notranslate"><span class="pre">accuracy</span></code> using a single script. Show the code you used to make this change.</p></li>
</ol>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading"></a></h2>
<p>Now that we have both ROI and whole-brain searchlight results, we can repeat the same procedure for all of the subjects in our study. To see how to automate the process, click the <code class="docutils literal notranslate"><span class="pre">Next</span></code> button.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ML_04_Haxby_Timing.html" class="btn btn-neutral float-left" title="Machine Learning Tutorial #4: Creating the Timing Files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ML_06_Haxby_Scripting.html" class="btn btn-neutral float-right" title="Machine Learning Tutorial #6: Scripting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Andy Jahn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>